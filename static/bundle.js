/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e,t,i={660:(e,t,i)=>{var s;!function(e){!function(t){var s="object"==typeof i.g?i.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),n=o(e);function o(e,t){return function(i,s){"function"!=typeof e[i]&&Object.defineProperty(e,i,{configurable:!0,writable:!0,value:s}),t&&t(i,s)}}void 0===s.Reflect?s.Reflect=e:n=o(s.Reflect,n),function(e){var t=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,s=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",n=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,h=!o&&!a,r={create:o?function(){return D(Object.create(null))}:a?function(){return D({__proto__:null})}:function(){return D({})},has:h?function(e,i){return t.call(e,i)}:function(e,t){return t in e},get:h?function(e,i){return t.call(e,i)?e[i]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),f="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],i=function(){function e(e,t,i){this._index=0,this._keys=e,this._values=t,this._selector=i}return e.prototype["@@iterator"]=function(){return this},e.prototype[n]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var i=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var i=this._find(e,!0);return this._values[i]=t,this},t.prototype.delete=function(t){var i=this._find(t,!1);if(i>=0){for(var s=this._keys.length,n=i+1;n<s;n++)this._keys[n-1]=this._keys[n],this._values[n-1]=this._values[n];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new i(this._keys,this._values,s)},t.prototype.values=function(){return new i(this._keys,this._values,o)},t.prototype.entries=function(){return new i(this._keys,this._values,a)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[n]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function s(e,t){return e}function o(e,t){return t}function a(e,t){return[e,t]}}():Map,l=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new d}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[n]=function(){return this.keys()},e}():Set,x=new(f||"function"!=typeof WeakMap?function(){var e=16,i=r.create(),s=n();return function(){function e(){this._key=n()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&r.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?r.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=n()},e}();function n(){var e;do{e="@@WeakMap@@"+h()}while(r.has(i,e));return i[e]=!0,e}function o(e,i){if(!t.call(e,s)){if(!i)return;Object.defineProperty(e,s,{value:r.create()})}return e[s]}function a(e,t){for(var i=0;i<t;++i)e[i]=255*Math.random()|0;return e}function h(){var t,i=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t));i[6]=79&i[6]|64,i[8]=191&i[8]|128;for(var s="",n=0;n<e;++n){var o=i[n];4!==n&&6!==n&&8!==n||(s+="-"),o<16&&(s+="0"),s+=o.toString(16).toLowerCase()}return s}}():WeakMap);function y(e,t,i){var s=x.get(e);if(L(s)){if(!i)return;s=new d,x.set(e,s)}var n=s.get(t);if(L(n)){if(!i)return;n=new d,s.set(t,n)}return n}function p(e,t,i){if(g(e,t,i))return!0;var s=I(t);return!S(s)&&p(e,s,i)}function g(e,t,i){var s=y(t,i,!1);return!L(s)&&!!s.has(e)}function u(e,t,i){if(g(e,t,i))return w(e,t,i);var s=I(t);return S(s)?void 0:u(e,s,i)}function w(e,t,i){var s=y(t,i,!1);if(!L(s))return s.get(e)}function v(e,t,i,s){y(i,s,!0).set(e,t)}function m(e,t){var i=T(e,t),s=I(e);if(null===s)return i;var n=m(s,t);if(n.length<=0)return i;if(i.length<=0)return n;for(var o=new l,a=[],h=0,r=i;h<r.length;h++){var c=r[h];o.has(c)||(o.add(c),a.push(c))}for(var f=0,d=n;f<d.length;f++)c=d[f],o.has(c)||(o.add(c),a.push(c));return a}function T(e,t){var i=[],s=y(e,t,!1);if(L(s))return i;for(var o=function(e){var t=O(e,n);if(!C(t))throw new TypeError;var i=t.call(e);if(!b(i))throw new TypeError;return i}(s.keys()),a=0;;){var h=E(o);if(!h)return i.length=a,i;var r=h.value;try{i[a]=r}catch(e){try{R(o)}finally{throw e}}a++}}function k(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function L(e){return void 0===e}function S(e){return null===e}function b(e){return"object"==typeof e?null!==e:"function"==typeof e}function A(e,t){switch(k(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var i=3===t?"string":5===t?"number":"default",n=O(e,s);if(void 0!==n){var o=n.call(e,i);if(b(o))throw new TypeError;return o}return function(e,t){if("string"===t){var i=e.toString;if(C(i)&&!b(n=i.call(e)))return n;if(C(s=e.valueOf)&&!b(n=s.call(e)))return n}else{var s;if(C(s=e.valueOf)&&!b(n=s.call(e)))return n;var n,o=e.toString;if(C(o)&&!b(n=o.call(e)))return n}throw new TypeError}(e,"default"===i?"number":i)}function _(e){var t=A(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function M(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function C(e){return"function"==typeof e}function P(e){return"function"==typeof e}function O(e,t){var i=e[t];if(null!=i){if(!C(i))throw new TypeError;return i}}function E(e){var t=e.next();return!t.done&&t}function R(e){var t=e.return;t&&t.call(e)}function I(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(null==s||s===Object.prototype)return t;var n=s.constructor;return"function"!=typeof n||n===e?t:n}function D(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,i,s){if(L(i)){if(!M(e))throw new TypeError;if(!P(t))throw new TypeError;return function(e,t){for(var i=e.length-1;i>=0;--i){var s=(0,e[i])(t);if(!L(s)&&!S(s)){if(!P(s))throw new TypeError;t=s}}return t}(e,t)}if(!M(e))throw new TypeError;if(!b(t))throw new TypeError;if(!b(s)&&!L(s)&&!S(s))throw new TypeError;return S(s)&&(s=void 0),function(e,t,i,s){for(var n=e.length-1;n>=0;--n){var o=(0,e[n])(t,i,s);if(!L(o)&&!S(o)){if(!b(o))throw new TypeError;s=o}}return s}(e,t,i=_(i),s)})),e("metadata",(function(e,t){return function(i,s){if(!b(i))throw new TypeError;if(!L(s)&&!function(e){switch(k(e)){case 3:case 4:return!0;default:return!1}}(s))throw new TypeError;v(e,t,i,s)}})),e("defineMetadata",(function(e,t,i,s){if(!b(i))throw new TypeError;return L(s)||(s=_(s)),v(e,t,i,s)})),e("hasMetadata",(function(e,t,i){if(!b(t))throw new TypeError;return L(i)||(i=_(i)),p(e,t,i)})),e("hasOwnMetadata",(function(e,t,i){if(!b(t))throw new TypeError;return L(i)||(i=_(i)),g(e,t,i)})),e("getMetadata",(function(e,t,i){if(!b(t))throw new TypeError;return L(i)||(i=_(i)),u(e,t,i)})),e("getOwnMetadata",(function(e,t,i){if(!b(t))throw new TypeError;return L(i)||(i=_(i)),w(e,t,i)})),e("getMetadataKeys",(function(e,t){if(!b(e))throw new TypeError;return L(t)||(t=_(t)),m(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!b(e))throw new TypeError;return L(t)||(t=_(t)),T(e,t)})),e("deleteMetadata",(function(e,t,i){if(!b(t))throw new TypeError;L(i)||(i=_(i));var s=y(t,i,!1);if(L(s))return!1;if(!s.delete(e))return!1;if(s.size>0)return!0;var n=x.get(t);return n.delete(i),n.size>0||x.delete(t),!0}))}(n)}()}(s||(s={}))}},s={};function n(e){var t=s[e];if(void 0!==t)return t.exports;var o=s[e]={exports:{}};return i[e](o,o.exports,n),o.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(i,s){if(1&s&&(i=this(i)),8&s)return i;if("object"==typeof i&&i){if(4&s&&i.__esModule)return i;if(16&s&&"function"==typeof i.then)return i}var o=Object.create(null);n.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var h=2&s&&i;"object"==typeof h&&!~e.indexOf(h);h=t(h))Object.getOwnPropertyNames(h).forEach((e=>a[e]=()=>i[e]));return a.default=()=>i,n.d(o,a),o},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e;n(660),function(e){e[e.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",e[e.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",e[e.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"}(e||(e={}));var t=new(function(){function t(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return t.prototype.addTypeMetadata=function(e){this._typeMetadatas.has(e.target)||this._typeMetadatas.set(e.target,new Map),this._typeMetadatas.get(e.target).set(e.propertyName,e)},t.prototype.addTransformMetadata=function(e){this._transformMetadatas.has(e.target)||this._transformMetadatas.set(e.target,new Map),this._transformMetadatas.get(e.target).has(e.propertyName)||this._transformMetadatas.get(e.target).set(e.propertyName,[]),this._transformMetadatas.get(e.target).get(e.propertyName).push(e)},t.prototype.addExposeMetadata=function(e){this._exposeMetadatas.has(e.target)||this._exposeMetadatas.set(e.target,new Map),this._exposeMetadatas.get(e.target).set(e.propertyName,e)},t.prototype.addExcludeMetadata=function(e){this._excludeMetadatas.has(e.target)||this._excludeMetadatas.set(e.target,new Map),this._excludeMetadatas.get(e.target).set(e.propertyName,e)},t.prototype.findTransformMetadatas=function(t,i,s){return this.findMetadatas(this._transformMetadatas,t,i).filter((function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?s===e.CLASS_TO_CLASS||s===e.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||s===e.CLASS_TO_PLAIN)}))},t.prototype.findExcludeMetadata=function(e,t){return this.findMetadata(this._excludeMetadatas,e,t)},t.prototype.findExposeMetadata=function(e,t){return this.findMetadata(this._exposeMetadatas,e,t)},t.prototype.findExposeMetadataByCustomName=function(e,t){return this.getExposedMetadatas(e).find((function(e){return e.options&&e.options.name===t}))},t.prototype.findTypeMetadata=function(e,t){return this.findMetadata(this._typeMetadatas,e,t)},t.prototype.getStrategy=function(e){var t=this._excludeMetadatas.get(e),i=t&&t.get(void 0),s=this._exposeMetadatas.get(e),n=s&&s.get(void 0);return i&&n||!i&&!n?"none":i?"excludeAll":"exposeAll"},t.prototype.getExposedMetadatas=function(e){return this.getMetadata(this._exposeMetadatas,e)},t.prototype.getExcludedMetadatas=function(e){return this.getMetadata(this._excludeMetadatas,e)},t.prototype.getExposedProperties=function(t,i){return this.getExposedMetadatas(t).filter((function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?i===e.CLASS_TO_CLASS||i===e.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||i===e.CLASS_TO_PLAIN)})).map((function(e){return e.propertyName}))},t.prototype.getExcludedProperties=function(t,i){return this.getExcludedMetadatas(t).filter((function(t){return!t.options||!0===t.options.toClassOnly&&!0===t.options.toPlainOnly||(!0===t.options.toClassOnly?i===e.CLASS_TO_CLASS||i===e.PLAIN_TO_CLASS:!0!==t.options.toPlainOnly||i===e.CLASS_TO_PLAIN)})).map((function(e){return e.propertyName}))},t.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},t.prototype.getMetadata=function(e,t){var i,s=e.get(t);s&&(i=Array.from(s.values()).filter((function(e){return void 0!==e.propertyName})));for(var n=[],o=0,a=this.getAncestors(t);o<a.length;o++){var h=a[o],r=e.get(h);if(r){var c=Array.from(r.values()).filter((function(e){return void 0!==e.propertyName}));n.push.apply(n,c)}}return n.concat(i||[])},t.prototype.findMetadata=function(e,t,i){var s=e.get(t);if(s){var n=s.get(i);if(n)return n}for(var o=0,a=this.getAncestors(t);o<a.length;o++){var h=a[o],r=e.get(h);if(r){var c=r.get(i);if(c)return c}}},t.prototype.findMetadatas=function(e,t,i){var s,n=e.get(t);n&&(s=n.get(i));for(var o=[],a=0,h=this.getAncestors(t);a<h.length;a++){var r=h[a],c=e.get(r);c&&c.has(i)&&o.push.apply(o,c.get(i))}return o.slice().reverse().concat((s||[]).slice().reverse())},t.prototype.getAncestors=function(e){if(!e)return[];if(!this._ancestorsMap.has(e)){for(var t=[],i=Object.getPrototypeOf(e.prototype.constructor);void 0!==i.prototype;i=Object.getPrototypeOf(i.prototype.constructor))t.push(i);this._ancestorsMap.set(e,t)}return this._ancestorsMap.get(e)},t}()),i=function(e,t,i){if(i||2===arguments.length)for(var s,n=0,o=t.length;n<o;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))},s=function(){function s(e,t){this.transformationType=e,this.options=t,this.recursionStack=new Set}return s.prototype.transform=function(i,s,o,a,h,r){var c,f=this;if(void 0===r&&(r=0),Array.isArray(s)||s instanceof Set){var d=a&&this.transformationType===e.PLAIN_TO_CLASS?function(e){var t=new e;return t instanceof Set||"push"in t?t:[]}(a):[];return s.forEach((function(t,s){var n=i?i[s]:void 0;if(f.options.enableCircularCheck&&f.isCircular(t))f.transformationType===e.CLASS_TO_CLASS&&(d instanceof Set?d.add(t):d.push(t));else{var a=void 0;if("function"!=typeof o&&o&&o.options&&o.options.discriminator&&o.options.discriminator.property&&o.options.discriminator.subTypes){if(f.transformationType===e.PLAIN_TO_CLASS){a=o.options.discriminator.subTypes.find((function(e){return e.name===t[o.options.discriminator.property]}));var h={newObject:d,object:t,property:void 0},c=o.typeFunction(h);a=void 0===a?c:a.value,o.options.keepDiscriminatorProperty||delete t[o.options.discriminator.property]}f.transformationType===e.CLASS_TO_CLASS&&(a=t.constructor),f.transformationType===e.CLASS_TO_PLAIN&&(t[o.options.discriminator.property]=o.options.discriminator.subTypes.find((function(e){return e.value===t.constructor})).name)}else a=o;var l=f.transform(n,t,a,void 0,t instanceof Map,r+1);d instanceof Set?d.add(l):d.push(l)}})),d}if(o!==String||h){if(o!==Number||h){if(o!==Boolean||h){if((o===Date||s instanceof Date)&&!h)return s instanceof Date?new Date(s.valueOf()):null==s?s:new Date(s);if(("undefined"!=typeof globalThis?globalThis:void 0!==n.g?n.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(o===Buffer||s instanceof Buffer)&&!h)return null==s?s:Buffer.from(s);if(null===(c=s)||"object"!=typeof c||"function"!=typeof c.then||h){if(h||null===s||"object"!=typeof s||"function"!=typeof s.then){if("object"==typeof s&&null!==s){o||s.constructor===Object||(Array.isArray(s)||s.constructor!==Array)&&(o=s.constructor),!o&&i&&(o=i.constructor),this.options.enableCircularCheck&&this.recursionStack.add(s);var l=this.getKeys(o,s,h),x=i||{};i||this.transformationType!==e.PLAIN_TO_CLASS&&this.transformationType!==e.CLASS_TO_CLASS||(x=h?new Map:o?new o:{});for(var y=function(n){if("__proto__"===n||"constructor"===n)return"continue";var a=n,c=n,f=n;if(!p.options.ignoreDecorators&&o)if(p.transformationType===e.PLAIN_TO_CLASS)(d=t.findExposeMetadataByCustomName(o,n))&&(f=d.propertyName,c=d.propertyName);else if(p.transformationType===e.CLASS_TO_PLAIN||p.transformationType===e.CLASS_TO_CLASS){var d;(d=t.findExposeMetadata(o,n))&&d.options&&d.options.name&&(c=d.options.name)}var l=void 0;l=p.transformationType===e.PLAIN_TO_CLASS?s[a]:s instanceof Map?s.get(a):s[a]instanceof Function?s[a]():s[a];var y=void 0,g=l instanceof Map;if(o&&h)y=o;else if(o){var u=t.findTypeMetadata(o,f);if(u){var w={newObject:x,object:s,property:f},v=u.typeFunction?u.typeFunction(w):u.reflectedType;u.options&&u.options.discriminator&&u.options.discriminator.property&&u.options.discriminator.subTypes?s[a]instanceof Array?y=u:(p.transformationType===e.PLAIN_TO_CLASS&&(y=void 0===(y=u.options.discriminator.subTypes.find((function(e){if(l&&l instanceof Object&&u.options.discriminator.property in l)return e.name===l[u.options.discriminator.property]})))?v:y.value,u.options.keepDiscriminatorProperty||l&&l instanceof Object&&u.options.discriminator.property in l&&delete l[u.options.discriminator.property]),p.transformationType===e.CLASS_TO_CLASS&&(y=l.constructor),p.transformationType===e.CLASS_TO_PLAIN&&l&&(l[u.options.discriminator.property]=u.options.discriminator.subTypes.find((function(e){return e.value===l.constructor})).name)):y=v,g=g||u.reflectedType===Map}else if(p.options.targetMaps)p.options.targetMaps.filter((function(e){return e.target===o&&!!e.properties[f]})).forEach((function(e){return y=e.properties[f]}));else if(p.options.enableImplicitConversion&&p.transformationType===e.PLAIN_TO_CLASS){var m=Reflect.getMetadata("design:type",o.prototype,f);m&&(y=m)}}var T=Array.isArray(s[a])?p.getReflectedType(o,f):void 0,k=i?i[a]:void 0;if(x.constructor.prototype){var L=Object.getOwnPropertyDescriptor(x.constructor.prototype,c);if((p.transformationType===e.PLAIN_TO_CLASS||p.transformationType===e.CLASS_TO_CLASS)&&(L&&!L.set||x[c]instanceof Function))return"continue"}if(p.options.enableCircularCheck&&p.isCircular(l))p.transformationType===e.CLASS_TO_CLASS&&(b=l,(void 0!==(b=p.applyCustomTransformations(b,o,n,s,p.transformationType))||p.options.exposeUnsetFields)&&(x instanceof Map?x.set(c,b):x[c]=b));else{var S=p.transformationType===e.PLAIN_TO_CLASS?c:n,b=void 0;p.transformationType===e.CLASS_TO_PLAIN?(b=s[S],b=p.applyCustomTransformations(b,o,S,s,p.transformationType),b=s[S]===b?l:b,b=p.transform(k,b,y,T,g,r+1)):void 0===l&&p.options.exposeDefaultValues?b=x[c]:(b=p.transform(k,l,y,T,g,r+1),b=p.applyCustomTransformations(b,o,S,s,p.transformationType)),(void 0!==b||p.options.exposeUnsetFields)&&(x instanceof Map?x.set(c,b):x[c]=b)}},p=this,g=0,u=l;g<u.length;g++)y(u[g]);return this.options.enableCircularCheck&&this.recursionStack.delete(s),x}return s}return s}return new Promise((function(e,t){s.then((function(t){return e(f.transform(void 0,t,o,void 0,void 0,r+1))}),t)}))}return null==s?s:Boolean(s)}return null==s?s:Number(s)}return null==s?s:String(s)},s.prototype.applyCustomTransformations=function(e,i,s,n,o){var a=this,h=t.findTransformMetadatas(i,s,this.transformationType);return void 0!==this.options.version&&(h=h.filter((function(e){return!e.options||a.checkVersion(e.options.since,e.options.until)}))),(h=this.options.groups&&this.options.groups.length?h.filter((function(e){return!e.options||a.checkGroups(e.options.groups)})):h.filter((function(e){return!e.options||!e.options.groups||!e.options.groups.length}))).forEach((function(t){e=t.transformFn({value:e,key:s,obj:n,type:o,options:a.options})})),e},s.prototype.isCircular=function(e){return this.recursionStack.has(e)},s.prototype.getReflectedType=function(e,i){if(e){var s=t.findTypeMetadata(e,i);return s?s.reflectedType:void 0}},s.prototype.getKeys=function(s,n,o){var a=this,h=t.getStrategy(s);"none"===h&&(h=this.options.strategy||"exposeAll");var r=[];if(("exposeAll"===h||o)&&(r=n instanceof Map?Array.from(n.keys()):Object.keys(n)),o)return r;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&s){var c=t.getExposedProperties(s,this.transformationType),f=t.getExcludedProperties(s,this.transformationType);r=i(i([],c,!0),f,!0)}if(!this.options.ignoreDecorators&&s){c=t.getExposedProperties(s,this.transformationType),this.transformationType===e.PLAIN_TO_CLASS&&(c=c.map((function(e){var i=t.findExposeMetadata(s,e);return i&&i.options&&i.options.name?i.options.name:e}))),r=this.options.excludeExtraneousValues?c:r.concat(c);var d=t.getExcludedProperties(s,this.transformationType);d.length>0&&(r=r.filter((function(e){return!d.includes(e)}))),void 0!==this.options.version&&(r=r.filter((function(e){var i=t.findExposeMetadata(s,e);return!i||!i.options||a.checkVersion(i.options.since,i.options.until)}))),r=this.options.groups&&this.options.groups.length?r.filter((function(e){var i=t.findExposeMetadata(s,e);return!i||!i.options||a.checkGroups(i.options.groups)})):r.filter((function(e){var i=t.findExposeMetadata(s,e);return!(i&&i.options&&i.options.groups&&i.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(r=r.filter((function(e){return a.options.excludePrefixes.every((function(t){return e.substr(0,t.length)!==t}))}))),r.filter((function(e,t,i){return i.indexOf(e)===t}))},s.prototype.checkVersion=function(e,t){var i=!0;return i&&e&&(i=this.options.version>=e),i&&t&&(i=this.options.version<t),i},s.prototype.checkGroups=function(e){return!e||this.options.groups.some((function(t){return e.includes(t)}))},s}(),o={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},a=function(){return a=Object.assign||function(e){for(var t,i=1,s=arguments.length;i<s;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},a.apply(this,arguments)},h=new(function(){function t(){}return t.prototype.instanceToPlain=function(t,i){return new s(e.CLASS_TO_PLAIN,a(a({},o),i)).transform(void 0,t,void 0,void 0,void 0,void 0)},t.prototype.classToPlainFromExist=function(t,i,n){return new s(e.CLASS_TO_PLAIN,a(a({},o),n)).transform(i,t,void 0,void 0,void 0,void 0)},t.prototype.plainToInstance=function(t,i,n){return new s(e.PLAIN_TO_CLASS,a(a({},o),n)).transform(void 0,i,t,void 0,void 0,void 0)},t.prototype.plainToClassFromExist=function(t,i,n){return new s(e.PLAIN_TO_CLASS,a(a({},o),n)).transform(t,i,void 0,void 0,void 0,void 0)},t.prototype.instanceToInstance=function(t,i){return new s(e.CLASS_TO_CLASS,a(a({},o),i)).transform(void 0,t,void 0,void 0,void 0,void 0)},t.prototype.classToClassFromExist=function(t,i,n){return new s(e.CLASS_TO_CLASS,a(a({},o),n)).transform(i,t,void 0,void 0,void 0,void 0)},t.prototype.serialize=function(e,t){return JSON.stringify(this.instanceToPlain(e,t))},t.prototype.deserialize=function(e,t,i){var s=JSON.parse(t);return this.plainToInstance(e,s,i)},t.prototype.deserializeArray=function(e,t,i){var s=JSON.parse(t);return this.plainToInstance(e,s,i)},t}());function r(e,t,i){return h.plainToInstance(e,t,i)}const c="SuperCrateHoard_SaveData",f="SuperCrateHoard_Preferences";class d{constructor(){this.finishedLevels={},this.version=1}static fromLocalStorage(){const e=window.localStorage.getItem(c);if(!e)return new d;const t=JSON.parse(e);return r(d,t)}toLocalStorage(){window.localStorage.setItem(c,JSON.stringify(this))}getFinishedLevels(e){return void 0===this.finishedLevels[e]&&(this.finishedLevels[e]=[]),this.finishedLevels[e]}markLevelFinished(e,t){if(void 0===this.finishedLevels[e])return;const i=this.finishedLevels[e];for(let e=0;e<t;++e)i[e]||(i[e]=0);i[t]=1}}class l{constructor(){this.version=1,this.repeatDelay=20,this.repeatRate=4,this.backgroundMovement=0,this.analysis=0,this.analysisAction=0}static fromLocalStorage(){const e=window.localStorage.getItem(f);if(!e)return new l;const t=JSON.parse(e);return r(l,t)}toLocalStorage(){window.localStorage.setItem(f,JSON.stringify(this))}}class x{constructor(e,t,i){this.collection=e,this.name=t,this.author=i}}class y{constructor(){this.strings=new x("","",""),this.collectionIndex=-1,this.levelIndex=-1}}class p{constructor(){this.saveData=d.fromLocalStorage(),this.preferences=l.fromLocalStorage(),this.levels=[],this.currentCollection=0,this.currentLevel=0,this.bgScroll=0,this.cachedStrings=new y}getLevelStrings(){const e=this.cachedStrings;if(this.currentCollection===e.collectionIndex&&this.currentLevel===e.levelIndex)return e.strings;const t=this.levels[this.currentCollection];if(!t)return e.strings;const i=t.levels[this.currentLevel];if(!i)return e.strings;const s=t.name;let n=`Level ${this.currentLevel+1}`;i.name&&i.name.length>0&&(n+=`: ${i.name}`);let o="Anonymous";i.author&&i.author.length>0?o=i.author:t.author.length>0&&(o=t.author);const a=new x(s,n,o);return e.strings=a,e.collectionIndex=this.currentCollection,e.levelIndex=this.currentLevel,a}getCurrentLevel(){const e=this.levels[this.currentCollection];if(!e)return null;return e.levels[this.currentLevel]||null}getFinishedLevels(){const e=this.levels[this.currentCollection];return e?this.saveData.getFinishedLevels(e.saveId):[]}markLevelFinished(){const e=this.levels[this.currentCollection];e&&this.saveData.markLevelFinished(e.saveId,this.currentLevel)}}class g{constructor(e){this.imageElement=new Image,this.imageElement.loading="eager",g.numLoading++,this.imageElement.onload=()=>{g.numLoading--},this.imageElement.onerror=()=>{g.errors.push(`Image failed to load: "${e}"`),g.numLoading--},this.imageElement.src=e}image(){return this.imageElement}static itemsLoading(){return this.numLoading}static itemErrors(){return this.errors}}g.numLoading=0,g.errors=[];class u{constructor(e){if(!u.dataCache[e]){const t=new g(e);u.dataCache[e]=t}this.pictureData=u.dataCache[e]}sharedData(){return this.pictureData}isLoaded(){return this.pictureData.image().complete}static allLoaded(){return g.itemsLoading()<=0&&g.itemErrors().length<=0}}u.dataCache={};class w{constructor(e,t,i,s){this.x=e,this.y=t,this.w=i,this.h=s}}class v{constructor(e){if(this.alreadyWarned={},this.mainCanvas=document.getElementById(e),!this.mainCanvas||!this.mainCanvas.getContext)throw new Error("Missing canvas");const t=this.mainCanvas.getContext("2d");if(!t)throw new Error("Could not create canvas context");this.drawingContext=t,this.drawingContext.imageSmoothingEnabled=!1,this.reset(),document.addEventListener("keydown",(e=>{e.altKey&&"Enter"==e.code&&!e.repeat&&this.toggleFullscreen()}))}checkPictureLoaded(e){const t=e.sharedData().image().src;return!!e.isLoaded()||(this.alreadyWarned[t]||(this.alreadyWarned[t]=!0,console.warn(`Drawing unloaded picture: "${t}"`)),!1)}reset(){const e=this.drawingContext;e.restore(),e.save(),this.drawBackgroundColor(0,0,0)}drawBackgroundColor(e,t,i,s=1){this.drawingContext.fillStyle=`rgb(${e}, ${t}, ${i}, ${s})`,this.drawingContext.fillRect(-1,-1,this.mainCanvas.width+2,this.mainCanvas.height+2)}drawPicture(e,t,i){this.checkPictureLoaded(e)&&this.drawingContext.drawImage(e.sharedData().image(),t,i)}drawSprite(e,t,i,s){this.checkPictureLoaded(e)&&this.drawingContext.drawImage(e.sharedData().image(),t.x,t.y,t.w,t.h,Math.round(i),Math.round(s),t.w,t.h)}drawRect(e,t,i,s,n){this.drawingContext.fillStyle=n,this.drawingContext.fillRect(e,t,i,s)}drawRectOutline(e,t,i,s,n){this.drawingContext.strokeStyle=n,this.drawingContext.strokeRect(e,t,i,s)}drawText(e,t,i,s,n,o=-1){this.drawingContext.font=s,this.drawingContext.fillStyle=n;const a=this.drawingContext.measureText(" "),h=Math.ceil(1.1*(a.fontBoundingBoxAscent+a.fontBoundingBoxDescent));o>0&&(e=this.computeWordWrap(e,o));const r=e.split("\n");for(const e of r)this.drawingContext.fillText(e,t,i),i+=h}computeWordWrap(e,t){let i="";const s=e.split(" ");let n=s[0]??"";for(let e=1;e<s.length;++e){const o=s[e];this.drawingContext.measureText(n+" "+o).width>t?(i+=n+"\n",n=o):n+=" "+o}return i+=n,i}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.mainCanvas.requestFullscreen({navigationUI:"hide"})}canvas(){return this.mainCanvas}context(){return this.drawingContext}}class m{constructor(){this.bindings=[],this.timeHeld=0,this.sameFrameOrdering=0}}class T{constructor(){this.heldKeys={},this.actions={},this.newKeysThisFrame=1,this.repeatDelay=20,this.repeatRate=4,document.addEventListener("keydown",(e=>this.keyDownHandler(e))),document.addEventListener("keyup",(e=>this.keyUpHandler(e))),document.addEventListener("contextmenu",(e=>{e.preventDefault(),e.stopPropagation()}))}keyDownHandler(e){e.altKey&&"Enter"==e.code||(this.heldKeys[e.code]=this.newKeysThisFrame,this.newKeysThisFrame++,e.preventDefault())}keyUpHandler(e){this.heldKeys[e.code]=0,e.preventDefault()}newFrame(){e:for(const e of Object.values(this.actions)){for(const t of e.bindings){const i=this.heldKeys[t];if(i>0){0===e.timeHeld&&(e.sameFrameOrdering=i),e.timeHeld++;continue e}}e.timeHeld=0}this.newKeysThisFrame=1}addAction(e,t=[]){if(this.actions[e])throw new Error(`Action "${e}" already exists`);this.actions[e]=new m,this.bindAction(e,t)}bindAction(e,t){const i=this.actions[e];if(!i)throw new Error(`Action "${e}" doesn't exist`);for(const e of t)e in i.bindings||i.bindings.push(e)}clearActionBindings(e){const t=this.actions[e];if(!t)throw new Error(`Action "${e}" doesn't exist`);t.bindings=[]}timeHeld(e){const t=this.actions[e];return t?t.timeHeld:0}held(e){return this.timeHeld(e)>0}justPressed(e){return 1===this.timeHeld(e)}newestHeld(e){let t=null,i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const n of e){const e=this.actions[n];if(!e)continue;const o=e.timeHeld,a=e.sameFrameOrdering;(o>0&&o<i||o===i&&a>s)&&(t=n,i=o,s=a)}return t}setDefaultRepeatRate(e,t){for(const i of Object.values(this.actions))i.timeHeld>=this.repeatDelay&&(i.timeHeld-=(i.timeHeld-this.repeatDelay)%t,i.timeHeld=Math.max(1,i.timeHeld+(e-this.repeatDelay)));this.repeatDelay=e,this.repeatRate=t}autoRepeat(e,t=-1,i=-1){const s=this.timeHeld(e);return-1===t&&(t=this.repeatDelay),-1===i&&(i=this.repeatRate),1===s||s>=t&&(s-t)%i==0}autoRepeatNewest(e,t=-1,i=-1){const s=this.newestHeld(e);return s&&this.autoRepeat(s,t,i)?s:null}}function k(e,t,i){return Math.max(Math.min(e,i),t)}function L(e,t,i){return i<=0?e:i>=1?t:e+i*(t-e)}function S(e,t){return(t-e)/2}function b(e){return fetch(e).then((e=>{if(!e.ok)throw Error(`HTTP response ${e.status}: ${e.statusText}`);return e.json()}))}class A{constructor(){this.handlers=[]}}class _{constructor(){this.tickLogic=[],this.drawLogic=[],this.tickLoaderLogic=[],this.drawLoaderLogic=[],this.events={},this.queuedEvents=[],this.waitForResources=!0}isLoaded(){if(this.waitForResources){if(g.itemsLoading()<=0&&g.itemErrors().length>0)throw new Error(function(e){if(e.length<=0)return"";let t="";for(const i of e)t+=i+"\n";return t.slice(0,-1)}(g.itemErrors()));return u.allLoaded()}return!0}addLogic(e){this.tickLogic.push(e),this.drawLogic.push(e)}addTickLogic(e){this.tickLogic.push(e)}addDrawLogic(e){this.drawLogic.push(e)}addTickLoaderLogic(e){this.tickLoaderLogic.push(e)}addDrawLoaderLogic(e){this.drawLoaderLogic.push(e)}addLoaderLogic(e){this.tickLoaderLogic.push(e),this.drawLoaderLogic.push(e)}addEventHandler(e,t){this.events[e]||(this.events[e]=new A),this.events[e].handlers.push(t)}pushEvent(e,t=null){this.queuedEvents.push({name:e,data:t})}processEvents(){for(const e of this.queuedEvents){const t=this.events[e.name];if(t)for(const i of t.handlers)i(e.data)}this.queuedEvents=[]}tick(e){const t=this.isLoaded()?this.tickLogic:this.tickLoaderLogic;for(const i of t)this.processEvents(),i.tick(e,this);this.processEvents()}draw(e,t){const i=this.isLoaded()?this.drawLogic:this.drawLoaderLogic;for(const s of i)s.draw(e,this,t)}}const M=1e3/60;class C{constructor(){this.timestamp=0,this.goodSamples=0,this.timings=[],this.lastGoodAverage=M}updateTimings(){const e=performance.now();if(this.timestamp<=0)return void(this.timestamp=e);const t=e-this.timestamp;this.timestamp=e,t>20.1||(this.timings.length>=60&&this.timings.shift(),this.timings.length>0&&(Math.abs(this.timings[this.timings.length-1]-t)>6||Math.abs(this.averageRateRaw()-t)>6?this.goodSamples=0:this.goodSamples+=1),this.timings.push(t))}averageRateRaw(){let e=0;for(const t of this.timings)e+=t;return e/this.timings.length}averageRate(){return this.hasEnoughSamples()&&(this.lastGoodAverage=this.averageRateRaw()),this.lastGoodAverage}shouldLerp(){const e=this.averageRate();return Math.abs(e-M)>1}hasEnoughSamples(){return this.goodSamples>60}reset(){this.timestamp=0,this.goodSamples=0,this.timings=[]}}class P{constructor(e,t){this.currentScene=new _,this.pendingSceneFunc=null,this.vsyncRate=new C,this.lastTick=performance.now(),this.tickQueue=0,this.framesSinceTickLag=0,this.doDraw=!1,this.doLerp=!1,this.running=!1,this.broken=!1,this.errorText="",this.singleton=t,this.gameInput=new T,this.gameRenderer=new v(e),window.addEventListener("unhandledrejection",(e=>{this.handleError(e.reason,"Unhandled Promise rejection"),e.preventDefault()}))}run(){if(this.running)throw new Error("run() already called");this.running=!0,this.lastTick=performance.now(),this.tickQueue=0,requestAnimationFrame(this.timerUpdate.bind(this))}scene(){return this.currentScene}setScene(e){this.pendingSceneFunc=e}input(){return this.gameInput}renderer(){return this.gameRenderer}timerUpdate(){try{this.vsyncRate.updateTimings(),null!==this.pendingSceneFunc&&(this.currentScene=this.pendingSceneFunc(),this.pendingSceneFunc=null),this.updateTicks(),this.updateDraw(),this.running&&!this.broken&&requestAnimationFrame(this.timerUpdate.bind(this))}catch(e){this.handleError(e)}this.errorText.length>0&&this.showError()}updateTicks(){const e=performance.now();for(this.tickQueue+=e-this.lastTick,this.lastTick=e;this.tickQueue>=M&&null===this.pendingSceneFunc;){this.gameInput.newFrame(),this.currentScene.tick(this),this.framesSinceTickLag++,this.doDraw=!0,this.tickQueue-=M;const t=performance.now();if(t-e>33.333333333333336){this.tickQueue=0,this.lastTick=t,this.framesSinceTickLag=0;break}}this.doLerp=this.vsyncRate.shouldLerp()&&this.framesSinceTickLag>=4}updateDraw(){if(!this.doDraw)return;let e;this.doLerp?e=this.tickQueue/M:(e=1,this.doDraw=!1),this.gameRenderer.reset(),this.currentScene.draw(this,e)}handleError(e,t=""){let i="",s="Error reached app toplevel!";t.length>0&&(s+="\n"+t),e instanceof Error?(i=`${e.name}\n${e.message}`,s+="\n"+e.stack??`${e.name}: ${e.message}`):(i="Unknown error occurred.",s+="\n"+String(e)),console.error(s),this.errorText+=i+"\n",this.broken=!0}showError(){if(!this.errorText)return;const e=this.gameRenderer.canvas(),[t,i]=[32,32];for(const s of[[1,0],[-1,0],[0,-1],[0,1]])this.gameRenderer.drawText(this.errorText,t+s[0],i+s[1],"14px Consolas","rgb(0, 0, 0, 1.0)",e.width-64);this.gameRenderer.drawText(this.errorText,t,i,"14px Consolas","rgb(255, 255, 255, 1.0)",e.width-64)}}const O=JSON.parse('{"wall":[{"x":0,"y":0,"w":32,"h":32},{"x":32,"y":0,"w":32,"h":32},{"x":64,"y":0,"w":32,"h":32},{"x":96,"y":0,"w":32,"h":32},{"x":128,"y":0,"w":32,"h":32},{"x":160,"y":0,"w":32,"h":32},{"x":192,"y":0,"w":32,"h":32},{"x":224,"y":0,"w":32,"h":32},{"x":0,"y":32,"w":32,"h":32},{"x":32,"y":32,"w":32,"h":32},{"x":64,"y":32,"w":32,"h":32},{"x":96,"y":32,"w":32,"h":32},{"x":128,"y":32,"w":32,"h":32},{"x":160,"y":32,"w":32,"h":32},{"x":192,"y":32,"w":32,"h":32},{"x":224,"y":32,"w":32,"h":32}],"floor":[{"x":0,"y":64,"w":32,"h":32},{"x":64,"y":64,"w":32,"h":32},{"x":128,"y":64,"w":32,"h":32},{"x":192,"y":64,"w":32,"h":32}],"dropzone":[{"x":32,"y":64,"w":32,"h":32},{"x":96,"y":64,"w":32,"h":32},{"x":160,"y":64,"w":32,"h":32},{"x":224,"y":64,"w":32,"h":32}],"bg":[{"x":0,"y":96,"w":32,"h":32},{"x":32,"y":96,"w":32,"h":32},{"x":64,"y":96,"w":32,"h":32},{"x":96,"y":96,"w":32,"h":32}],"playerDown":[{"x":0,"y":160,"w":32,"h":32},{"x":32,"y":160,"w":32,"h":32},{"x":0,"y":160,"w":32,"h":32},{"x":64,"y":160,"w":32,"h":32}],"playerRight":[{"x":96,"y":160,"w":32,"h":32},{"x":128,"y":160,"w":32,"h":32},{"x":96,"y":160,"w":32,"h":32},{"x":160,"y":160,"w":32,"h":32}],"playerLeft":[{"x":0,"y":192,"w":32,"h":32},{"x":32,"y":192,"w":32,"h":32},{"x":0,"y":192,"w":32,"h":32},{"x":64,"y":192,"w":32,"h":32}],"playerUp":[{"x":96,"y":192,"w":32,"h":32},{"x":128,"y":192,"w":32,"h":32},{"x":160,"y":192,"w":32,"h":32},{"x":192,"y":192,"w":32,"h":32}],"playerHmm":{"x":192,"y":160,"w":32,"h":32},"playerWin":{"x":224,"y":192,"w":32,"h":32},"playerHead":{"x":0,"y":128,"w":32,"h":32},"crate":[{"x":0,"y":224,"w":32,"h":32},{"x":32,"y":224,"w":32,"h":32},{"x":64,"y":224,"w":32,"h":32},{"x":96,"y":224,"w":32,"h":32}],"confetti":[{"x":224,"y":160,"w":8,"h":8},{"x":240,"y":160,"w":8,"h":8},{"x":232,"y":168,"w":8,"h":8},{"x":248,"y":168,"w":8,"h":8},{"x":224,"y":176,"w":8,"h":8}]}');var E=n.t(O,2);const R=E;class I{constructor(e,t,i,s=0,n=0){this.canvas=null,this.image=new u("res/GameAtlas32.png"),this.movementMode=e.singleton.preferences.backgroundMovement,0!==this.movementMode?(this.scrollSpeed=i-s*n,this.decelRate=0,this.decelTime=0):(this.scrollSpeed=i,this.decelRate=s,this.decelTime=n),t.addEventHandler("preferencesChanged",(e=>this.preferencesChanged(e)))}preferencesChanged(e){this.movementMode=e.backgroundMovement}createCanvas(){if(this.canvas||!u.allLoaded())return;const e=[],t=R.bg[0].w,i=R.bg[0].h;for(let t=0;t<1024;++t)e.push(Math.random()<.3);const s=new OffscreenCanvas(32*t,32*i),n=s.getContext("2d");if(!n)throw new Error("Offscreen canvas context failed");const o=Math.ceil(s.width/t)+1,a=Math.ceil(s.height/i)+1;for(let t=0;t<a;++t)for(let i=0;i<o;++i){let s=(i+t)%2?1:0;const[o,a]=[i%32,t%32];e[o+32*a]&&(s+=2);const h=R.bg[s];n.drawImage(this.image.sharedData().image(),h.x,h.y,h.w,h.h,i*h.w,t*h.h,h.w,h.h)}this.canvas=s}tick(e,t){const i=e.singleton;this.decelTime>0&&(this.decelTime--,this.scrollSpeed=Math.max(0,this.scrollSpeed-this.decelRate)),i.bgScroll+=this.scrollSpeed}draw(e,t,i){if(this.createCanvas(),!this.canvas)return;const s=e.singleton,n=e.renderer(),[o,a]=[n.canvas().width,n.canvas().height],h=Math.ceil(o/this.canvas.width)+1,r=Math.ceil(a/this.canvas.height)+1,c=n.context();let f=0;2!==this.movementMode&&(f=L(s.bgScroll-this.scrollSpeed,s.bgScroll,i));const d=f%this.canvas.height;for(let e=0;e<r;++e)for(let t=0;t<h;++t)c.drawImage(this.canvas,Math.floor(t*this.canvas.width-d),Math.floor(e*this.canvas.height-d))}}class D{constructor(e,t,i,s){this.x=e,this.y=t,this.originalX=e,this.lineHeight=s.lineHeight,this.wrapWidth=i}advance(e){this.x+=e.xAdvance}newLine(){this.x=this.originalX,this.y+=this.lineHeight}}class F{constructor(e){this.x=0,this.y=0,this.w=0,this.h=0,this.xOffset=0,this.yOffset=0,this.xAdvance=0,this.page=0,Object.assign(this,e)}}class N{constructor(e){if(this.chars={},this.lineHeight=e.common.lineHeight,this.pages=e.pages.map((e=>new u(e))),this.pages.length<=0)throw new Error("No texture pages defined in font descriptor");for(const t of e.chars)this.chars[t.id]=new F({x:t.x,y:t.y,w:t.width,h:t.height,xOffset:t.xoffset,yOffset:t.yoffset,xAdvance:t.xadvance,page:t.page})}getChar(e){return this.chars[e]??this.chars[63]??new F}readChar(e,t){switch(e){case 10:return t.newLine(),null;case 13:return null}const i=this.getChar(e);return t.x+i.xOffset+i.w>t.originalX+t.wrapWidth&&t.newLine(),i}printChar(e,t,i){const s=this.pages[e.page];i.drawSprite(s,{x:e.x,y:e.y,w:e.w,h:e.h},t.x+e.xOffset,t.y+e.yOffset)}measureText(e){const t=new D(0,0,1/0,this),i=e.split(" "),s=this.getChar(32);for(const e of i){const i=Array.from(e);for(const e of i){const i=e.codePointAt(0)??0,s=this.readChar(i,t);s&&t.advance(s)}t.advance(s)}return t.x-s.xAdvance}drawText(e,t,i,s,n=1/0,o=Number.MAX_SAFE_INTEGER){const a=new D(i,s,n,this),h=t.split(" "),r=this.getChar(32);let c=0;for(const t of h){const s=Array.from(t);let h=a.x;for(const e of s){const t=e.codePointAt(0)??0,s=this.getChar(t);if(h+s.xOffset+s.w>i+n){a.newLine(),c++;break}h+=s.xAdvance}if(c>=o)break;for(const t of s){const i=t.codePointAt(0)??0,s=this.readChar(i,a);s&&(this.printChar(s,a,e),a.advance(s))}a.advance(r)}}drawTextCentered(e,t,i,s,n=1/0,o=Number.MAX_SAFE_INTEGER){const a=this.measureText(t);this.drawText(e,t,i-a/2,s,n,o)}drawTextRight(e,t,i,s,n=1/0,o=Number.MAX_SAFE_INTEGER){const a=this.measureText(t);this.drawText(e,t,i-a,s,n,o)}}class W extends _{constructor(e){super(),this.highestPriority=Number.MIN_SAFE_INTEGER,this.focused=null,this.newFocused=null,this.input=e}tick(e){this.focused&&this.isLoaded()&&this.focused.focusTick(e,this),super.tick(e),this.focused=this.newFocused,this.newFocused=null,this.highestPriority=Number.MIN_SAFE_INTEGER}requestFocus(e,t){this.highestPriority<=t&&(this.highestPriority=t,this.newFocused=e)}focusedItem(){return this.focused}focusedInput(e){return e===this.focused?this.input:null}}class j{constructor(e){this.scene=e}keepActive(e){this.scene.requestFocus(this,e)}focused(){return this.scene.focusedItem()===this}focusedInput(){return this.scene.focusedInput(this)}getScene(){return this.scene}}function H(e,t,i,s){return{x:e,y:t,text:(e,t)=>i(e,t),alignment:0,maxWidth:-1,maxLines:1,onActivate:()=>{},onAdjust:(e,t,i)=>{s(e,t,i);const n=i.singleton.preferences;t.getScene().pushEvent("preferencesChanged",n),n.toLocalStorage()}}}const B={width:640,height:288,buttons:[H(64,64,((e,t)=>`Key Repeat Delay: ${t.singleton.preferences.repeatDelay}`),((e,t,i)=>{const s=i.singleton.preferences;s.repeatDelay=k(s.repeatDelay+e,15,60)})),H(64,96,((e,t)=>`Key Repeat Rate: ${t.singleton.preferences.repeatRate}`),((e,t,i)=>{const s=i.singleton.preferences;s.repeatRate=k(s.repeatRate+e,2,15)})),H(64,128,((e,t)=>`Background Movement: ${function(e){switch(e){case 0:return"Full";case 1:return"Reduced";case 2:return"Off";default:throw new Error("Bad enum")}}(t.singleton.preferences.backgroundMovement)}`),((e,t,i)=>{const s=i.singleton.preferences;s.backgroundMovement=(s.backgroundMovement+3+e)%3})),H(64,160,((e,t)=>`Deadlock Analysis: ${function(e){switch(e){case 0:return"None";case 1:return"Static Corners/Edges";default:throw new Error("Bad enum")}}(t.singleton.preferences.analysis)}`),((e,t,i)=>{const s=i.singleton.preferences;s.analysis=(s.analysis+2+e)%2})),H(64,192,((e,t)=>`Analysis Action: ${function(e){switch(e){case 0:return"Show Deadlocks";case 1:return"Prevent Deadlocks";case 2:return"Show And Prevent Deadlocks";default:throw new Error("Bad enum")}}(t.singleton.preferences.analysisAction)}`),((e,t,i)=>{const s=i.singleton.preferences;s.analysisAction=(s.analysisAction+3+e)%3})),{x:0,y:256,text:()=>"Back",alignment:1,maxWidth:-1,maxLines:1,onActivate:e=>{e.back()},onAdjust:()=>{}}],labels:[{x:0,y:16,alignment:1,maxWidth:-1,maxLines:1,text:()=>"Game Settings"}]},U={width:640,height:288,buttons:[{x:0,y:160,text:e=>e.isIngame()?"Continue":"Close This Menu",alignment:1,maxWidth:-1,maxLines:1,onActivate:e=>{e.close()},onAdjust:()=>{}},{x:0,y:192,text:e=>e.isIngame()?"Restart":"Play Level",alignment:1,maxWidth:-1,maxLines:1,onActivate:(e,t)=>{t.setScene((()=>ue(t)))},onAdjust:()=>{}},{x:0,y:224,text:()=>"Settings",alignment:1,maxWidth:-1,maxLines:1,onActivate:(e,t)=>{e.enterMenu(B)},onAdjust:()=>{}},{x:0,y:256,text:()=>"Main Menu",alignment:1,maxWidth:-1,maxLines:1,onActivate:(e,t)=>{t.setScene((()=>Fe(t)))},onAdjust:()=>{}}],labels:[{x:0,y:16,alignment:1,maxWidth:-1,maxLines:1,text:(e,t)=>`Levelset: ${t.singleton.getLevelStrings().collection}`},{x:16,y:48,alignment:0,maxWidth:608,maxLines:1,text:(e,t)=>t.singleton.getLevelStrings().name},{x:16,y:80,alignment:0,maxWidth:608,maxLines:2,text:(e,t)=>`by ${t.singleton.getLevelStrings().author}`}]},$=JSON.parse('{"title":{"x":1,"y":1,"w":644,"h":150},"arrowRight":{"x":1,"y":161,"w":12,"h":22},"arrowLeft":{"x":19,"y":161,"w":12,"h":22},"arrowUp":{"x":33,"y":161,"w":20,"h":14},"arrowDown":{"x":33,"y":177,"w":20,"h":14},"starWhite":[{"x":65,"y":161,"w":14,"h":12},{"x":81,"y":161,"w":14,"h":12}],"starBlack":[{"x":65,"y":175,"w":14,"h":12},{"x":81,"y":175,"w":14,"h":12}],"hand":{"x":105,"y":161,"w":27,"h":30}}');var z=n.t($,2);const K=JSON.parse('{"pages":["res/Pixel12x10_0.png"],"chars":[{"id":32,"x":119,"y":104,"width":4,"height":2,"xoffset":-2,"yoffset":14,"xadvance":12,"page":0,"chnl":15},{"id":33,"x":252,"y":14,"width":3,"height":13,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":34,"x":190,"y":94,"width":7,"height":6,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":35,"x":132,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":36,"x":144,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":37,"x":156,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":38,"x":168,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":39,"x":252,"y":38,"width":3,"height":6,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":40,"x":8,"y":88,"width":6,"height":13,"xoffset":1,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":41,"x":15,"y":88,"width":6,"height":13,"xoffset":3,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":42,"x":96,"y":84,"width":11,"height":10,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":43,"x":76,"y":101,"width":9,"height":9,"xoffset":0,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":44,"x":252,"y":45,"width":3,"height":5,"xoffset":2,"yoffset":9,"xadvance":7,"page":0,"chnl":15},{"id":45,"x":96,"y":105,"width":9,"height":3,"xoffset":0,"yoffset":5,"xadvance":11,"page":0,"chnl":15},{"id":46,"x":250,"y":94,"width":3,"height":3,"xoffset":2,"yoffset":9,"xadvance":7,"page":0,"chnl":15},{"id":47,"x":174,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":48,"x":36,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":49,"x":132,"y":70,"width":10,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":50,"x":60,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":51,"x":72,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":52,"x":84,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":53,"x":96,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":54,"x":108,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":55,"x":120,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":56,"x":96,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":57,"x":144,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":58,"x":252,"y":28,"width":3,"height":9,"xoffset":3,"yoffset":2,"xadvance":8,"page":0,"chnl":15},{"id":59,"x":74,"y":88,"width":5,"height":12,"xoffset":0,"yoffset":2,"xadvance":7,"page":0,"chnl":15},{"id":60,"x":88,"y":88,"width":7,"height":11,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":61,"x":158,"y":94,"width":9,"height":7,"xoffset":0,"yoffset":3,"xadvance":11,"page":0,"chnl":15},{"id":62,"x":80,"y":88,"width":7,"height":11,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":63,"x":216,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":64,"x":228,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":65,"x":240,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":66,"x":0,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":67,"x":12,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":68,"x":24,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":69,"x":36,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":70,"x":48,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":71,"x":60,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":72,"x":72,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":73,"x":246,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":74,"x":96,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":75,"x":108,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":76,"x":120,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":77,"x":132,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":78,"x":144,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":79,"x":156,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":80,"x":132,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":81,"x":180,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":82,"x":192,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":83,"x":204,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":84,"x":216,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":85,"x":228,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":86,"x":240,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":87,"x":0,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":88,"x":12,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":89,"x":24,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":90,"x":36,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":91,"x":22,"y":88,"width":5,"height":13,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":92,"x":214,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":93,"x":28,"y":88,"width":5,"height":13,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":94,"x":180,"y":94,"width":9,"height":6,"xoffset":0,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":95,"x":226,"y":94,"width":11,"height":3,"xoffset":-1,"yoffset":10,"xadvance":12,"page":0,"chnl":15},{"id":96,"x":208,"y":94,"width":5,"height":5,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":97,"x":120,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":98,"x":132,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":99,"x":132,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":100,"x":156,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":101,"x":144,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":102,"x":164,"y":70,"width":9,"height":13,"xoffset":1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":103,"x":192,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":104,"x":204,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":105,"x":58,"y":88,"width":7,"height":12,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":106,"x":85,"y":0,"width":10,"height":16,"xoffset":-1,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":107,"x":228,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":108,"x":222,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":109,"x":156,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":110,"x":168,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":111,"x":180,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":112,"x":36,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":113,"x":48,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":114,"x":228,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":115,"x":192,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":116,"x":84,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":117,"x":204,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":118,"x":108,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":119,"x":12,"y":102,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":120,"x":0,"y":102,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":121,"x":120,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":122,"x":240,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":123,"x":59,"y":0,"width":8,"height":17,"xoffset":0,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":124,"x":81,"y":0,"width":3,"height":17,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":125,"x":68,"y":0,"width":8,"height":17,"xoffset":1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":126,"x":168,"y":94,"width":11,"height":6,"xoffset":-1,"yoffset":4,"xadvance":12,"page":0,"chnl":15},{"id":160,"x":114,"y":105,"width":4,"height":2,"xoffset":-2,"yoffset":14,"xadvance":5,"page":0,"chnl":15},{"id":161,"x":252,"y":0,"width":3,"height":13,"xoffset":3,"yoffset":3,"xadvance":8,"page":0,"chnl":15},{"id":162,"x":216,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":163,"x":144,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":164,"x":106,"y":95,"width":9,"height":9,"xoffset":0,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":165,"x":156,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":166,"x":77,"y":0,"width":3,"height":17,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":167,"x":24,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":168,"x":106,"y":105,"width":7,"height":3,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":169,"x":168,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":170,"x":116,"y":94,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":171,"x":147,"y":94,"width":10,"height":8,"xoffset":-1,"yoffset":3,"xadvance":11,"page":0,"chnl":15},{"id":172,"x":198,"y":94,"width":9,"height":5,"xoffset":0,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":174,"x":180,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":175,"x":238,"y":94,"width":11,"height":3,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":176,"x":66,"y":101,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":177,"x":46,"y":88,"width":11,"height":12,"xoffset":-1,"yoffset":0,"xadvance":12,"page":0,"chnl":15},{"id":178,"x":126,"y":94,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":179,"x":96,"y":95,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":180,"x":214,"y":94,"width":5,"height":5,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":181,"x":192,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":182,"x":204,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":183,"x":252,"y":84,"width":3,"height":3,"xoffset":3,"yoffset":4,"xadvance":8,"page":0,"chnl":15},{"id":184,"x":220,"y":94,"width":5,"height":5,"xoffset":0,"yoffset":11,"xadvance":7,"page":0,"chnl":15},{"id":185,"x":86,"y":100,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":186,"x":46,"y":101,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":187,"x":136,"y":94,"width":10,"height":8,"xoffset":0,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":188,"x":216,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":189,"x":228,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":190,"x":240,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":191,"x":0,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":192,"x":12,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":193,"x":24,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":194,"x":36,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":195,"x":48,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":196,"x":60,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":197,"x":72,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":198,"x":84,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":199,"x":12,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":200,"x":96,"y":70,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":201,"x":108,"y":70,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":202,"x":120,"y":70,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":203,"x":108,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":204,"x":198,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":205,"x":0,"y":88,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":206,"x":238,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":207,"x":230,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":208,"x":120,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":209,"x":180,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":210,"x":192,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":211,"x":204,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":212,"x":216,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":213,"x":228,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":214,"x":240,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":215,"x":56,"y":101,"width":9,"height":9,"xoffset":0,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":216,"x":0,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":217,"x":12,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":218,"x":24,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":219,"x":48,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":220,"x":156,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":221,"x":168,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":222,"x":154,"y":70,"width":9,"height":13,"xoffset":0,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":223,"x":143,"y":70,"width":10,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":224,"x":180,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":225,"x":192,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":226,"x":204,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":227,"x":84,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":228,"x":168,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":229,"x":48,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":230,"x":216,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":231,"x":60,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":232,"x":72,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":233,"x":84,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":234,"x":96,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":235,"x":132,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":236,"x":206,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":237,"x":190,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":238,"x":182,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":239,"x":66,"y":88,"width":7,"height":12,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":240,"x":108,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":241,"x":120,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":242,"x":144,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":243,"x":168,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":244,"x":180,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":245,"x":240,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":246,"x":0,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":247,"x":36,"y":101,"width":9,"height":9,"xoffset":0,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":248,"x":34,"y":88,"width":11,"height":12,"xoffset":-1,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":249,"x":12,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":250,"x":24,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":251,"x":60,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":252,"x":72,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":253,"x":0,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":254,"x":48,"y":0,"width":10,"height":17,"xoffset":0,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":255,"x":36,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":338,"x":96,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":339,"x":24,"y":102,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":8364,"x":108,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":12288,"x":124,"y":104,"width":4,"height":2,"xoffset":-2,"yoffset":14,"xadvance":16,"page":0,"chnl":15}],"kernings":[],"info":{"face":"Pixel12x10","size":16,"bold":0,"italic":0,"charset":"","unicode":1,"stretchH":100,"smooth":0,"aa":1,"padding":[1,0,0,1],"spacing":[1,1],"outline":0},"common":{"lineHeight":20,"base":12,"scaleW":256,"scaleH":256,"pages":1,"packed":0,"alphaChnl":0,"redChnl":4,"greenChnl":4,"blueChnl":4}}');var G=n.t(K,2);const X=z;class Y extends j{constructor(e,t){super(t),this.picture=new u("res/TitleAtlas.png"),this.isOpen=!1,this.cursorIndex=0,this.currentMenu=U,this.menuStack=[],this.font=new N(G),this.preferencesChanged(e,e.singleton.preferences),t.addEventHandler("openMenu",(()=>{this.open()})),t.addEventHandler("preferencesChanged",(t=>this.preferencesChanged(e,t)))}preferencesChanged(e,t){e.input().setDefaultRepeatRate(t.repeatDelay,t.repeatRate)}open(){this.isOpen=!0,this.currentMenu=U,this.menuStack=[],this.cursorIndex=0}close(){this.isOpen=!1}back(){const e=this.menuStack.pop();void 0!==e?(this.currentMenu=e.menu,this.cursorIndex=e.index):this.close()}enterMenu(e){this.menuStack.push({menu:this.currentMenu,index:this.cursorIndex}),this.currentMenu=e,this.cursorIndex=0}isIngame(){return this.getScene()instanceof ge}focusTick(e,t){const i=e.input();if(e.input().justPressed("menu"))return void this.back();const s=i.autoRepeatNewest(["left","right","up","down"]),n=this.currentMenu.buttons[this.cursorIndex];switch(s){case"up":this.cursorIndex--;break;case"down":this.cursorIndex++;break;case"left":n&&n.onAdjust(-1,this,e);break;case"right":n&&n.onAdjust(1,this,e)}this.cursorIndex=(this.cursorIndex+this.currentMenu.buttons.length)%this.currentMenu.buttons.length,i.justPressed("accept")&&n&&n.onActivate(this,e)}tick(e,t){this.isOpen&&this.keepActive(100)}draw(e,t,i){if(!this.isOpen)return;const s=e.renderer(),[n,o]=[s.canvas().width,s.canvas().height],a=this.currentMenu.width,h=this.currentMenu.height,r=S(a,n),c=S(h,o);s.drawRect(r,c,a,h,"rgb(22, 26, 55, 0.85)"),s.drawRectOutline(r-.5,c-.5,a+1,h+1,"rgb(224, 224, 224, 0.7)");const f=(t,i)=>{let n=r+t.x;const o=t.maxWidth>0?t.maxWidth:a-t.x,h=t.text(this,e);1===t.alignment&&(n+=S(this.font.measureText(h),a)),this.font.drawText(s,h,n,c+t.y,o,t.maxLines),i&&s.drawSprite(this.picture,X.arrowRight,n-24,c+t.y-4)};for(const e of this.currentMenu.labels)f(e,!1);for(let e=0;e<this.currentMenu.buttons.length;++e)f(this.currentMenu.buttons[e],this.cursorIndex===e)}}var J,V,q,Q;function Z(e){switch(e){case J.Left:return{x:-1,y:0};case J.Right:return{x:1,y:0};case J.Up:return{x:0,y:-1};case J.Down:return{x:0,y:1}}}function ee(e){switch(e){case J.Left:return J.Right;case J.Right:return J.Left;case J.Up:return J.Down;case J.Down:return J.Up}}!function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down"}(J||(J={})),function(e){e[e.Player=0]="Player",e[e.Crate=1]="Crate"}(V||(V={}));class te{constructor(e,t,i){this.oldLerpTimer=0,this.lerpTimer=0,this.lastMoveTimer=0,this.picture=null,this.slice=new w(0,0,0,0),this.solid=!0,this.x=e,this.y=t,this.oldX=e,this.oldY=t,this.board=i}getPosition(){return{x:this.x,y:this.y}}setPosition(e,t){this.oldX=this.x,this.oldY=this.y,this.x=e,this.y=t,this.oldLerpTimer=1,this.lerpTimer=1,this.lastMoveTimer=1}lerpToPosition(e,t){const i=Math.max(this.lastMoveTimer,.15);this.oldX=L(e,this.x,i),this.oldY=L(t,this.y,i),this.x=e,this.y=t,this.oldLerpTimer=0,this.lerpTimer=0,this.lastMoveTimer=0}getBoardPosition(){return{x:this.x*this.board.tileWidth+this.board.x,y:this.y*this.board.tileHeight+this.board.y}}isTileFree(e,t){return this.board.tile(e,t)!==q.Wall}isTokenFree(e,t){const i=this.board.tokensForTile(e,t);for(const e of i)if(e.solid)return!1;return!0}isFree(e,t){return this.isTileFree(e,t)&&this.isTokenFree(e,t)}lerpTick(){this.oldLerpTimer=this.lerpTimer,this.lerpTimer=k(this.lerpTimer+.2,0,1),this.lastMoveTimer=k(this.lastMoveTimer+.02,0,1)}draw(e,t){if(!this.picture)return;const i=this.board.boardToWorldCoords(this.x,this.y),s=this.board.boardToWorldCoords(this.oldX,this.oldY),n=L(this.oldLerpTimer,this.lerpTimer,t),o=Math.pow(n,.3),a=L(s.x,i.x,o),h=L(s.y,i.y,o);this.picture&&e.drawSprite(this.picture,this.slice,a,h)}}class ie{constructor(e,t,i,s){this.start={x:e,y:t},this.delta=Z(i),this.check=Z(s)}}class se{constructor(e){this.analysisMode=0,this.analysisAction=0,this.board=e,this.restricted=new Array(e.width*e.height),this.restricted.fill(!1)}setRestricted(e,t){this.board.posInRange(e,t)&&(this.restricted[e+t*this.board.width]=!0)}isBlocked(e,t){return this.board.tile(e,t)===q.Wall}recomputerStaticEdges(e){const t=Math.max(this.board.width,this.board.height);e:for(const i of e){let e=i.start.x,s=i.start.y,n=0;t:for(;n<t;){e+=i.delta.x,s+=i.delta.y;const t=this.board.tile(e,s),o=this.board.tile(e+i.check.x,s+i.check.y);if(t===q.Wall||!this.board.posInRange(e,s)||this.isRestricted(e,s))break t;if(t===q.Dropzone||o!==q.Wall)continue e;n++}e=i.start.x,s=i.start.y;for(let t=0;t<n;++t)e+=i.delta.x,s+=i.delta.y,this.setRestricted(e,s)}}recomputeStaticCorners(){const e=[];function t(t,i,s,n){e.push(new ie(t,i,ee(s),n)),e.push(new ie(t,i,ee(n),s))}for(let e=0;e<this.board.height;++e)for(let i=0;i<this.board.width;++i){if(this.board.tile(i,e)===q.Dropzone)continue;const s=this.isBlocked(i-1,e),n=this.isBlocked(i+1,e),o=this.isBlocked(i,e-1),a=this.isBlocked(i,e+1);let h=!1;s&&o&&(t(i,e,J.Left,J.Up),h=!0),n&&o&&(t(i,e,J.Right,J.Up),h=!0),s&&a&&(t(i,e,J.Left,J.Down),h=!0),n&&a&&(t(i,e,J.Right,J.Down),h=!0),h&&this.setRestricted(i,e)}this.recomputerStaticEdges(e)}recomputeAnalysis(){switch(this.restricted.fill(!1),this.analysisMode){case 0:break;case 1:this.recomputeStaticCorners()}this.board.setDirty()}shouldShowRestricted(){switch(this.analysisAction){case 0:case 2:return!0}return!1}shouldPreventRestricted(){switch(this.analysisAction){case 1:case 2:return!0}return!1}setAnalysisMode(e,t){this.analysisMode=e,this.analysisAction=t,this.recomputeAnalysis()}isRestricted(e,t){return!!this.board.posInRange(e,t)&&this.restricted[this.board.posToIndex(e,t)]}}!function(e){e[e.None=0]="None",e[e.Floor=1]="Floor",e[e.Wall=2]="Wall",e[e.Dropzone=3]="Dropzone"}(q||(q={}));class ne{constructor(e,t,i,s){this.x=0,this.y=0,this.dirty=!0,this.tokens=[],this.tokenPositions=new Map,this.width=e,this.height=t,this.tiles=new Array(e*t),this.tiles.fill(q.None),this.displayTiles=new Array(e*t),this.displayTiles.fill(null),this.picture=i,this.slices=s,this.tileWidth=s.wall[0].w,this.tileHeight=s.wall[0].h,this.tileTokens=new Array(e*t),this.analysis=new se(this);for(let i=0;i<e*t;++i)this.tileTokens[i]=[]}floodFillFloor(e){let t=e;const i=Array(this.width*this.height).fill(!1);for(;t.length>0;){const e=[];for(const s of t){const t=s.y;let n=s.x;if(this.posInRange(n,t)&&this.tile(n,t)!==q.Wall&&!0!==i[n+t*this.width]){for(;n>0&&this.tile(n-1,t)!==q.Wall;)n--;for(;n<this.width&&this.tile(n,t)!==q.Wall;)this.tile(n,t)===q.None&&this.setTile(n,t,q.Floor),i[n+t*this.width]=!0,t>0&&e.push({x:n,y:t-1}),t<this.height-1&&e.push({x:n,y:t+1}),n++}}t=e}}static fromLevel(e,t,i,s){const n=e.tiles,o=e.measureDimensions(),a=new ne(o.x,o.y,t,i),h=[],r=[];for(let e=0;e<o.y;++e){const t=n[e];for(let i=0;i<o.x;++i){const s=t[i];let n=q.None;switch(s){case void 0:case" ":case"@":case"$":n=q.None;break;case"#":n=q.Wall;break;case".":case"+":case"*":n=q.Dropzone;break;default:throw new Error(`Unrecognized tile character: ${s}`)}switch(a.setTile(i,e,n),s){case"@":case"+":r.push({x:i,y:e,tokenType:V.Player});break;case"$":case"*":r.push({x:i,y:e,tokenType:V.Crate})}}}for(const e of r)h.push({x:e.x,y:e.y});return s(a,r),a.floodFillFloor(h),a}neighborBits(e,t){let i=0;return this.tile(e,t-1)===q.Wall&&(i+=1),this.tile(e+1,t)===q.Wall&&(i+=2),this.tile(e,t+1)===q.Wall&&(i+=4),this.tile(e-1,t)===q.Wall&&(i+=8),i}updateDisplayTiles(){this.dirty=!1;const e=this.analysis.shouldShowRestricted();let t=0;for(let i=0;i<this.height;++i)for(let s=0;s<this.width;++s){const n=this.tile(s,i),o=e&&this.analysis.isRestricted(s,i);switch(n){case q.None:this.displayTiles[t]=null;break;case q.Floor:this.displayTiles[t]=this.slices.floor[o?1:0];break;case q.Dropzone:this.displayTiles[t]=this.slices.dropzone[o?1:0];break;case q.Wall:{const e=this.neighborBits(s,i);this.displayTiles[t]=this.slices.wall[e];break}}++t}}addToken(e){if(e.board!==this)throw new Error("Token does not belong to board");const t=e.getPosition();this.tokens.push(e),this.tokenPositions.set(e,{x:Math.round(t.x),y:Math.round(t.y)}),this.addTokenToTile(e,t.x,t.y)}getTokens(){return this.tokens}tokensForTile(e,t){return this.posInRange(e,t)?this.tileTokens[this.posToIndex(e,t)]:[]}removeTokenFromTile(e,t,i){if(!this.posInRange(t,i))return;const s=this.tileTokens[this.posToIndex(t,i)],n=s.indexOf(e);n>-1&&s.splice(n,1)}addTokenToTile(e,t,i){this.posInRange(t,i)&&this.tileTokens[this.posToIndex(t,i)].push(e)}moveToken(e,t,i){const s=this.tokenPositions.get(e);s&&this.removeTokenFromTile(e,s.x,s.y),this.addTokenToTile(e,t,i),this.tokenPositions.set(e,{x:Math.round(t),y:Math.round(i)})}posToIndex(e,t){return Math.round(e)+Math.round(t)*this.width}posInRange(e,t){const i=Math.round(e),s=Math.round(t);return!(i<0||i>=this.width||s<0||s>=this.height)}tile(e,t){return this.posInRange(e,t)?this.tiles[this.posToIndex(e,t)]:q.None}setTile(e,t,i){if(!this.posInRange(e,t))throw new Error("Tile coordinates out of range");this.tiles[this.posToIndex(e,t)]=i,this.dirty=!0}setDirty(){this.dirty=!0}boardToWorldCoords(e,t){return{x:e*this.tileWidth+this.x,y:t*this.tileHeight+this.y}}getAnalysis(){return this.analysis}lerpTick(){for(const e of this.tokens)e.lerpTick()}draw(e,t){this.dirty&&this.updateDisplayTiles();let i=0;for(let t=0;t<this.height;++t)for(let s=0;s<this.width;++s){const n=this.displayTiles[i];n&&e.drawSprite(this.picture,n,this.x+s*this.tileWidth,this.y+t*this.tileHeight),++i}for(const i of this.tokens)i.draw(e,t)}}class oe extends te{constructor(e,t,i){super(e,t,i);const s=i.tile(e,t);this.picture=i.picture,this.theme=i.slices,this.slice=this.theme.crate[s===q.Dropzone?1:0]}tryPush(e,t){const i=this.getPosition(),s=Z(e),n=i.x+s.x,o=i.y+s.y;if(this.isFree(n,o)){if(t&&this.board.getAnalysis().isRestricted(n,o))return 2;this.board.moveToken(this,n,o),this.lerpToPosition(n,o);const e=this.board.tile(n,o);return this.slice=this.theme.crate[e===q.Dropzone?1:0],0}return 1}tryPull(e,t,i){const s=this.getPosition(),n=Z(t),o=s.x+n.x,a=s.y+n.y;if(!this.isTileFree(o,a))return 1;const h=this.board.tokensForTile(o,a);for(const t of h)if(t.solid&&t!==e)return 1;if(i&&this.board.getAnalysis().isRestricted(o,a))return 2;this.board.moveToken(this,o,a),this.lerpToPosition(o,a);const r=this.board.tile(o,a);return this.slice=this.theme.crate[r===q.Dropzone?1:0],0}}!function(e){e[e.Forward=0]="Forward",e[e.Backward=1]="Backward"}(Q||(Q={}));class ae extends te{constructor(e,t,i){super(e,t,i),this.walkFrame=0,this.picture=i.picture,this.theme=i.slices,this.slice=this.theme.playerDown[0]}walkAnimation(e){switch(e){case J.Left:this.slice=this.theme.playerLeft[this.walkFrame];break;case J.Right:this.slice=this.theme.playerRight[this.walkFrame];break;case J.Up:this.slice=this.theme.playerUp[this.walkFrame];break;case J.Down:this.slice=this.theme.playerDown[this.walkFrame]}}winAnimation(){this.slice=this.theme.playerWin}hmmAnimation(){this.slice=this.theme.playerHmm}doWalk(e,t,i){this.board.moveToken(this,e,t),this.lerpToPosition(e,t),i===Q.Forward?this.walkFrame=(this.walkFrame+1)%4:this.walkFrame=(this.walkFrame+3)%4}tryWalk(e,t=Q.Forward){const i=this.getPosition(),s=Z(e),n=i.x+s.x,o=i.y+s.y;let a=!1;return this.isFree(n,o)&&(this.doWalk(n,o,t),a=!0),this.walkAnimation(t===Q.Forward?e:ee(e)),a}tryPush(e,t){const i=this.getPosition(),s=Z(e),n=i.x+s.x,o=i.y+s.y;let a=!1,h=!1;const r=this.board.tokensForTile(n,o);for(const i of r)if(i instanceof oe){const s=i.tryPush(e,t);0===s?(this.doWalk(n,o,Q.Forward),a=!0):2===s&&(h=!0);break}return h?this.hmmAnimation():this.walkAnimation(e),a}tryPull(e,t){const i=this.getPosition(),s=Z(e),n=i.x-s.x,o=i.y-s.y,a=i.x+s.x,h=i.y+s.y;let r=!1,c=!1;const f=this.board.tokensForTile(n,o);if(this.isFree(a,h))for(const i of f)if(i instanceof oe){const s=i.tryPull(this,e,t);0===s?(this.doWalk(a,h,Q.Backward),r=!0):2===s&&(c=!0);break}return c?this.hmmAnimation():this.walkAnimation(ee(e)),r}}class he{constructor(e,t,i,s){this.x=e,this.y=t,this.oldX=e,this.oldY=t;const n=i+Math.random()*s,o=28*Math.random()+4;this.velX=Math.cos(n)*o,this.velY=-Math.sin(n)*o-2,this.frame=5*Math.random(),this.frameSpeed=.75*Math.random()+.25}tick(){if(this.oldX=this.x,this.oldY=this.y,this.velY+=.125,this.x+=this.velX,this.y+=this.velY,e=this.velX,t=this.velY,Math.sqrt(Math.pow(e,2)+Math.pow(t,2))>2){this.velX*=.95,this.velY*=.95;const e=2*Math.random()*Math.PI,t=.25*Math.random();this.velX+=Math.cos(e)*t,this.velY+=-Math.sin(e)*t}var e,t;this.frame=(this.frame+this.frameSpeed)%5}}class re{constructor(e,t,i,s){this.picture=i,this.theme=s,this.particles=[];for(let i=0;i<100;++i)this.particles.push(new he(0,t,Math.PI/8,Math.PI/2)),this.particles.push(new he(e,t,3*Math.PI/8,Math.PI/2))}tick(){for(const e of this.particles)e.tick()}draw(e,t){for(const i of this.particles){const s=Math.floor(i.frame)%5,n=L(i.oldX,i.x,t),o=L(i.oldY,i.y,t);e.drawSprite(this.picture,this.theme.confetti[s],n,o)}}}const ce=JSON.parse('{"pages":["res/Pixel12x10_Outline_0.png"],"chars":[{"id":32,"x":29,"y":194,"width":8,"height":6,"xoffset":-4,"yoffset":12,"xadvance":12,"page":0,"chnl":15},{"id":33,"x":56,"y":148,"width":7,"height":17,"xoffset":1,"yoffset":-3,"xadvance":8,"page":0,"chnl":15},{"id":34,"x":130,"y":179,"width":11,"height":10,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":35,"x":184,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":36,"x":200,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":37,"x":216,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":38,"x":232,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":39,"x":142,"y":179,"width":7,"height":10,"xoffset":1,"yoffset":-3,"xadvance":8,"page":0,"chnl":15},{"id":40,"x":24,"y":148,"width":10,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":9,"page":0,"chnl":15},{"id":41,"x":35,"y":148,"width":10,"height":17,"xoffset":1,"yoffset":-3,"xadvance":11,"page":0,"chnl":15},{"id":42,"x":154,"y":144,"width":15,"height":14,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":43,"x":216,"y":158,"width":13,"height":13,"xoffset":-2,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":44,"x":194,"y":172,"width":7,"height":9,"xoffset":0,"yoffset":7,"xadvance":7,"page":0,"chnl":15},{"id":45,"x":234,"y":172,"width":13,"height":7,"xoffset":-2,"yoffset":3,"xadvance":11,"page":0,"chnl":15},{"id":46,"x":12,"y":194,"width":7,"height":7,"xoffset":0,"yoffset":7,"xadvance":7,"page":0,"chnl":15},{"id":47,"x":138,"y":129,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":48,"x":144,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":49,"x":80,"y":130,"width":14,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":11,"page":0,"chnl":15},{"id":50,"x":176,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":51,"x":192,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":52,"x":208,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":53,"x":224,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":54,"x":240,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":55,"x":0,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":56,"x":136,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":57,"x":32,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":58,"x":244,"y":158,"width":7,"height":13,"xoffset":1,"yoffset":0,"xadvance":8,"page":0,"chnl":15},{"id":59,"x":120,"y":148,"width":9,"height":16,"xoffset":-2,"yoffset":0,"xadvance":7,"page":0,"chnl":15},{"id":60,"x":142,"y":147,"width":11,"height":15,"xoffset":-1,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":61,"x":86,"y":179,"width":13,"height":11,"xoffset":-2,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":62,"x":130,"y":148,"width":11,"height":15,"xoffset":-1,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":63,"x":128,"y":39,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":64,"x":144,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":65,"x":160,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":66,"x":176,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":67,"x":192,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":68,"x":208,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":69,"x":224,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":70,"x":240,"y":36,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":71,"x":0,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":72,"x":16,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":73,"x":0,"y":148,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":74,"x":48,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":75,"x":64,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":76,"x":80,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":77,"x":96,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":78,"x":112,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":79,"x":128,"y":57,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":80,"x":16,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":81,"x":160,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":82,"x":176,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":83,"x":192,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":84,"x":208,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":85,"x":224,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":86,"x":240,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":87,"x":0,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":88,"x":16,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":89,"x":32,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":90,"x":48,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":91,"x":246,"y":126,"width":9,"height":17,"xoffset":0,"yoffset":-3,"xadvance":9,"page":0,"chnl":15},{"id":92,"x":198,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":93,"x":46,"y":148,"width":9,"height":17,"xoffset":0,"yoffset":-3,"xadvance":9,"page":0,"chnl":15},{"id":94,"x":116,"y":179,"width":13,"height":10,"xoffset":-2,"yoffset":-3,"xadvance":11,"page":0,"chnl":15},{"id":95,"x":202,"y":172,"width":15,"height":7,"xoffset":-3,"yoffset":8,"xadvance":12,"page":0,"chnl":15},{"id":96,"x":164,"y":173,"width":9,"height":9,"xoffset":0,"yoffset":-3,"xadvance":9,"page":0,"chnl":15},{"id":97,"x":186,"y":144,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":98,"x":176,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":99,"x":202,"y":144,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":100,"x":208,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":101,"x":218,"y":144,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":102,"x":124,"y":130,"width":13,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":103,"x":0,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":104,"x":16,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":105,"x":96,"y":148,"width":11,"height":16,"xoffset":-1,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":106,"x":121,"y":0,"width":14,"height":20,"xoffset":-3,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":107,"x":48,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":108,"x":210,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":109,"x":234,"y":144,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":110,"x":0,"y":166,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":111,"x":16,"y":166,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":112,"x":128,"y":93,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":113,"x":144,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":114,"x":80,"y":165,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":115,"x":32,"y":166,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":116,"x":192,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":117,"x":48,"y":166,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":118,"x":170,"y":144,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":119,"x":128,"y":165,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":120,"x":112,"y":165,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":121,"x":240,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":122,"x":96,"y":165,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":123,"x":79,"y":0,"width":12,"height":21,"xoffset":-2,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":124,"x":113,"y":0,"width":7,"height":21,"xoffset":1,"yoffset":-3,"xadvance":8,"page":0,"chnl":15},{"id":125,"x":92,"y":0,"width":12,"height":21,"xoffset":-1,"yoffset":-3,"xadvance":11,"page":0,"chnl":15},{"id":126,"x":100,"y":179,"width":15,"height":10,"xoffset":-3,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":160,"x":20,"y":194,"width":8,"height":6,"xoffset":-4,"yoffset":12,"xadvance":5,"page":0,"chnl":15},{"id":161,"x":248,"y":0,"width":7,"height":17,"xoffset":1,"yoffset":1,"xadvance":8,"page":0,"chnl":15},{"id":162,"x":32,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":163,"x":16,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":164,"x":14,"y":180,"width":13,"height":13,"xoffset":-2,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":165,"x":32,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":166,"x":105,"y":0,"width":7,"height":21,"xoffset":1,"yoffset":-3,"xadvance":8,"page":0,"chnl":15},{"id":167,"x":32,"y":0,"width":15,"height":21,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":168,"x":0,"y":194,"width":11,"height":7,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":169,"x":48,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":170,"x":28,"y":180,"width":13,"height":13,"xoffset":-3,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":171,"x":71,"y":179,"width":14,"height":12,"xoffset":-3,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":172,"x":150,"y":177,"width":13,"height":9,"xoffset":-2,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":174,"x":64,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":175,"x":218,"y":172,"width":15,"height":7,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":176,"x":202,"y":158,"width":13,"height":13,"xoffset":-3,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":177,"x":80,"y":148,"width":15,"height":16,"xoffset":-3,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":178,"x":42,"y":180,"width":13,"height":13,"xoffset":-3,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":179,"x":0,"y":180,"width":13,"height":13,"xoffset":-3,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":180,"x":174,"y":172,"width":9,"height":9,"xoffset":0,"yoffset":-3,"xadvance":9,"page":0,"chnl":15},{"id":181,"x":80,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":182,"x":96,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":183,"x":248,"y":172,"width":7,"height":7,"xoffset":1,"yoffset":2,"xadvance":8,"page":0,"chnl":15},{"id":184,"x":184,"y":172,"width":9,"height":9,"xoffset":-2,"yoffset":9,"xadvance":7,"page":0,"chnl":15},{"id":185,"x":230,"y":158,"width":13,"height":13,"xoffset":-3,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":186,"x":174,"y":158,"width":13,"height":13,"xoffset":-3,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":187,"x":56,"y":180,"width":14,"height":12,"xoffset":-2,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":188,"x":112,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":189,"x":128,"y":111,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":190,"x":144,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":191,"x":160,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":192,"x":176,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":193,"x":192,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":194,"x":208,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":195,"x":224,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":196,"x":240,"y":108,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":197,"x":0,"y":130,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":198,"x":16,"y":130,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":199,"x":16,"y":0,"width":15,"height":21,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":200,"x":32,"y":130,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":201,"x":48,"y":130,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":202,"x":64,"y":130,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":203,"x":152,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":204,"x":174,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":205,"x":12,"y":148,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":206,"x":234,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":207,"x":222,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":208,"x":168,"y":0,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":209,"x":0,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":210,"x":16,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":211,"x":32,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":212,"x":48,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":213,"x":64,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":214,"x":80,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":215,"x":188,"y":158,"width":13,"height":13,"xoffset":-2,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":216,"x":96,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":217,"x":112,"y":22,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":218,"x":128,"y":21,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":219,"x":160,"y":18,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":220,"x":48,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":221,"x":64,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":222,"x":110,"y":130,"width":13,"height":17,"xoffset":-2,"yoffset":-3,"xadvance":11,"page":0,"chnl":15},{"id":223,"x":95,"y":130,"width":14,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":11,"page":0,"chnl":15},{"id":224,"x":80,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":225,"x":96,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":226,"x":112,"y":40,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":227,"x":32,"y":58,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":228,"x":144,"y":54,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":229,"x":64,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":230,"x":64,"y":165,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":231,"x":80,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":232,"x":96,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":233,"x":112,"y":76,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":234,"x":128,"y":75,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":235,"x":0,"y":112,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":236,"x":186,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":237,"x":162,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":238,"x":150,"y":126,"width":11,"height":17,"xoffset":-1,"yoffset":-3,"xadvance":10,"page":0,"chnl":15},{"id":239,"x":108,"y":148,"width":11,"height":16,"xoffset":-1,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":240,"x":144,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":241,"x":160,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":242,"x":192,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":243,"x":224,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":244,"x":240,"y":72,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":245,"x":64,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":246,"x":80,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":247,"x":160,"y":159,"width":13,"height":13,"xoffset":-2,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":248,"x":64,"y":148,"width":15,"height":16,"xoffset":-3,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":249,"x":96,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":250,"x":112,"y":94,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":251,"x":160,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":252,"x":176,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":253,"x":0,"y":0,"width":15,"height":21,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":254,"x":64,"y":0,"width":14,"height":21,"xoffset":-2,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":255,"x":48,"y":0,"width":15,"height":21,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":338,"x":208,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":339,"x":144,"y":163,"width":15,"height":13,"xoffset":-3,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":8364,"x":224,"y":90,"width":15,"height":17,"xoffset":-3,"yoffset":-3,"xadvance":12,"page":0,"chnl":15},{"id":12288,"x":38,"y":194,"width":8,"height":6,"xoffset":-4,"yoffset":12,"xadvance":16,"page":0,"chnl":15}],"kernings":[],"info":{"face":"Pixel12x10","size":16,"bold":0,"italic":0,"charset":"","unicode":1,"stretchH":100,"smooth":0,"aa":1,"padding":[1,0,0,1],"spacing":[1,1],"outline":2},"common":{"lineHeight":20,"base":12,"scaleW":256,"scaleH":256,"pages":1,"packed":0,"alphaChnl":1,"redChnl":0,"greenChnl":0,"blueChnl":0}}');var fe=n.t(ce,2);const de=E;var le;!function(e){e[e.WalkLeft=0]="WalkLeft",e[e.WalkRight=1]="WalkRight",e[e.WalkUp=2]="WalkUp",e[e.WalkDown=3]="WalkDown",e[e.PushLeft=4]="PushLeft",e[e.PushRight=5]="PushRight",e[e.PushUp=6]="PushUp",e[e.PushDown=7]="PushDown"}(le||(le={}));class xe extends j{constructor(e,t){super(t),this.picture=new u("res/GameAtlas32.png"),this.inputName=null,this.history=[],this.redoHistory=[],this.winTimer=0,this.confetti=null,this.titleTimer=270,this.font=new N(fe);const i=e.singleton,s=i.getCurrentLevel();if(!s)throw new Error("Missing level");this.board=ne.fromLevel(s,this.picture,de,((e,t)=>{this.makeTokens(e,t)}));const n=e.renderer().canvas();this.board.x=S(this.board.width*this.board.tileWidth,n.width),this.board.y=S(this.board.height*this.board.tileHeight,n.height),this.preferencesChanged(i.preferences),t.addEventHandler("hideTitle",(()=>this.hideTitle())),t.addEventHandler("preferencesChanged",(e=>this.preferencesChanged(e)))}preferencesChanged(e){this.board.getAnalysis().setAnalysisMode(e.analysis,e.analysisAction)}hideTitle(){this.titleTimer=0}makeTokens(e,t){for(const i of t){let t;switch(i.tokenType){case V.Player:t=new ae(i.x,i.y,e);break;case V.Crate:t=new oe(i.x,i.y,e)}e.addToken(t)}}getPlayer(){return this.board.getTokens().find((e=>e instanceof ae))}tryWalk(e,t=Q.Forward){const i=this.getPlayer();return!!i&&i.tryWalk(e,t)}tryPush(e,t){const i=this.getPlayer();return!!i&&i.tryPush(e,t)}tryPull(e,t){const i=this.getPlayer();return!!i&&i.tryPull(e,t)}doAction(e,t){const i=!t&&this.board.getAnalysis().shouldPreventRestricted();switch(e){case le.WalkLeft:return this.tryWalk(J.Left);case le.WalkRight:return this.tryWalk(J.Right);case le.WalkUp:return this.tryWalk(J.Up);case le.WalkDown:return this.tryWalk(J.Down);case le.PushLeft:return this.tryPush(J.Left,i);case le.PushRight:return this.tryPush(J.Right,i);case le.PushUp:return this.tryPush(J.Up,i);case le.PushDown:return this.tryPush(J.Down,i)}}undoAction(e){switch(e){case le.WalkLeft:return this.tryWalk(J.Right,Q.Backward);case le.WalkRight:return this.tryWalk(J.Left,Q.Backward);case le.WalkUp:return this.tryWalk(J.Down,Q.Backward);case le.WalkDown:return this.tryWalk(J.Up,Q.Backward);case le.PushLeft:return this.tryPull(J.Right,!1);case le.PushRight:return this.tryPull(J.Left,!1);case le.PushUp:return this.tryPull(J.Down,!1);case le.PushDown:return this.tryPull(J.Up,!1)}}tryAction(e){return!!this.doAction(e,!1)&&(this.history.push(e),this.redoHistory.length>0&&this.redoHistory[this.redoHistory.length-1]===e?this.redoHistory.pop():this.redoHistory=[],!0)}undo(){if(this.history.length<=0)return!1;const e=this.history[this.history.length-1];return!!this.undoAction(e)&&(this.history.pop(),this.redoHistory.push(e),!0)}redo(){if(this.redoHistory.length<=0)return!1;const e=this.redoHistory[this.redoHistory.length-1];return!!this.doAction(e,!0)&&(this.redoHistory.pop(),this.history.push(e),!0)}saveWin(e){const t=e.singleton;t.markLevelFinished(),t.saveData.toLocalStorage()}checkWinCondition(e){for(let e=0;e<this.board.height;++e)for(let t=0;t<this.board.width;++t)if(this.board.tile(t,e)===q.Dropzone&&!this.board.tokensForTile(t,e).find((e=>e instanceof oe)))return;this.winTimer<=0&&(this.winTimer=1,this.saveWin(e))}goToNextLevel(e){const t=e.singleton,i=t.levels[t.currentCollection];return!!i&&!!i.levels[t.currentLevel+1]&&(t.currentLevel++,e.setScene((()=>ue(e))),!0)}goToMenu(e){e.setScene((()=>Fe(e)))}gameWonTick(e){const t=e.input(),i=this.getPlayer();if(i&&i.winAnimation(),!this.confetti){const t=e.renderer().canvas();this.confetti=new re(t.width,t.height,this.board.picture,this.board.slices)}this.confetti.tick(),(this.winTimer>=300||t.justPressed("accept")&&this.winTimer>=40)&&(this.goToNextLevel(e)||this.goToMenu(e)),this.winTimer++}gameActiveTick(e){if(this.inputName){switch(this.inputName){case"left":this.tryAction(le.WalkLeft)||this.tryAction(le.PushLeft);break;case"right":this.tryAction(le.WalkRight)||this.tryAction(le.PushRight);break;case"up":this.tryAction(le.WalkUp)||this.tryAction(le.PushUp);break;case"down":this.tryAction(le.WalkDown)||this.tryAction(le.PushDown);break;case"undo":this.undo();break;case"redo":this.redo()}this.hideTitle(),this.board.getAnalysis().recomputeAnalysis(),this.checkWinCondition(e)}this.inputName=null}getBoard(){return this.board}focusTick(e,t){if(this.winTimer>0)return;const i=e.input();this.inputName=i.autoRepeatNewest(["left","right","up","down","undo","redo"]),i.justPressed("accept")&&this.hideTitle(),null===this.inputName&&i.justPressed("menu")&&(t.pushEvent("openMenu"),this.titleTimer=0)}tick(e,t){this.winTimer<=0?this.gameActiveTick(e):this.gameWonTick(e),this.board.lerpTick(),this.titleTimer>0&&(this.titleTimer--,this.titleTimer<=0&&this.getScene().pushEvent("titleTimedOut")),this.keepActive(0)}draw(e,t,i){const s=e.renderer();if(this.board.draw(s,i),this.confetti&&this.confetti.draw(s,i),this.titleTimer>0){const t=e.singleton.getLevelStrings(),i=s.canvas().width/2,n=s.canvas().height/2;this.font.drawTextCentered(s,t.collection,i,n-36,900,1),this.font.drawTextCentered(s,t.name,i,n-8,900,1),this.font.drawTextCentered(s,`by ${t.author}`,i,n+20,900,1)}}}const ye=z;class pe extends j{constructor(e,t,i){super(e),this.tutorial=null,this.dialogueIndex=-1,this.timeOnDialogue=0,this.picture=new u("res/TitleAtlas.png");const s=t.getCurrentLevel();if(!s)throw new Error("Missing level");s.tutorial&&(this.tutorial=s.tutorial),this.board=i,this.font=new N(G),e.addEventHandler("titleTimedOut",(()=>this.titleTimedOut()))}titleTimedOut(){this.dialogueIndex<0&&this.advanceTutorial()}advanceTutorial(){!this.tutorial||this.timeOnDialogue<5||(this.dialogueIndex++,this.timeOnDialogue=0,this.dialogueIndex>=this.tutorial.dialogues.length&&(this.tutorial=null))}focusTick(e,t){if(!this.tutorial)return;const i=e.input();i.justPressed("accept")?(this.advanceTutorial(),t.pushEvent("hideTitle")):i.justPressed("menu")&&t.pushEvent("openMenu")}tick(e,t){this.tutorial&&(this.timeOnDialogue++,this.keepActive(10))}draw(e,t,i){if(!this.tutorial)return;const s=e.renderer(),n=this.tutorial.dialogues[this.dialogueIndex];if(!n||!this.board)return;const o=S(640,s.canvas().width);s.drawRect(o-16,32,672,86,"rgb(0, 0, 0, 0.5)"),this.font.drawText(s,n.text,o,48,640,3);const a=L(this.timeOnDialogue-1,this.timeOnDialogue,i),h=10*Math.abs(Math.sin(.1*a));if(n.arrows)for(const e of n.arrows){const t=this.board.boardToWorldCoords(e.x+.5,e.y+.5);s.drawSprite(this.picture,ye.hand,t.x+2+h,t.y+-32-h)}}}class ge extends W{}function ue(e){const t=new ge(e.input()),i=new I(e,t,2.125,.025,80),s=new xe(e,t),n=new pe(t,e.singleton,s.getBoard()),o=new Y(e,t);return t.addDrawLoaderLogic(i),t.addLogic(i),t.addLogic(s),t.addLogic(n),t.addLogic(o),t}const we=JSON.parse('{"wall":[{"x":0,"y":0,"w":16,"h":16},{"x":16,"y":0,"w":16,"h":16},{"x":32,"y":0,"w":16,"h":16},{"x":48,"y":0,"w":16,"h":16},{"x":64,"y":0,"w":16,"h":16},{"x":80,"y":0,"w":16,"h":16},{"x":96,"y":0,"w":16,"h":16},{"x":112,"y":0,"w":16,"h":16},{"x":0,"y":16,"w":16,"h":16},{"x":16,"y":16,"w":16,"h":16},{"x":32,"y":16,"w":16,"h":16},{"x":48,"y":16,"w":16,"h":16},{"x":64,"y":16,"w":16,"h":16},{"x":80,"y":16,"w":16,"h":16},{"x":96,"y":16,"w":16,"h":16},{"x":112,"y":16,"w":16,"h":16}],"floor":[{"x":0,"y":32,"w":16,"h":16},{"x":0,"y":32,"w":16,"h":16},{"x":0,"y":32,"w":16,"h":16},{"x":0,"y":32,"w":16,"h":16}],"dropzone":[{"x":16,"y":32,"w":16,"h":16},{"x":16,"y":32,"w":16,"h":16},{"x":16,"y":32,"w":16,"h":16},{"x":16,"y":32,"w":16,"h":16}],"playerDown":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerRight":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerLeft":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerUp":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerHmm":{"x":0,"y":96,"w":16,"h":16},"playerWin":{"x":0,"y":96,"w":16,"h":16},"playerHead":{"x":0,"y":96,"w":16,"h":16},"crate":[{"x":0,"y":112,"w":16,"h":16},{"x":16,"y":112,"w":16,"h":16},{"x":0,"y":112,"w":16,"h":16},{"x":16,"y":112,"w":16,"h":16}],"confetti":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}]}');var ve=n.t(we,2);const me=JSON.parse('{"wall":[{"x":0,"y":0,"w":24,"h":24},{"x":24,"y":0,"w":24,"h":24},{"x":48,"y":0,"w":24,"h":24},{"x":72,"y":0,"w":24,"h":24},{"x":96,"y":0,"w":24,"h":24},{"x":120,"y":0,"w":24,"h":24},{"x":144,"y":0,"w":24,"h":24},{"x":168,"y":0,"w":24,"h":24},{"x":0,"y":24,"w":24,"h":24},{"x":24,"y":24,"w":24,"h":24},{"x":48,"y":24,"w":24,"h":24},{"x":72,"y":24,"w":24,"h":24},{"x":96,"y":24,"w":24,"h":24},{"x":120,"y":24,"w":24,"h":24},{"x":144,"y":24,"w":24,"h":24},{"x":168,"y":24,"w":24,"h":24}],"floor":[{"x":0,"y":48,"w":24,"h":24},{"x":0,"y":48,"w":24,"h":24},{"x":0,"y":48,"w":24,"h":24},{"x":0,"y":48,"w":24,"h":24}],"dropzone":[{"x":24,"y":48,"w":24,"h":24},{"x":24,"y":48,"w":24,"h":24},{"x":24,"y":48,"w":24,"h":24},{"x":24,"y":48,"w":24,"h":24}],"playerDown":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerRight":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerLeft":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerUp":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerHmm":{"x":0,"y":144,"w":24,"h":24},"playerWin":{"x":0,"y":144,"w":24,"h":24},"playerHead":{"x":0,"y":144,"w":24,"h":24},"crate":[{"x":0,"y":168,"w":24,"h":24},{"x":24,"y":168,"w":24,"h":24},{"x":0,"y":168,"w":24,"h":24},{"x":24,"y":168,"w":24,"h":24}],"confetti":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}]}'),Te=z,ke=ve,Le=n.t(me,2),Se=E;class be extends j{constructor(e){super(e),this.zoomLevels=[{picture:new u("res/GameAtlas16.png"),slices:ke},{picture:new u("res/GameAtlas24.png"),slices:Le},{picture:new u("res/GameAtlas32.png"),slices:Se}],this.picture=new u("res/TitleAtlas.png"),this.ticks=0,this.previewBoard=null,this.lastCollection=-1,this.lastLevel=-1,this.font=new N(G),this.outlineFont=new N(fe)}focusTick(e,t){const i=e.input(),s=e.singleton;switch(i.autoRepeatNewest(["left","right","up","down"])){case"left":s.currentCollection--,s.currentLevel=0;break;case"right":s.currentCollection++,s.currentLevel=0;break;case"up":s.currentLevel--;break;case"down":s.currentLevel++}i.justPressed("accept")&&this.previewBoard&&e.setScene((()=>ue(e))),i.justPressed("menu")&&t.pushEvent("openMenu")}makePreviewTokens(e,t){for(const i of t){const t=new te(i.x,i.y,e),s=e.tile(i.x,i.y);switch(t.picture=e.picture,i.tokenType){case V.Player:t.slice=e.slices.playerHead;break;case V.Crate:t.slice=e.slices.crate[s===q.Dropzone?1:0]}e.addToken(t)}}updatePreview(e){if(e.currentCollection===this.lastCollection&&e.currentLevel===this.lastLevel)return;const t=e.getCurrentLevel();if(!t)return;const i=t.measureDimensions();let s;s=i.x<=12&&i.y<=8?this.zoomLevels[2]:i.x<=18&&i.y<=12?this.zoomLevels[1]:this.zoomLevels[0],this.previewBoard=ne.fromLevel(t,s.picture,s.slices,((e,t)=>{this.makePreviewTokens(e,t)})),this.lastCollection=e.currentCollection,this.lastLevel=e.currentLevel}tick(e,t){const i=e.singleton;i.currentCollection=(i.currentCollection+i.levels.length)%i.levels.length;const s=i.levels[i.currentCollection];i.currentLevel=s?(i.currentLevel+s.levels.length)%s.levels.length:0,this.updatePreview(i),this.ticks++,this.keepActive(0)}drawCollectionSelector(e,t){const i=e.canvas().width,s=e.context(),n=t.levels[t.currentCollection];let o="<error>",a="Anonymous";n&&(o=n.name,n.author.length>0&&(a=n.author));const h=k(275/this.font.measureText(o),.5,1);s.save(),s.scale(2,2),this.font.drawText(e,"Levelset",40,96),s.scale(h,1),this.font.drawText(e,o,172/h,96),s.restore();const r=3*Math.sin(.1*this.ticks);e.drawSprite(this.picture,Te.arrowLeft,288-r,194),e.drawSprite(this.picture,Te.arrowRight,312+r,194),n&&(this.font.drawText(e,`by ${a}`,80,234,i-160,1),this.font.drawText(e,n.description,80,262,i-160,2))}drawLevelSelector(e,t){const i=t.levels[t.currentCollection];if(!i)return;const s=3*Math.sin(.1*this.ticks);e.drawSprite(this.picture,Te.arrowUp,116,320-s-2),e.drawSprite(this.picture,Te.arrowDown,116,584+s+2);let n=344;const o=k(t.currentLevel-4,0,i.levels.length-10),a=t.getFinishedLevels();for(let s=o;s<o+10;++s)this.drawLevelItem(e,s,n,s===t.currentLevel,i.levels[s],a[s]>0),n+=24}drawLevelItem(e,t,i,s,n,o){if(!n)return;let a=`Level ${t+1}`;n.name&&n.name.length>0&&(a+=`: ${n.name}`);const h=k(308/this.font.measureText(a),.5,1);let r=this.font,c=Te.starWhite;s&&(e.drawRect(58,i-6,348,24,"rgb(255, 255, 255, 1.0"),r=this.outlineFont,c=Te.starBlack),e.drawSprite(this.picture,c[o?1:0],64,i),e.context().save(),e.context().scale(h,1),r.drawText(e,a,92/h,i,616,1),e.context().restore()}drawPreviewBoard(e,t){this.previewBoard&&(e.drawRect(452,308,492,332,"rgb(0, 0, 0, 0.15)"),e.drawRectOutline(452.5,308.5,491,331,"rgb(0, 0, 0, 0.15)"),this.previewBoard.x=698-this.previewBoard.width*this.previewBoard.tileWidth/2,this.previewBoard.y=474-this.previewBoard.height*this.previewBoard.tileHeight/2,this.previewBoard.draw(e,t))}drawTicker(e){let t,i;this.ticks%480<240?(t="Press Enter to play",i=104):(t="Press Backspace to open menu",i=64),this.font.drawText(e,t,i,e.canvas().height-24)}drawTitle(e){const t=e.canvas().width;e.drawSprite(this.picture,Te.title,S(Te.title.w,t),24),this.font.drawTextRight(e,"dannidragonheart.itch.io",t-16,16),this.font.drawTextRight(e,"Version 2",t-16,40)}draw(e,t,i){const s=e.renderer(),n=e.singleton;this.drawTitle(s),this.drawPreviewBoard(s,i),this.drawCollectionSelector(s,n),this.drawLevelSelector(s,n),this.drawTicker(s)}}function Ae(e,i){return void 0===i&&(i={}),function(s,n){var o=Reflect.getMetadata("design:type",s,n);t.addTypeMetadata({target:s.constructor,propertyName:n,reflectedType:o,typeFunction:e,options:i})}}var _e,Me=function(e,t,i,s){var n,o=arguments.length,a=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,s);else for(var h=e.length-1;h>=0;h--)(n=e[h])&&(a=(o<3?n(a):o>3?n(t,i,a):n(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a};class Ce{constructor(){this.name=null,this.author=null,this.description=null,this.tiles=[]}measureDimensions(){let e=0;const t=this.tiles.length;for(const t of this.tiles)e=Math.max(e,t.length);return{x:e,y:t}}}Me([Ae((()=>Oe))],Ce.prototype,"tutorial",void 0);class Pe{constructor(){this.name="Unnamed Collection",this.author="",this.description="",this.saveId="",this.levels=[]}}Me([Ae((()=>Ce))],Pe.prototype,"levels",void 0);class Oe{constructor(){this.dialogues=[]}}Me([Ae((()=>Ee))],Oe.prototype,"dialogues",void 0);class Ee{constructor(){this.text=""}}Me([Ae((()=>Re))],Ee.prototype,"arrows",void 0);class Re{constructor(){this.x=0,this.y=0}}!function(e){e[e.None=0]="None",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Broken=3]="Broken"}(_e||(_e={}));class Ie{constructor(){this.loadState=_e.None,this.error=null,this.font=new N(G)}async fetchLevels(e){const t=await b("./res/levels.json"),i=[],s={};for(const e of t.levelFiles){const t=b(e).then((e=>{const t=r(Pe,e);if(t.saveId.length<=0)throw new Error(`Empty collection save id for "${t.name}"`);if(void 0!==s[t.saveId])throw new Error(`Collection save id "${t.saveId}" collision between "${t.name}" and "${s[t.saveId]}"`);return s[t.saveId]=t.name,Promise.resolve(t)}));i.push(t)}const n=Promise.all(i).then((t=>{e.singleton.levels=t,this.loadState=_e.Loaded})).catch((e=>{throw this.loadState=_e.Broken,e}));await n}isLoaded(){return this.loadState===_e.Loaded}tick(e,t){if(u.allLoaded()&&this.loadState===_e.None&&(e.singleton.levels.length>0?this.loadState=_e.Loaded:(this.loadState=_e.Loading,this.fetchLevels(e).catch((e=>{this.error=new Error("Failed to read level list: "+e.message??String(e))})))),this.error)throw this.error}draw(e,t,i){const s=e.renderer();this.font.drawText(s,"Grabbing levels...",64,576)}}class De extends W{constructor(e,t){super(e),this.levelFetchLogic=t}isLoaded(){return super.isLoaded()&&this.levelFetchLogic.isLoaded()}}function Fe(e){const t=new Ie,i=e.input(),s=new De(i,t),n=new I(e,s,.25),o=new be(s),a=new Y(e,s);return s.addDrawLoaderLogic(n),s.addLoaderLogic(t),s.addLogic(n),s.addLogic(o),s.addLogic(a),s}window.onload=function(){const e=new P("game_surface",new p),t=e.input();t.addAction("left",["ArrowLeft","KeyA"]),t.addAction("right",["ArrowRight","KeyD"]),t.addAction("up",["ArrowUp","KeyW"]),t.addAction("down",["ArrowDown","KeyS"]),t.addAction("menu",["Backspace","Escape"]),t.addAction("accept",["Enter","Space"]),t.addAction("undo",["KeyZ"]),t.addAction("redo",["KeyX"]),e.setScene((()=>Fe(e))),e.run()}})()})();