/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t,e,i={660:(t,e,i)=>{var n;!function(t){!function(e){var n="object"==typeof i.g?i.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),s=o(t);function o(t,e){return function(i,n){"function"!=typeof t[i]&&Object.defineProperty(t,i,{configurable:!0,writable:!0,value:n}),e&&e(i,n)}}void 0===n.Reflect?n.Reflect=t:s=o(n.Reflect,s),function(t){var e=Object.prototype.hasOwnProperty,i="function"==typeof Symbol,n=i&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",s=i&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,a={__proto__:[]}instanceof Array,h=!o&&!a,r={create:o?function(){return R(Object.create(null))}:a?function(){return R({__proto__:null})}:function(){return R({})},has:h?function(t,i){return e.call(t,i)}:function(t,e){return e in t},get:h?function(t,i){return e.call(t,i)?t[i]:void 0}:function(t,e){return t[e]}},f=Object.getPrototypeOf(Function),c="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=c||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var t={},e=[],i=function(){function t(t,e,i){this._index=0,this._keys=t,this._values=e,this._selector=i}return t.prototype["@@iterator"]=function(){return this},t.prototype[s]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var i=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var i=this._find(t,!0);return this._values[i]=e,this},e.prototype.delete=function(e){var i=this._find(e,!1);if(i>=0){for(var n=this._keys.length,s=i+1;s<n;s++)this._keys[s-1]=this._keys[s],this._values[s-1]=this._values[s];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new i(this._keys,this._values,n)},e.prototype.values=function(){return new i(this._keys,this._values,o)},e.prototype.entries=function(){return new i(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[s]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function n(t,e){return t}function o(t,e){return e}function a(t,e){return[t,e]}}():Map,l=c||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function t(){this._map=new d}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[s]=function(){return this.keys()},t}():Set,x=new(c||"function"!=typeof WeakMap?function(){var t=16,i=r.create(),n=s();return function(){function t(){this._key=s()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&r.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?r.get(e,this._key):void 0},t.prototype.set=function(t,e){return o(t,!0)[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=s()},t}();function s(){var t;do{t="@@WeakMap@@"+h()}while(r.has(i,t));return i[t]=!0,t}function o(t,i){if(!e.call(t,n)){if(!i)return;Object.defineProperty(t,n,{value:r.create()})}return t[n]}function a(t,e){for(var i=0;i<e;++i)t[i]=255*Math.random()|0;return t}function h(){var e,i=(e=t,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e));i[6]=79&i[6]|64,i[8]=191&i[8]|128;for(var n="",s=0;s<t;++s){var o=i[s];4!==s&&6!==s&&8!==s||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}():WeakMap);function y(t,e,i){var n=x.get(t);if(T(n)){if(!i)return;n=new d,x.set(t,n)}var s=n.get(e);if(T(s)){if(!i)return;s=new d,n.set(e,s)}return s}function p(t,e,i){if(g(t,e,i))return!0;var n=F(e);return!S(n)&&p(t,n,i)}function g(t,e,i){var n=y(e,i,!1);return!T(n)&&!!n.has(t)}function u(t,e,i){if(g(t,e,i))return w(t,e,i);var n=F(e);return S(n)?void 0:u(t,n,i)}function w(t,e,i){var n=y(e,i,!1);if(!T(n))return n.get(t)}function v(t,e,i,n){y(i,n,!0).set(t,e)}function m(t,e){var i=k(t,e),n=F(t);if(null===n)return i;var s=m(n,e);if(s.length<=0)return i;if(i.length<=0)return s;for(var o=new l,a=[],h=0,r=i;h<r.length;h++){var f=r[h];o.has(f)||(o.add(f),a.push(f))}for(var c=0,d=s;c<d.length;c++)f=d[c],o.has(f)||(o.add(f),a.push(f));return a}function k(t,e){var i=[],n=y(t,e,!1);if(T(n))return i;for(var o=function(t){var e=O(t,s);if(!M(e))throw new TypeError;var i=e.call(t);if(!A(i))throw new TypeError;return i}(n.keys()),a=0;;){var h=E(o);if(!h)return i.length=a,i;var r=h.value;try{i[a]=r}catch(t){try{I(o)}finally{throw t}}a++}}function L(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function T(t){return void 0===t}function S(t){return null===t}function A(t){return"object"==typeof t?null!==t:"function"==typeof t}function b(t,e){switch(L(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var i=3===e?"string":5===e?"number":"default",s=O(t,n);if(void 0!==s){var o=s.call(t,i);if(A(o))throw new TypeError;return o}return function(t,e){if("string"===e){var i=t.toString;if(M(i)&&!A(s=i.call(t)))return s;if(M(n=t.valueOf)&&!A(s=n.call(t)))return s}else{var n;if(M(n=t.valueOf)&&!A(s=n.call(t)))return s;var s,o=t.toString;if(M(o)&&!A(s=o.call(t)))return s}throw new TypeError}(t,"default"===i?"number":i)}function _(t){var e=b(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function C(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function M(t){return"function"==typeof t}function P(t){return"function"==typeof t}function O(t,e){var i=t[e];if(null!=i){if(!M(i))throw new TypeError;return i}}function E(t){var e=t.next();return!e.done&&e}function I(t){var e=t.return;e&&e.call(t)}function F(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===f)return e;if(e!==f)return e;var i=t.prototype,n=i&&Object.getPrototypeOf(i);if(null==n||n===Object.prototype)return e;var s=n.constructor;return"function"!=typeof s||s===t?e:s}function R(t){return t.__=void 0,delete t.__,t}t("decorate",(function(t,e,i,n){if(T(i)){if(!C(t))throw new TypeError;if(!P(e))throw new TypeError;return function(t,e){for(var i=t.length-1;i>=0;--i){var n=(0,t[i])(e);if(!T(n)&&!S(n)){if(!P(n))throw new TypeError;e=n}}return e}(t,e)}if(!C(t))throw new TypeError;if(!A(e))throw new TypeError;if(!A(n)&&!T(n)&&!S(n))throw new TypeError;return S(n)&&(n=void 0),function(t,e,i,n){for(var s=t.length-1;s>=0;--s){var o=(0,t[s])(e,i,n);if(!T(o)&&!S(o)){if(!A(o))throw new TypeError;n=o}}return n}(t,e,i=_(i),n)})),t("metadata",(function(t,e){return function(i,n){if(!A(i))throw new TypeError;if(!T(n)&&!function(t){switch(L(t)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;v(t,e,i,n)}})),t("defineMetadata",(function(t,e,i,n){if(!A(i))throw new TypeError;return T(n)||(n=_(n)),v(t,e,i,n)})),t("hasMetadata",(function(t,e,i){if(!A(e))throw new TypeError;return T(i)||(i=_(i)),p(t,e,i)})),t("hasOwnMetadata",(function(t,e,i){if(!A(e))throw new TypeError;return T(i)||(i=_(i)),g(t,e,i)})),t("getMetadata",(function(t,e,i){if(!A(e))throw new TypeError;return T(i)||(i=_(i)),u(t,e,i)})),t("getOwnMetadata",(function(t,e,i){if(!A(e))throw new TypeError;return T(i)||(i=_(i)),w(t,e,i)})),t("getMetadataKeys",(function(t,e){if(!A(t))throw new TypeError;return T(e)||(e=_(e)),m(t,e)})),t("getOwnMetadataKeys",(function(t,e){if(!A(t))throw new TypeError;return T(e)||(e=_(e)),k(t,e)})),t("deleteMetadata",(function(t,e,i){if(!A(e))throw new TypeError;T(i)||(i=_(i));var n=y(e,i,!1);if(T(n))return!1;if(!n.delete(t))return!1;if(n.size>0)return!0;var s=x.get(e);return s.delete(i),s.size>0||x.delete(e),!0}))}(s)}()}(n||(n={}))}},n={};function s(t){var e=n[t];if(void 0!==e)return e.exports;var o=n[t]={exports:{}};return i[t](o,o.exports,s),o.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,s.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var o=Object.create(null);s.r(o);var a={};t=t||[null,e({}),e([]),e(e)];for(var h=2&n&&i;"object"==typeof h&&!~t.indexOf(h);h=e(h))Object.getOwnPropertyNames(h).forEach((t=>a[t]=()=>i[t]));return a.default=()=>i,s.d(o,a),o},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t;s(660),function(t){t[t.PLAIN_TO_CLASS=0]="PLAIN_TO_CLASS",t[t.CLASS_TO_PLAIN=1]="CLASS_TO_PLAIN",t[t.CLASS_TO_CLASS=2]="CLASS_TO_CLASS"}(t||(t={}));var e=new(function(){function e(){this._typeMetadatas=new Map,this._transformMetadatas=new Map,this._exposeMetadatas=new Map,this._excludeMetadatas=new Map,this._ancestorsMap=new Map}return e.prototype.addTypeMetadata=function(t){this._typeMetadatas.has(t.target)||this._typeMetadatas.set(t.target,new Map),this._typeMetadatas.get(t.target).set(t.propertyName,t)},e.prototype.addTransformMetadata=function(t){this._transformMetadatas.has(t.target)||this._transformMetadatas.set(t.target,new Map),this._transformMetadatas.get(t.target).has(t.propertyName)||this._transformMetadatas.get(t.target).set(t.propertyName,[]),this._transformMetadatas.get(t.target).get(t.propertyName).push(t)},e.prototype.addExposeMetadata=function(t){this._exposeMetadatas.has(t.target)||this._exposeMetadatas.set(t.target,new Map),this._exposeMetadatas.get(t.target).set(t.propertyName,t)},e.prototype.addExcludeMetadata=function(t){this._excludeMetadatas.has(t.target)||this._excludeMetadatas.set(t.target,new Map),this._excludeMetadatas.get(t.target).set(t.propertyName,t)},e.prototype.findTransformMetadatas=function(e,i,n){return this.findMetadatas(this._transformMetadatas,e,i).filter((function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?n===t.CLASS_TO_CLASS||n===t.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||n===t.CLASS_TO_PLAIN)}))},e.prototype.findExcludeMetadata=function(t,e){return this.findMetadata(this._excludeMetadatas,t,e)},e.prototype.findExposeMetadata=function(t,e){return this.findMetadata(this._exposeMetadatas,t,e)},e.prototype.findExposeMetadataByCustomName=function(t,e){return this.getExposedMetadatas(t).find((function(t){return t.options&&t.options.name===e}))},e.prototype.findTypeMetadata=function(t,e){return this.findMetadata(this._typeMetadatas,t,e)},e.prototype.getStrategy=function(t){var e=this._excludeMetadatas.get(t),i=e&&e.get(void 0),n=this._exposeMetadatas.get(t),s=n&&n.get(void 0);return i&&s||!i&&!s?"none":i?"excludeAll":"exposeAll"},e.prototype.getExposedMetadatas=function(t){return this.getMetadata(this._exposeMetadatas,t)},e.prototype.getExcludedMetadatas=function(t){return this.getMetadata(this._excludeMetadatas,t)},e.prototype.getExposedProperties=function(e,i){return this.getExposedMetadatas(e).filter((function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?i===t.CLASS_TO_CLASS||i===t.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||i===t.CLASS_TO_PLAIN)})).map((function(t){return t.propertyName}))},e.prototype.getExcludedProperties=function(e,i){return this.getExcludedMetadatas(e).filter((function(e){return!e.options||!0===e.options.toClassOnly&&!0===e.options.toPlainOnly||(!0===e.options.toClassOnly?i===t.CLASS_TO_CLASS||i===t.PLAIN_TO_CLASS:!0!==e.options.toPlainOnly||i===t.CLASS_TO_PLAIN)})).map((function(t){return t.propertyName}))},e.prototype.clear=function(){this._typeMetadatas.clear(),this._exposeMetadatas.clear(),this._excludeMetadatas.clear(),this._ancestorsMap.clear()},e.prototype.getMetadata=function(t,e){var i,n=t.get(e);n&&(i=Array.from(n.values()).filter((function(t){return void 0!==t.propertyName})));for(var s=[],o=0,a=this.getAncestors(e);o<a.length;o++){var h=a[o],r=t.get(h);if(r){var f=Array.from(r.values()).filter((function(t){return void 0!==t.propertyName}));s.push.apply(s,f)}}return s.concat(i||[])},e.prototype.findMetadata=function(t,e,i){var n=t.get(e);if(n){var s=n.get(i);if(s)return s}for(var o=0,a=this.getAncestors(e);o<a.length;o++){var h=a[o],r=t.get(h);if(r){var f=r.get(i);if(f)return f}}},e.prototype.findMetadatas=function(t,e,i){var n,s=t.get(e);s&&(n=s.get(i));for(var o=[],a=0,h=this.getAncestors(e);a<h.length;a++){var r=h[a],f=t.get(r);f&&f.has(i)&&o.push.apply(o,f.get(i))}return o.slice().reverse().concat((n||[]).slice().reverse())},e.prototype.getAncestors=function(t){if(!t)return[];if(!this._ancestorsMap.has(t)){for(var e=[],i=Object.getPrototypeOf(t.prototype.constructor);void 0!==i.prototype;i=Object.getPrototypeOf(i.prototype.constructor))e.push(i);this._ancestorsMap.set(t,e)}return this._ancestorsMap.get(t)},e}()),i=function(t,e,i){if(i||2===arguments.length)for(var n,s=0,o=e.length;s<o;s++)!n&&s in e||(n||(n=Array.prototype.slice.call(e,0,s)),n[s]=e[s]);return t.concat(n||Array.prototype.slice.call(e))},n=function(){function n(t,e){this.transformationType=t,this.options=e,this.recursionStack=new Set}return n.prototype.transform=function(i,n,o,a,h,r){var f,c=this;if(void 0===r&&(r=0),Array.isArray(n)||n instanceof Set){var d=a&&this.transformationType===t.PLAIN_TO_CLASS?function(t){var e=new t;return e instanceof Set||"push"in e?e:[]}(a):[];return n.forEach((function(e,n){var s=i?i[n]:void 0;if(c.options.enableCircularCheck&&c.isCircular(e))c.transformationType===t.CLASS_TO_CLASS&&(d instanceof Set?d.add(e):d.push(e));else{var a=void 0;if("function"!=typeof o&&o&&o.options&&o.options.discriminator&&o.options.discriminator.property&&o.options.discriminator.subTypes){if(c.transformationType===t.PLAIN_TO_CLASS){a=o.options.discriminator.subTypes.find((function(t){return t.name===e[o.options.discriminator.property]}));var h={newObject:d,object:e,property:void 0},f=o.typeFunction(h);a=void 0===a?f:a.value,o.options.keepDiscriminatorProperty||delete e[o.options.discriminator.property]}c.transformationType===t.CLASS_TO_CLASS&&(a=e.constructor),c.transformationType===t.CLASS_TO_PLAIN&&(e[o.options.discriminator.property]=o.options.discriminator.subTypes.find((function(t){return t.value===e.constructor})).name)}else a=o;var l=c.transform(s,e,a,void 0,e instanceof Map,r+1);d instanceof Set?d.add(l):d.push(l)}})),d}if(o!==String||h){if(o!==Number||h){if(o!==Boolean||h){if((o===Date||n instanceof Date)&&!h)return n instanceof Date?new Date(n.valueOf()):null==n?n:new Date(n);if(("undefined"!=typeof globalThis?globalThis:void 0!==s.g?s.g:"undefined"!=typeof window?window:"undefined"!=typeof self?self:void 0).Buffer&&(o===Buffer||n instanceof Buffer)&&!h)return null==n?n:Buffer.from(n);if(null===(f=n)||"object"!=typeof f||"function"!=typeof f.then||h){if(h||null===n||"object"!=typeof n||"function"!=typeof n.then){if("object"==typeof n&&null!==n){o||n.constructor===Object||(Array.isArray(n)||n.constructor!==Array)&&(o=n.constructor),!o&&i&&(o=i.constructor),this.options.enableCircularCheck&&this.recursionStack.add(n);var l=this.getKeys(o,n,h),x=i||{};i||this.transformationType!==t.PLAIN_TO_CLASS&&this.transformationType!==t.CLASS_TO_CLASS||(x=h?new Map:o?new o:{});for(var y=function(s){if("__proto__"===s||"constructor"===s)return"continue";var a=s,f=s,c=s;if(!p.options.ignoreDecorators&&o)if(p.transformationType===t.PLAIN_TO_CLASS)(d=e.findExposeMetadataByCustomName(o,s))&&(c=d.propertyName,f=d.propertyName);else if(p.transformationType===t.CLASS_TO_PLAIN||p.transformationType===t.CLASS_TO_CLASS){var d;(d=e.findExposeMetadata(o,s))&&d.options&&d.options.name&&(f=d.options.name)}var l=void 0;l=p.transformationType===t.PLAIN_TO_CLASS?n[a]:n instanceof Map?n.get(a):n[a]instanceof Function?n[a]():n[a];var y=void 0,g=l instanceof Map;if(o&&h)y=o;else if(o){var u=e.findTypeMetadata(o,c);if(u){var w={newObject:x,object:n,property:c},v=u.typeFunction?u.typeFunction(w):u.reflectedType;u.options&&u.options.discriminator&&u.options.discriminator.property&&u.options.discriminator.subTypes?n[a]instanceof Array?y=u:(p.transformationType===t.PLAIN_TO_CLASS&&(y=void 0===(y=u.options.discriminator.subTypes.find((function(t){if(l&&l instanceof Object&&u.options.discriminator.property in l)return t.name===l[u.options.discriminator.property]})))?v:y.value,u.options.keepDiscriminatorProperty||l&&l instanceof Object&&u.options.discriminator.property in l&&delete l[u.options.discriminator.property]),p.transformationType===t.CLASS_TO_CLASS&&(y=l.constructor),p.transformationType===t.CLASS_TO_PLAIN&&l&&(l[u.options.discriminator.property]=u.options.discriminator.subTypes.find((function(t){return t.value===l.constructor})).name)):y=v,g=g||u.reflectedType===Map}else if(p.options.targetMaps)p.options.targetMaps.filter((function(t){return t.target===o&&!!t.properties[c]})).forEach((function(t){return y=t.properties[c]}));else if(p.options.enableImplicitConversion&&p.transformationType===t.PLAIN_TO_CLASS){var m=Reflect.getMetadata("design:type",o.prototype,c);m&&(y=m)}}var k=Array.isArray(n[a])?p.getReflectedType(o,c):void 0,L=i?i[a]:void 0;if(x.constructor.prototype){var T=Object.getOwnPropertyDescriptor(x.constructor.prototype,f);if((p.transformationType===t.PLAIN_TO_CLASS||p.transformationType===t.CLASS_TO_CLASS)&&(T&&!T.set||x[f]instanceof Function))return"continue"}if(p.options.enableCircularCheck&&p.isCircular(l))p.transformationType===t.CLASS_TO_CLASS&&(A=l,(void 0!==(A=p.applyCustomTransformations(A,o,s,n,p.transformationType))||p.options.exposeUnsetFields)&&(x instanceof Map?x.set(f,A):x[f]=A));else{var S=p.transformationType===t.PLAIN_TO_CLASS?f:s,A=void 0;p.transformationType===t.CLASS_TO_PLAIN?(A=n[S],A=p.applyCustomTransformations(A,o,S,n,p.transformationType),A=n[S]===A?l:A,A=p.transform(L,A,y,k,g,r+1)):void 0===l&&p.options.exposeDefaultValues?A=x[f]:(A=p.transform(L,l,y,k,g,r+1),A=p.applyCustomTransformations(A,o,S,n,p.transformationType)),(void 0!==A||p.options.exposeUnsetFields)&&(x instanceof Map?x.set(f,A):x[f]=A)}},p=this,g=0,u=l;g<u.length;g++)y(u[g]);return this.options.enableCircularCheck&&this.recursionStack.delete(n),x}return n}return n}return new Promise((function(t,e){n.then((function(e){return t(c.transform(void 0,e,o,void 0,void 0,r+1))}),e)}))}return null==n?n:Boolean(n)}return null==n?n:Number(n)}return null==n?n:String(n)},n.prototype.applyCustomTransformations=function(t,i,n,s,o){var a=this,h=e.findTransformMetadatas(i,n,this.transformationType);return void 0!==this.options.version&&(h=h.filter((function(t){return!t.options||a.checkVersion(t.options.since,t.options.until)}))),(h=this.options.groups&&this.options.groups.length?h.filter((function(t){return!t.options||a.checkGroups(t.options.groups)})):h.filter((function(t){return!t.options||!t.options.groups||!t.options.groups.length}))).forEach((function(e){t=e.transformFn({value:t,key:n,obj:s,type:o,options:a.options})})),t},n.prototype.isCircular=function(t){return this.recursionStack.has(t)},n.prototype.getReflectedType=function(t,i){if(t){var n=e.findTypeMetadata(t,i);return n?n.reflectedType:void 0}},n.prototype.getKeys=function(n,s,o){var a=this,h=e.getStrategy(n);"none"===h&&(h=this.options.strategy||"exposeAll");var r=[];if(("exposeAll"===h||o)&&(r=s instanceof Map?Array.from(s.keys()):Object.keys(s)),o)return r;if(this.options.ignoreDecorators&&this.options.excludeExtraneousValues&&n){var f=e.getExposedProperties(n,this.transformationType),c=e.getExcludedProperties(n,this.transformationType);r=i(i([],f,!0),c,!0)}if(!this.options.ignoreDecorators&&n){f=e.getExposedProperties(n,this.transformationType),this.transformationType===t.PLAIN_TO_CLASS&&(f=f.map((function(t){var i=e.findExposeMetadata(n,t);return i&&i.options&&i.options.name?i.options.name:t}))),r=this.options.excludeExtraneousValues?f:r.concat(f);var d=e.getExcludedProperties(n,this.transformationType);d.length>0&&(r=r.filter((function(t){return!d.includes(t)}))),void 0!==this.options.version&&(r=r.filter((function(t){var i=e.findExposeMetadata(n,t);return!i||!i.options||a.checkVersion(i.options.since,i.options.until)}))),r=this.options.groups&&this.options.groups.length?r.filter((function(t){var i=e.findExposeMetadata(n,t);return!i||!i.options||a.checkGroups(i.options.groups)})):r.filter((function(t){var i=e.findExposeMetadata(n,t);return!(i&&i.options&&i.options.groups&&i.options.groups.length)}))}return this.options.excludePrefixes&&this.options.excludePrefixes.length&&(r=r.filter((function(t){return a.options.excludePrefixes.every((function(e){return t.substr(0,e.length)!==e}))}))),r.filter((function(t,e,i){return i.indexOf(t)===e}))},n.prototype.checkVersion=function(t,e){var i=!0;return i&&t&&(i=this.options.version>=t),i&&e&&(i=this.options.version<e),i},n.prototype.checkGroups=function(t){return!t||this.options.groups.some((function(e){return t.includes(e)}))},n}(),o={enableCircularCheck:!1,enableImplicitConversion:!1,excludeExtraneousValues:!1,excludePrefixes:void 0,exposeDefaultValues:!1,exposeUnsetFields:!0,groups:void 0,ignoreDecorators:!1,strategy:void 0,targetMaps:void 0,version:void 0},a=function(){return a=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t},a.apply(this,arguments)},h=function(){function e(){}return e.prototype.instanceToPlain=function(e,i){return new n(t.CLASS_TO_PLAIN,a(a({},o),i)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToPlainFromExist=function(e,i,s){return new n(t.CLASS_TO_PLAIN,a(a({},o),s)).transform(i,e,void 0,void 0,void 0,void 0)},e.prototype.plainToInstance=function(e,i,s){return new n(t.PLAIN_TO_CLASS,a(a({},o),s)).transform(void 0,i,e,void 0,void 0,void 0)},e.prototype.plainToClassFromExist=function(e,i,s){return new n(t.PLAIN_TO_CLASS,a(a({},o),s)).transform(e,i,void 0,void 0,void 0,void 0)},e.prototype.instanceToInstance=function(e,i){return new n(t.CLASS_TO_CLASS,a(a({},o),i)).transform(void 0,e,void 0,void 0,void 0,void 0)},e.prototype.classToClassFromExist=function(e,i,s){return new n(t.CLASS_TO_CLASS,a(a({},o),s)).transform(i,e,void 0,void 0,void 0,void 0)},e.prototype.serialize=function(t,e){return JSON.stringify(this.instanceToPlain(t,e))},e.prototype.deserialize=function(t,e,i){var n=JSON.parse(e);return this.plainToInstance(t,n,i)},e.prototype.deserializeArray=function(t,e,i){var n=JSON.parse(e);return this.plainToInstance(t,n,i)},e}(),r=new h;function f(t,e,i){return r.plainToInstance(t,e,i)}const c="SuperCrateHoard_SaveData",d="SuperCrateHoard_Preferences";class l{constructor(){this.finishedLevels={},this.version=1}static fromLocalStorage(){const t=window.localStorage.getItem(c);if(!t)return new l;const e=JSON.parse(t);return f(l,e)}toLocalStorage(){window.localStorage.setItem(c,JSON.stringify(this))}getFinishedLevels(t){return void 0===this.finishedLevels[t]&&(this.finishedLevels[t]=[]),this.finishedLevels[t]}markLevelFinished(t,e){if(void 0===this.finishedLevels[t])return;const i=this.finishedLevels[t];for(let t=0;t<e;++t)i[t]||(i[t]=0);i[e]=1}}class x{constructor(){this.version=1,this.analysis=0,this.analysisAction=0}static fromLocalStorage(){const t=window.localStorage.getItem(d);if(!t)return new x;const e=JSON.parse(t);return f(x,e)}toLocalStorage(){window.localStorage.setItem(d,JSON.stringify(this))}}class y{constructor(){this.saveData=l.fromLocalStorage(),this.preferences=x.fromLocalStorage(),this.levels=[],this.currentCollection=0,this.currentLevel=0,this.bgScroll=0}getFinishedLevels(){const t=this.levels[this.currentCollection];return t?this.saveData.getFinishedLevels(t.saveId):[]}markLevelFinished(){const t=this.levels[this.currentCollection];t&&this.saveData.markLevelFinished(t.saveId,this.currentLevel)}}class p{constructor(t){this.imageElement=new Image,this.imageElement.loading="eager",p.numLoading++,this.imageElement.onload=()=>{p.numLoading--},this.imageElement.onerror=()=>{p.errors.push(`Image failed to load: "${t}"`),p.numLoading--},this.imageElement.src=t}image(){return this.imageElement}static itemsLoading(){return this.numLoading}static itemErrors(){return this.errors}}p.numLoading=0,p.errors=[];class g{constructor(t){if(!g.dataCache[t]){const e=new p(t);g.dataCache[t]=e}this.pictureData=g.dataCache[t]}sharedData(){return this.pictureData}isLoaded(){return this.pictureData.image().complete}static allLoaded(){return p.itemsLoading()<=0&&p.itemErrors().length<=0}}g.dataCache={};class u{constructor(t,e,i,n){this.x=t,this.y=e,this.w=i,this.h=n}}class w{constructor(t){if(this.alreadyWarned={},this.mainCanvas=document.getElementById(t),!this.mainCanvas||!this.mainCanvas.getContext)throw new Error("Missing canvas");const e=this.mainCanvas.getContext("2d");if(!e)throw new Error("Could not create canvas context");this.drawingContext=e,this.drawingContext.imageSmoothingEnabled=!1,this.reset(),document.addEventListener("keydown",(t=>{t.altKey&&"Enter"==t.code&&!t.repeat&&this.toggleFullscreen()}))}checkPictureLoaded(t){const e=t.sharedData().image().src;return!!t.isLoaded()||(this.alreadyWarned[e]||(this.alreadyWarned[e]=!0,console.warn(`Drawing unloaded picture: "${e}"`)),!1)}reset(){const t=this.drawingContext;t.restore(),t.save(),this.drawBackgroundColor(0,0,0)}drawBackgroundColor(t,e,i,n=1){this.drawingContext.fillStyle=`rgb(${t}, ${e}, ${i}, ${n})`,this.drawingContext.fillRect(-1,-1,this.mainCanvas.width+2,this.mainCanvas.height+2)}drawPicture(t,e,i){this.checkPictureLoaded(t)&&this.drawingContext.drawImage(t.sharedData().image(),e,i)}drawSprite(t,e,i,n){this.checkPictureLoaded(t)&&this.drawingContext.drawImage(t.sharedData().image(),e.x,e.y,e.w,e.h,Math.round(i),Math.round(n),e.w,e.h)}drawRect(t,e,i,n,s){this.drawingContext.fillStyle=s,this.drawingContext.fillRect(t,e,i,n)}drawRectOutline(t,e,i,n,s){this.drawingContext.strokeStyle=s,this.drawingContext.strokeRect(t,e,i,n)}drawText(t,e,i,n,s,o=-1){this.drawingContext.font=n,this.drawingContext.fillStyle=s;const a=this.drawingContext.measureText(" "),h=Math.ceil(1.1*(a.fontBoundingBoxAscent+a.fontBoundingBoxDescent));o>0&&(t=this.computeWordWrap(t,o));const r=t.split("\n");for(const t of r)this.drawingContext.fillText(t,e,i),i+=h}computeWordWrap(t,e){let i="";const n=t.split(" ");let s=n[0]??"";for(let t=1;t<n.length;++t){const o=n[t];this.drawingContext.measureText(s+" "+o).width>e?(i+=s+"\n",s=o):s+=" "+o}return i+=s,i}toggleFullscreen(){document.fullscreenElement?document.exitFullscreen():this.mainCanvas.requestFullscreen({navigationUI:"hide"})}canvas(){return this.mainCanvas}context(){return this.drawingContext}}class v{constructor(){this.bindings=[],this.timeHeld=0,this.sameFrameOrdering=0}}class m{constructor(){this.heldKeys={},this.actions={},this.newKeysThisFrame=1,document.addEventListener("keydown",(t=>this.keyDownHandler(t))),document.addEventListener("keyup",(t=>this.keyUpHandler(t))),document.addEventListener("contextmenu",(t=>{t.preventDefault(),t.stopPropagation()}))}keyDownHandler(t){t.altKey&&"Enter"==t.code||(this.heldKeys[t.code]=this.newKeysThisFrame,this.newKeysThisFrame++,t.preventDefault())}keyUpHandler(t){this.heldKeys[t.code]=0,t.preventDefault()}newFrame(){t:for(const t of Object.values(this.actions)){for(const e of t.bindings){const i=this.heldKeys[e];if(i>0){0===t.timeHeld&&(t.sameFrameOrdering=i),t.timeHeld++;continue t}}t.timeHeld=0}this.newKeysThisFrame=1}addAction(t,e=[]){if(this.actions[t])throw new Error(`Action "${t}" already exists`);this.actions[t]=new v,this.bindAction(t,e)}bindAction(t,e){const i=this.actions[t];if(!i)throw new Error(`Action "${t}" doesn't exist`);for(const t of e)t in i.bindings||i.bindings.push(t)}clearActionBindings(t){const e=this.actions[t];if(!e)throw new Error(`Action "${t}" doesn't exist`);e.bindings=[]}timeHeld(t){const e=this.actions[t];return e?e.timeHeld:0}held(t){return this.timeHeld(t)>0}justPressed(t){return 1===this.timeHeld(t)}newestHeld(t){let e=null,i=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER;for(const s of t){const t=this.actions[s];if(!t)continue;const o=t.timeHeld,a=t.sameFrameOrdering;(o>0&&o<i||o===i&&a<n)&&(e=s,i=o,n=a)}return e}autoRepeat(t,e=15,i=3){const n=this.timeHeld(t);return 1===n||n>=e&&(n-e)%i==0}autoRepeatNewest(t,e=15,i=3){const n=this.newestHeld(t);if(!n)return null;const s=this.timeHeld(n);return 1===s||s>=e&&(s-e)%i==0?n:null}}function k(t,e,i){return Math.max(Math.min(t,i),e)}function L(t,e,i){return i<=0?t:i>=1?e:t+i*(e-t)}function T(t,e){return(e-t)/2}function S(t){return fetch(t).then((t=>{if(!t.ok)throw Error(`HTTP response ${t.status}: ${t.statusText}`);return t.json()}))}class A{constructor(){this.handlers=[]}}class b{constructor(){this.tickLogic=[],this.drawLogic=[],this.tickLoaderLogic=[],this.drawLoaderLogic=[],this.events={},this.queuedEvents=[],this.waitForResources=!0}isLoaded(){if(this.waitForResources){if(p.itemsLoading()<=0&&p.itemErrors().length>0)throw new Error(function(t){if(t.length<=0)return"";let e="";for(const i of t)e+=i+"\n";return e.slice(0,-1)}(p.itemErrors()));return g.allLoaded()}return!0}addLogic(t){this.tickLogic.push(t),this.drawLogic.push(t)}addTickLogic(t){this.tickLogic.push(t)}addDrawLogic(t){this.drawLogic.push(t)}addTickLoaderLogic(t){this.tickLoaderLogic.push(t)}addDrawLoaderLogic(t){this.drawLoaderLogic.push(t)}addLoaderLogic(t){this.tickLoaderLogic.push(t),this.drawLoaderLogic.push(t)}addEventHandler(t,e){this.events[t]||(this.events[t]=new A),this.events[t].handlers.push(e)}pushEvent(t,e=null){this.queuedEvents.push({name:t,data:e})}processEvents(){for(const t of this.queuedEvents){const e=this.events[t.name];if(e)for(const i of e.handlers)i(t.data)}this.queuedEvents=[]}tick(t){const e=this.isLoaded()?this.tickLogic:this.tickLoaderLogic;for(const i of e)this.processEvents(),i.tick(t,this);this.processEvents()}draw(t,e){const i=this.isLoaded()?this.drawLogic:this.drawLoaderLogic;for(const n of i)n.draw(t,this,e)}}const _=1e3/60;class C{constructor(){this.timestamp=0,this.goodSamples=0,this.timings=[],this.lastGoodAverage=_}updateTimings(){const t=performance.now();if(this.timestamp<=0)return void(this.timestamp=t);const e=t-this.timestamp;this.timestamp=t,e>20.1||(this.timings.length>=60&&this.timings.shift(),this.timings.length>0&&(Math.abs(this.timings[this.timings.length-1]-e)>6||Math.abs(this.averageRateRaw()-e)>6?this.goodSamples=0:this.goodSamples+=1),this.timings.push(e))}averageRateRaw(){let t=0;for(const e of this.timings)t+=e;return t/this.timings.length}averageRate(){return this.hasEnoughSamples()&&(this.lastGoodAverage=this.averageRateRaw()),this.lastGoodAverage}shouldLerp(){const t=this.averageRate();return Math.abs(t-_)>1}hasEnoughSamples(){return this.goodSamples>60}reset(){this.timestamp=0,this.goodSamples=0,this.timings=[]}}class M{constructor(t,e){this.currentScene=new b,this.pendingSceneFunc=null,this.vsyncRate=new C,this.lastTick=performance.now(),this.tickQueue=0,this.framesSinceTickLag=0,this.doDraw=!1,this.doLerp=!1,this.running=!1,this.broken=!1,this.errorText="",this.singleton=e,this.gameInput=new m,this.gameRenderer=new w(t),window.addEventListener("unhandledrejection",(t=>{this.handleError(t.reason,"Unhandled Promise rejection"),t.preventDefault()}))}run(){if(this.running)throw new Error("run() already called");this.running=!0,this.lastTick=performance.now(),this.tickQueue=0,requestAnimationFrame(this.timerUpdate.bind(this))}scene(){return this.currentScene}setScene(t){this.pendingSceneFunc=t}input(){return this.gameInput}renderer(){return this.gameRenderer}timerUpdate(){try{this.vsyncRate.updateTimings(),null!==this.pendingSceneFunc&&(this.currentScene=this.pendingSceneFunc(),this.pendingSceneFunc=null),this.updateTicks(),this.updateDraw(),this.running&&!this.broken&&requestAnimationFrame(this.timerUpdate.bind(this))}catch(t){this.handleError(t)}this.errorText.length>0&&this.showError()}updateTicks(){const t=performance.now();for(this.tickQueue+=t-this.lastTick,this.lastTick=t;this.tickQueue>=_;){this.gameInput.newFrame(),this.currentScene.tick(this),this.framesSinceTickLag++,this.doDraw=!0,this.tickQueue-=_;const e=performance.now();if(e-t>33.333333333333336){this.tickQueue=0,this.lastTick=e,this.framesSinceTickLag=0;break}}this.doLerp=this.vsyncRate.shouldLerp()&&this.framesSinceTickLag>=4}updateDraw(){if(!this.doDraw)return;let t;this.doLerp?t=this.tickQueue/_:(t=1,this.doDraw=!1),this.gameRenderer.reset(),this.currentScene.draw(this,t)}handleError(t,e=""){let i="",n="Error reached app toplevel!";e.length>0&&(n+="\n"+e),t instanceof Error?(i=`${t.name}\n${t.message}`,n+="\n"+t.stack??`${t.name}: ${t.message}`):(i="Unknown error occurred.",n+="\n"+String(t)),console.error(n),this.errorText+=i+"\n",this.broken=!0}showError(){if(!this.errorText)return;const t=this.gameRenderer.canvas(),[e,i]=[32,32];for(const n of[[1,0],[-1,0],[0,-1],[0,1]])this.gameRenderer.drawText(this.errorText,e+n[0],i+n[1],"14px Consolas","rgb(0, 0, 0, 1.0)",t.width-64);this.gameRenderer.drawText(this.errorText,e,i,"14px Consolas","rgb(255, 255, 255, 1.0)",t.width-64)}}const P=JSON.parse('{"wall":[{"x":0,"y":0,"w":32,"h":32},{"x":32,"y":0,"w":32,"h":32},{"x":64,"y":0,"w":32,"h":32},{"x":96,"y":0,"w":32,"h":32},{"x":128,"y":0,"w":32,"h":32},{"x":160,"y":0,"w":32,"h":32},{"x":192,"y":0,"w":32,"h":32},{"x":224,"y":0,"w":32,"h":32},{"x":0,"y":32,"w":32,"h":32},{"x":32,"y":32,"w":32,"h":32},{"x":64,"y":32,"w":32,"h":32},{"x":96,"y":32,"w":32,"h":32},{"x":128,"y":32,"w":32,"h":32},{"x":160,"y":32,"w":32,"h":32},{"x":192,"y":32,"w":32,"h":32},{"x":224,"y":32,"w":32,"h":32}],"floor":[{"x":0,"y":64,"w":32,"h":32},{"x":64,"y":64,"w":32,"h":32},{"x":128,"y":64,"w":32,"h":32},{"x":192,"y":64,"w":32,"h":32}],"dropzone":[{"x":32,"y":64,"w":32,"h":32},{"x":96,"y":64,"w":32,"h":32},{"x":160,"y":64,"w":32,"h":32},{"x":224,"y":64,"w":32,"h":32}],"bg":[{"x":0,"y":96,"w":32,"h":32},{"x":32,"y":96,"w":32,"h":32},{"x":64,"y":96,"w":32,"h":32},{"x":96,"y":96,"w":32,"h":32}],"playerDown":[{"x":0,"y":160,"w":32,"h":32},{"x":32,"y":160,"w":32,"h":32},{"x":0,"y":160,"w":32,"h":32},{"x":64,"y":160,"w":32,"h":32}],"playerRight":[{"x":96,"y":160,"w":32,"h":32},{"x":128,"y":160,"w":32,"h":32},{"x":96,"y":160,"w":32,"h":32},{"x":160,"y":160,"w":32,"h":32}],"playerLeft":[{"x":0,"y":192,"w":32,"h":32},{"x":32,"y":192,"w":32,"h":32},{"x":0,"y":192,"w":32,"h":32},{"x":64,"y":192,"w":32,"h":32}],"playerUp":[{"x":96,"y":192,"w":32,"h":32},{"x":128,"y":192,"w":32,"h":32},{"x":160,"y":192,"w":32,"h":32},{"x":192,"y":192,"w":32,"h":32}],"playerHmm":{"x":192,"y":160,"w":32,"h":32},"playerWin":{"x":224,"y":192,"w":32,"h":32},"playerHead":{"x":0,"y":128,"w":32,"h":32},"crate":[{"x":0,"y":224,"w":32,"h":32},{"x":32,"y":224,"w":32,"h":32},{"x":64,"y":224,"w":32,"h":32},{"x":96,"y":224,"w":32,"h":32}],"confetti":[{"x":224,"y":160,"w":8,"h":8},{"x":240,"y":160,"w":8,"h":8},{"x":232,"y":168,"w":8,"h":8},{"x":248,"y":168,"w":8,"h":8},{"x":224,"y":176,"w":8,"h":8}]}');var O=s.t(P,2);const E=O;class I{constructor(t){this.canvas=null,this.scrollSpeed=t,this.image=new g("res/GameAtlas32.png")}createCanvas(){if(this.canvas||!g.allLoaded())return;const t=[],e=E.bg[0].w,i=E.bg[0].h;for(let e=0;e<1024;++e)t.push(Math.random()<.3);const n=new OffscreenCanvas(32*e,32*i),s=n.getContext("2d");if(!s)throw new Error("Offscreen canvas context failed");const o=Math.ceil(n.width/e)+1,a=Math.ceil(n.height/i)+1;for(let e=0;e<a;++e)for(let i=0;i<o;++i){let n=(i+e)%2?1:0;const[o,a]=[i%32,e%32];t[o+32*a]&&(n+=2);const h=E.bg[n];s.drawImage(this.image.sharedData().image(),h.x,h.y,h.w,h.h,i*h.w,e*h.h,h.w,h.h)}this.canvas=n}tick(t,e){t.singleton.bgScroll+=this.scrollSpeed}draw(t,e,i){if(this.createCanvas(),!this.canvas)return;const n=t.singleton,s=t.renderer(),[o,a]=[s.canvas().width,s.canvas().height],h=Math.ceil(o/this.canvas.width)+1,r=Math.ceil(a/this.canvas.height)+1,f=s.context(),c=L(n.bgScroll-this.scrollSpeed,n.bgScroll,i)%this.canvas.height;for(let t=0;t<r;++t)for(let e=0;e<h;++e)f.drawImage(this.canvas,Math.floor(e*this.canvas.width-c),Math.floor(t*this.canvas.height-c))}}class F{constructor(t,e,i,n){this.x=t,this.y=e,this.originalX=t,this.lineHeight=n.lineHeight,this.wrapWidth=i}advance(t){this.x+=t.xAdvance}newLine(){this.x=this.originalX,this.y+=this.lineHeight}}class R{constructor(t){this.x=0,this.y=0,this.w=0,this.h=0,this.xOffset=0,this.yOffset=0,this.xAdvance=0,this.page=0,Object.assign(this,t)}}class D{constructor(t){if(this.chars={},this.lineHeight=t.common.lineHeight,this.pages=t.pages.map((t=>new g(t))),this.pages.length<=0)throw new Error("No texture pages defined in font descriptor");for(const e of t.chars)this.chars[e.id]=new R({x:e.x,y:e.y,w:e.width,h:e.height,xOffset:e.xoffset,yOffset:e.yoffset,xAdvance:e.xadvance,page:e.page})}getChar(t){return this.chars[t]??this.chars[63]??new R}readChar(t,e){switch(t){case 10:return e.newLine(),null;case 13:return null}const i=this.getChar(t);return e.x+i.xOffset+i.w>e.originalX+e.wrapWidth&&e.newLine(),i}printChar(t,e,i){const n=this.pages[t.page];i.drawSprite(n,{x:t.x,y:t.y,w:t.w,h:t.h},e.x+t.xOffset,e.y+t.yOffset)}measureText(t){const e=new F(0,0,1/0,this),i=t.split(" "),n=this.getChar(32);for(const t of i){const i=Array.from(t);for(const t of i){const i=t.codePointAt(0)??0,n=this.readChar(i,e);n&&e.advance(n)}e.advance(n)}return e.x-n.xAdvance}drawText(t,e,i,n,s=1/0,o=Number.MAX_SAFE_INTEGER){const a=new F(i,n,s,this),h=e.split(" "),r=this.getChar(32);let f=0;for(const e of h){const n=Array.from(e);let h=a.x;for(const t of n){const e=t.codePointAt(0)??0,n=this.getChar(e);if(h+n.xOffset+n.w>i+s){a.newLine(),f++;break}h+=n.xAdvance}if(f>=o)break;for(const e of n){const i=e.codePointAt(0)??0,n=this.readChar(i,a);n&&(this.printChar(n,a,t),a.advance(n))}a.advance(r)}}}class W extends b{constructor(t){super(),this.highestPriority=Number.MIN_SAFE_INTEGER,this.focused=null,this.newFocused=null,this.input=t}tick(t){this.focused&&this.isLoaded()&&this.focused.focusTick(t,this),super.tick(t),this.focused=this.newFocused,this.newFocused=null,this.highestPriority=Number.MIN_SAFE_INTEGER}requestFocus(t,e){this.highestPriority<=e&&(this.highestPriority=e,this.newFocused=t)}focusedItem(){return this.focused}focusedInput(t){return t===this.focused?this.input:null}}class N{constructor(t){this.scene=t}keepActive(t){this.scene.requestFocus(this,t)}focused(){return this.scene.focusedItem()===this}focusedInput(){return this.scene.focusedInput(this)}getScene(){return this.scene}}const j={width:640,height:192,buttons:[{x:64,y:64,text:(t,e)=>`Deadlock Analysis: ${function(t){switch(t){case 0:return"None";case 1:return"Static Corners/Edges";default:throw new Error("Bad enum")}}(e.singleton.preferences.analysis)}`,alignment:0,maxWidth:-1,maxLines:1,onActivate:()=>{},onAdjust:(t,e,i)=>{const n=i.singleton.preferences;n.analysis=(n.analysis+2+t)%2,e.getScene().pushEvent("preferencesChanged",n),n.toLocalStorage()}},{x:64,y:96,text:(t,e)=>`Analysis Action: ${function(t){switch(t){case 0:return"Show Deadlocks";case 1:return"Prevent Deadlocks";case 2:return"Show And Prevent Deadlocks";default:throw new Error("Bad enum")}}(e.singleton.preferences.analysisAction)}`,alignment:0,maxWidth:-1,maxLines:1,onActivate:()=>{},onAdjust:(t,e,i)=>{const n=i.singleton.preferences;n.analysisAction=(n.analysisAction+3+t)%3,e.getScene().pushEvent("preferencesChanged",n),n.toLocalStorage()}},{x:0,y:160,text:()=>"Back",alignment:1,maxWidth:-1,maxLines:1,onActivate:t=>{t.back()},onAdjust:()=>{}}],labels:[{x:0,y:16,alignment:1,maxWidth:-1,maxLines:1,text:()=>"Game Settings"}]},H={width:640,height:288,buttons:[{x:0,y:160,text:t=>t.isIngame()?"Continue":"Close This Menu",alignment:1,maxWidth:-1,maxLines:1,onActivate:t=>{t.close()},onAdjust:()=>{}},{x:0,y:192,text:t=>t.isIngame()?"Restart":"Play Level",alignment:1,maxWidth:-1,maxLines:1,onActivate:(t,e)=>{e.setScene((()=>dt(e)))},onAdjust:()=>{}},{x:0,y:224,text:()=>"Settings",alignment:1,maxWidth:-1,maxLines:1,onActivate:(t,e)=>{t.enterMenu(j)},onAdjust:()=>{}},{x:0,y:256,text:()=>"Main Menu",alignment:1,maxWidth:-1,maxLines:1,onActivate:(t,e)=>{e.setScene((()=>Pt(e.input())))},onAdjust:()=>{}}],labels:[{x:0,y:16,alignment:1,maxWidth:-1,maxLines:1,text:(t,e)=>{const i=e.singleton,n=i.levels[i.currentCollection];return n?`Levelset: ${n.name}`:""}},{x:16,y:48,alignment:0,maxWidth:608,maxLines:1,text:(t,e)=>{const i=e.singleton,n=i.levels[i.currentCollection];if(!n)return"";const s=n.levels[i.currentLevel];let o=`Level ${i.currentLevel+1}`;return s?(s.name&&s.name.length>0&&(o+=`: ${s.name}`),o):""}},{x:16,y:80,alignment:0,maxWidth:608,maxLines:2,text:(t,e)=>{const i=e.singleton,n=i.levels[i.currentCollection];if(!n)return"";const s=n.levels[i.currentLevel];if(!s)return"";let o="Anonymous";return s.author&&s.author.length>0?o=s.author:n.author.length>0&&(o=n.author),`by ${o}`}}]},B=JSON.parse('{"title":{"x":1,"y":1,"w":644,"h":150},"arrowRight":{"x":1,"y":161,"w":12,"h":22},"arrowLeft":{"x":19,"y":161,"w":12,"h":22},"arrowUp":{"x":33,"y":161,"w":20,"h":14},"arrowDown":{"x":33,"y":177,"w":20,"h":14},"starWhite":[{"x":65,"y":161,"w":14,"h":12},{"x":81,"y":161,"w":14,"h":12}],"starBlack":[{"x":65,"y":175,"w":14,"h":12},{"x":81,"y":175,"w":14,"h":12}]}');var U=s.t(B,2);const $=JSON.parse('{"pages":["res/Pixel12x10_0.png"],"chars":[{"id":32,"x":119,"y":104,"width":4,"height":2,"xoffset":-2,"yoffset":14,"xadvance":12,"page":0,"chnl":15},{"id":33,"x":252,"y":14,"width":3,"height":13,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":34,"x":190,"y":94,"width":7,"height":6,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":35,"x":132,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":36,"x":144,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":37,"x":156,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":38,"x":168,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":39,"x":252,"y":38,"width":3,"height":6,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":40,"x":8,"y":88,"width":6,"height":13,"xoffset":1,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":41,"x":15,"y":88,"width":6,"height":13,"xoffset":3,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":42,"x":96,"y":84,"width":11,"height":10,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":43,"x":76,"y":101,"width":9,"height":9,"xoffset":0,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":44,"x":252,"y":45,"width":3,"height":5,"xoffset":2,"yoffset":9,"xadvance":7,"page":0,"chnl":15},{"id":45,"x":96,"y":105,"width":9,"height":3,"xoffset":0,"yoffset":5,"xadvance":11,"page":0,"chnl":15},{"id":46,"x":250,"y":94,"width":3,"height":3,"xoffset":2,"yoffset":9,"xadvance":7,"page":0,"chnl":15},{"id":47,"x":174,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":48,"x":36,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":49,"x":132,"y":70,"width":10,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":50,"x":60,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":51,"x":72,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":52,"x":84,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":53,"x":96,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":54,"x":108,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":55,"x":120,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":56,"x":96,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":57,"x":144,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":58,"x":252,"y":28,"width":3,"height":9,"xoffset":3,"yoffset":2,"xadvance":8,"page":0,"chnl":15},{"id":59,"x":74,"y":88,"width":5,"height":12,"xoffset":0,"yoffset":2,"xadvance":7,"page":0,"chnl":15},{"id":60,"x":88,"y":88,"width":7,"height":11,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":61,"x":158,"y":94,"width":9,"height":7,"xoffset":0,"yoffset":3,"xadvance":11,"page":0,"chnl":15},{"id":62,"x":80,"y":88,"width":7,"height":11,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":63,"x":216,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":64,"x":228,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":65,"x":240,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":66,"x":0,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":67,"x":12,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":68,"x":24,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":69,"x":36,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":70,"x":48,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":71,"x":60,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":72,"x":72,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":73,"x":246,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":74,"x":96,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":75,"x":108,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":76,"x":120,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":77,"x":132,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":78,"x":144,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":79,"x":156,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":80,"x":132,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":81,"x":180,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":82,"x":192,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":83,"x":204,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":84,"x":216,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":85,"x":228,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":86,"x":240,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":87,"x":0,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":88,"x":12,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":89,"x":24,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":90,"x":36,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":91,"x":22,"y":88,"width":5,"height":13,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":92,"x":214,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":93,"x":28,"y":88,"width":5,"height":13,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":94,"x":180,"y":94,"width":9,"height":6,"xoffset":0,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":95,"x":226,"y":94,"width":11,"height":3,"xoffset":-1,"yoffset":10,"xadvance":12,"page":0,"chnl":15},{"id":96,"x":208,"y":94,"width":5,"height":5,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":97,"x":120,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":98,"x":132,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":99,"x":132,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":100,"x":156,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":101,"x":144,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":102,"x":164,"y":70,"width":9,"height":13,"xoffset":1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":103,"x":192,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":104,"x":204,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":105,"x":58,"y":88,"width":7,"height":12,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":106,"x":85,"y":0,"width":10,"height":16,"xoffset":-1,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":107,"x":228,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":108,"x":222,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":109,"x":156,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":110,"x":168,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":111,"x":180,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":112,"x":36,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":113,"x":48,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":114,"x":228,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":115,"x":192,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":116,"x":84,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":117,"x":204,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":118,"x":108,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":119,"x":12,"y":102,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":120,"x":0,"y":102,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":121,"x":120,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":122,"x":240,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":123,"x":59,"y":0,"width":8,"height":17,"xoffset":0,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":124,"x":81,"y":0,"width":3,"height":17,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":125,"x":68,"y":0,"width":8,"height":17,"xoffset":1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":126,"x":168,"y":94,"width":11,"height":6,"xoffset":-1,"yoffset":4,"xadvance":12,"page":0,"chnl":15},{"id":160,"x":114,"y":105,"width":4,"height":2,"xoffset":-2,"yoffset":14,"xadvance":5,"page":0,"chnl":15},{"id":161,"x":252,"y":0,"width":3,"height":13,"xoffset":3,"yoffset":3,"xadvance":8,"page":0,"chnl":15},{"id":162,"x":216,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":163,"x":144,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":164,"x":106,"y":95,"width":9,"height":9,"xoffset":0,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":165,"x":156,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":166,"x":77,"y":0,"width":3,"height":17,"xoffset":3,"yoffset":-1,"xadvance":8,"page":0,"chnl":15},{"id":167,"x":24,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":168,"x":106,"y":105,"width":7,"height":3,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":169,"x":168,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":170,"x":116,"y":94,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":171,"x":147,"y":94,"width":10,"height":8,"xoffset":-1,"yoffset":3,"xadvance":11,"page":0,"chnl":15},{"id":172,"x":198,"y":94,"width":9,"height":5,"xoffset":0,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":174,"x":180,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":175,"x":238,"y":94,"width":11,"height":3,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":176,"x":66,"y":101,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":177,"x":46,"y":88,"width":11,"height":12,"xoffset":-1,"yoffset":0,"xadvance":12,"page":0,"chnl":15},{"id":178,"x":126,"y":94,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":179,"x":96,"y":95,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":180,"x":214,"y":94,"width":5,"height":5,"xoffset":2,"yoffset":-1,"xadvance":9,"page":0,"chnl":15},{"id":181,"x":192,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":182,"x":204,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":183,"x":252,"y":84,"width":3,"height":3,"xoffset":3,"yoffset":4,"xadvance":8,"page":0,"chnl":15},{"id":184,"x":220,"y":94,"width":5,"height":5,"xoffset":0,"yoffset":11,"xadvance":7,"page":0,"chnl":15},{"id":185,"x":86,"y":100,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":186,"x":46,"y":101,"width":9,"height":9,"xoffset":-1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":187,"x":136,"y":94,"width":10,"height":8,"xoffset":0,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":188,"x":216,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":189,"x":228,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":190,"x":240,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":191,"x":0,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":192,"x":12,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":193,"x":24,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":194,"x":36,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":195,"x":48,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":196,"x":60,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":197,"x":72,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":198,"x":84,"y":74,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":199,"x":12,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":200,"x":96,"y":70,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":201,"x":108,"y":70,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":202,"x":120,"y":70,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":203,"x":108,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":204,"x":198,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":205,"x":0,"y":88,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":206,"x":238,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":207,"x":230,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":208,"x":120,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":209,"x":180,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":210,"x":192,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":211,"x":204,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":212,"x":216,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":213,"x":228,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":214,"x":240,"y":0,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":215,"x":56,"y":101,"width":9,"height":9,"xoffset":0,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":216,"x":0,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":217,"x":12,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":218,"x":24,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":219,"x":48,"y":18,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":220,"x":156,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":221,"x":168,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":222,"x":154,"y":70,"width":9,"height":13,"xoffset":0,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":223,"x":143,"y":70,"width":10,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":224,"x":180,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":225,"x":192,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":226,"x":204,"y":14,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":227,"x":84,"y":32,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":228,"x":168,"y":28,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":229,"x":48,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":230,"x":216,"y":84,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":231,"x":60,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":232,"x":72,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":233,"x":84,"y":46,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":234,"x":96,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":235,"x":132,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":236,"x":206,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":237,"x":190,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":238,"x":182,"y":70,"width":7,"height":13,"xoffset":1,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":239,"x":66,"y":88,"width":7,"height":12,"xoffset":1,"yoffset":0,"xadvance":10,"page":0,"chnl":15},{"id":240,"x":108,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":241,"x":120,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":242,"x":144,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":243,"x":168,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":244,"x":180,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":245,"x":240,"y":42,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":246,"x":0,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":247,"x":36,"y":101,"width":9,"height":9,"xoffset":0,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":248,"x":34,"y":88,"width":11,"height":12,"xoffset":-1,"yoffset":1,"xadvance":12,"page":0,"chnl":15},{"id":249,"x":12,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":250,"x":24,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":251,"x":60,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":252,"x":72,"y":60,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":253,"x":0,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":254,"x":48,"y":0,"width":10,"height":17,"xoffset":0,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":255,"x":36,"y":0,"width":11,"height":17,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":338,"x":96,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":339,"x":24,"y":102,"width":11,"height":9,"xoffset":-1,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":8364,"x":108,"y":56,"width":11,"height":13,"xoffset":-1,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":12288,"x":124,"y":104,"width":4,"height":2,"xoffset":-2,"yoffset":14,"xadvance":16,"page":0,"chnl":15}],"kernings":[],"info":{"face":"Pixel12x10","size":16,"bold":0,"italic":0,"charset":"","unicode":1,"stretchH":100,"smooth":0,"aa":1,"padding":[1,0,0,1],"spacing":[1,1],"outline":0},"common":{"lineHeight":20,"base":12,"scaleW":256,"scaleH":256,"pages":1,"packed":0,"alphaChnl":0,"redChnl":4,"greenChnl":4,"blueChnl":4}}');var z=s.t($,2);const K=U;class G extends N{constructor(t){super(t),this.picture=new g("res/TitleAtlas.png"),this.isOpen=!1,this.cursorIndex=0,this.currentMenu=H,this.menuStack=[],this.font=new D(z),t.addEventHandler("openMenu",(()=>{this.open()}))}open(){this.isOpen=!0,this.currentMenu=H,this.menuStack=[],this.cursorIndex=0}close(){this.isOpen=!1}back(){const t=this.menuStack.pop();void 0!==t?(this.currentMenu=t.menu,this.cursorIndex=t.index):this.close()}enterMenu(t){this.menuStack.push({menu:this.currentMenu,index:this.cursorIndex}),this.currentMenu=t,this.cursorIndex=0}isIngame(){return this.getScene()instanceof ct}focusTick(t,e){const i=t.input();if(t.input().justPressed("menu"))return void this.back();const n=i.autoRepeatNewest(["left","right","up","down"]),s=this.currentMenu.buttons[this.cursorIndex];switch(n){case"up":this.cursorIndex--;break;case"down":this.cursorIndex++;break;case"left":s&&s.onAdjust(-1,this,t);break;case"right":s&&s.onAdjust(1,this,t)}this.cursorIndex=(this.cursorIndex+this.currentMenu.buttons.length)%this.currentMenu.buttons.length,i.justPressed("accept")&&s&&s.onActivate(this,t)}tick(t,e){this.isOpen&&this.keepActive(100)}draw(t,e,i){if(!this.isOpen)return;const n=t.renderer(),[s,o]=[n.canvas().width,n.canvas().height],a=this.currentMenu.width,h=this.currentMenu.height,r=T(a,s),f=T(h,o);n.drawRect(r,f,a,h,"rgb(22, 26, 55, 0.85)"),n.drawRectOutline(r-.5,f-.5,a+1,h+1,"rgb(224, 224, 224, 0.7)");const c=(e,i)=>{let s=r+e.x;const o=e.maxWidth>0?e.maxWidth:a-e.x,h=e.text(this,t);1===e.alignment&&(s+=T(this.font.measureText(h),a)),this.font.drawText(n,h,s,f+e.y,o,e.maxLines),i&&n.drawSprite(this.picture,K.arrowRight,s-24,f+e.y-4)};for(const t of this.currentMenu.labels)c(t,!1);for(let t=0;t<this.currentMenu.buttons.length;++t)c(this.currentMenu.buttons[t],this.cursorIndex===t)}}var X,J,q,V;function Y(t){switch(t){case X.Left:return{x:-1,y:0};case X.Right:return{x:1,y:0};case X.Up:return{x:0,y:-1};case X.Down:return{x:0,y:1}}}function Q(t){switch(t){case X.Left:return X.Right;case X.Right:return X.Left;case X.Up:return X.Down;case X.Down:return X.Up}}!function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Up=2]="Up",t[t.Down=3]="Down"}(X||(X={})),function(t){t[t.Player=0]="Player",t[t.Crate=1]="Crate"}(J||(J={}));class Z{constructor(t,e,i){this.x=0,this.y=0,this.picture=null,this.slice=new u(0,0,0,0),this.solid=!0,this.x=t,this.y=e,this.board=i}getPosition(){return{x:this.x,y:this.y}}setPosition(t,e){this.x=t,this.y=e}getBoardPosition(){return{x:this.x*this.board.tileWidth+this.board.x,y:this.y*this.board.tileHeight+this.board.y}}isTileFree(t,e){return this.board.tile(t,e)!==q.Wall}isTokenFree(t,e){const i=this.board.tokensForTile(t,e);for(const t of i)if(t.solid)return!1;return!0}isFree(t,e){return this.isTileFree(t,e)&&this.isTokenFree(t,e)}draw(t,e,i){this.picture&&t.drawSprite(this.picture,this.slice,e,i)}}class tt{constructor(t,e,i,n){this.start={x:t,y:e},this.delta=Y(i),this.check=Y(n)}}class et{constructor(t){this.analysisMode=0,this.analysisAction=0,this.board=t,this.restricted=new Array(t.width*t.height),this.restricted.fill(!1)}setRestricted(t,e){this.board.posInRange(t,e)&&(this.restricted[t+e*this.board.width]=!0)}isBlocked(t,e){return this.board.tile(t,e)===q.Wall}recomputerStaticEdges(t){const e=Math.max(this.board.width,this.board.height);t:for(const i of t){let t=i.start.x,n=i.start.y,s=0;e:for(;s<e;){t+=i.delta.x,n+=i.delta.y;const e=this.board.tile(t,n),o=this.board.tile(t+i.check.x,n+i.check.y);if(e===q.Wall||!this.board.posInRange(t,n)||this.isRestricted(t,n))break e;if(e===q.Dropzone||o!==q.Wall)continue t;s++}t=i.start.x,n=i.start.y;for(let e=0;e<s;++e)t+=i.delta.x,n+=i.delta.y,this.setRestricted(t,n)}}recomputeStaticCorners(){const t=[];function e(e,i,n,s){t.push(new tt(e,i,Q(n),s)),t.push(new tt(e,i,Q(s),n))}for(let t=0;t<this.board.height;++t)for(let i=0;i<this.board.width;++i){if(this.board.tile(i,t)===q.Dropzone)continue;const n=this.isBlocked(i-1,t),s=this.isBlocked(i+1,t),o=this.isBlocked(i,t-1),a=this.isBlocked(i,t+1);let h=!1;n&&o&&(e(i,t,X.Left,X.Up),h=!0),s&&o&&(e(i,t,X.Right,X.Up),h=!0),n&&a&&(e(i,t,X.Left,X.Down),h=!0),s&&a&&(e(i,t,X.Right,X.Down),h=!0),h&&this.setRestricted(i,t)}this.recomputerStaticEdges(t)}recomputeAnalysis(){switch(this.restricted.fill(!1),this.analysisMode){case 0:break;case 1:this.recomputeStaticCorners()}this.board.setDirty()}shouldShowRestricted(){switch(this.analysisAction){case 0:case 2:return!0}return!1}shouldPreventRestricted(){switch(this.analysisAction){case 1:case 2:return!0}return!1}setAnalysisMode(t,e){this.analysisMode=t,this.analysisAction=e,this.recomputeAnalysis()}isRestricted(t,e){return!!this.board.posInRange(t,e)&&this.restricted[this.board.posToIndex(t,e)]}}!function(t){t[t.None=0]="None",t[t.Floor=1]="Floor",t[t.Wall=2]="Wall",t[t.Dropzone=3]="Dropzone"}(q||(q={}));class it{constructor(t,e,i,n){this.x=0,this.y=0,this.dirty=!0,this.tokens=[],this.tokenPositions=new Map,this.width=t,this.height=e,this.tiles=new Array(t*e),this.tiles.fill(q.None),this.displayTiles=new Array(t*e),this.displayTiles.fill(null),this.picture=i,this.slices=n,this.tileWidth=n.wall[0].w,this.tileHeight=n.wall[0].h,this.tileTokens=new Array(t*e),this.analysis=new et(this);for(let i=0;i<t*e;++i)this.tileTokens[i]=[]}floodFillFloor(t){let e=t;const i=Array(this.width*this.height).fill(!1);for(;e.length>0;){const t=[];for(const n of e){const e=n.y;let s=n.x;if(this.posInRange(s,e)&&this.tile(s,e)!==q.Wall&&!0!==i[s+e*this.width]){for(;s>0&&this.tile(s-1,e)!==q.Wall;)s--;for(;s<this.width&&this.tile(s,e)!==q.Wall;)this.tile(s,e)===q.None&&this.setTile(s,e,q.Floor),i[s+e*this.width]=!0,e>0&&t.push({x:s,y:e-1}),e<this.height-1&&t.push({x:s,y:e+1}),s++}}e=t}}static fromLevel(t,e,i,n){const s=t.tiles,o=t.measureDimensions(),a=new it(o.x,o.y,e,i),h=[],r=[];for(let t=0;t<o.y;++t){const e=s[t];for(let i=0;i<o.x;++i){const n=e[i];let s=q.None;switch(n){case void 0:case" ":case"@":case"$":s=q.None;break;case"#":s=q.Wall;break;case".":case"+":case"*":s=q.Dropzone;break;default:throw new Error(`Unrecognized tile character: ${n}`)}switch(a.setTile(i,t,s),n){case"@":case"+":r.push({x:i,y:t,tokenType:J.Player});break;case"$":case"*":r.push({x:i,y:t,tokenType:J.Crate})}}}for(const t of r)h.push({x:t.x,y:t.y});return n(a,r),a.floodFillFloor(h),a}neighborBits(t,e){let i=0;return this.tile(t,e-1)===q.Wall&&(i+=1),this.tile(t+1,e)===q.Wall&&(i+=2),this.tile(t,e+1)===q.Wall&&(i+=4),this.tile(t-1,e)===q.Wall&&(i+=8),i}updateDisplayTiles(){this.dirty=!1;const t=this.analysis.shouldShowRestricted();let e=0;for(let i=0;i<this.height;++i)for(let n=0;n<this.width;++n){const s=this.tile(n,i),o=t&&this.analysis.isRestricted(n,i);switch(s){case q.None:this.displayTiles[e]=null;break;case q.Floor:this.displayTiles[e]=this.slices.floor[o?1:0];break;case q.Dropzone:this.displayTiles[e]=this.slices.dropzone[o?1:0];break;case q.Wall:{const t=this.neighborBits(n,i);this.displayTiles[e]=this.slices.wall[t];break}}++e}}addToken(t){if(t.board!==this)throw new Error("Token does not belong to board");const e=t.getPosition();this.tokens.push(t),this.tokenPositions.set(t,{x:Math.round(e.x),y:Math.round(e.y)}),this.addTokenToTile(t,e.x,e.y)}getTokens(){return this.tokens}tokensForTile(t,e){return this.posInRange(t,e)?this.tileTokens[this.posToIndex(t,e)]:[]}removeTokenFromTile(t,e,i){if(!this.posInRange(e,i))return;const n=this.tileTokens[this.posToIndex(e,i)],s=n.indexOf(t);s>-1&&n.splice(s,1)}addTokenToTile(t,e,i){this.posInRange(e,i)&&this.tileTokens[this.posToIndex(e,i)].push(t)}moveToken(t,e,i){const n=this.tokenPositions.get(t);n&&this.removeTokenFromTile(t,n.x,n.y),this.addTokenToTile(t,e,i),this.tokenPositions.set(t,{x:Math.round(e),y:Math.round(i)})}posToIndex(t,e){return Math.round(t)+Math.round(e)*this.width}posInRange(t,e){const i=Math.round(t),n=Math.round(e);return!(i<0||i>=this.width||n<0||n>=this.height)}tile(t,e){return this.posInRange(t,e)?this.tiles[this.posToIndex(t,e)]:q.None}setTile(t,e,i){if(!this.posInRange(t,e))throw new Error("Tile coordinates out of range");this.tiles[this.posToIndex(t,e)]=i,this.dirty=!0}setDirty(){this.dirty=!0}getAnalysis(){return this.analysis}draw(t){this.dirty&&this.updateDisplayTiles();let e=0;for(let i=0;i<this.height;++i)for(let n=0;n<this.width;++n){const s=this.displayTiles[e];s&&t.drawSprite(this.picture,s,this.x+n*this.tileWidth,this.y+i*this.tileHeight),++e}for(const e of this.tokens){const i=e.getPosition(),n=i.x*this.tileWidth+this.x,s=i.y*this.tileHeight+this.y;e.draw(t,n,s)}}}class nt extends Z{constructor(t,e,i){super(t,e,i);const n=i.tile(t,e);this.picture=i.picture,this.theme=i.slices,this.slice=this.theme.crate[n===q.Dropzone?1:0]}tryPush(t,e){const i=this.getPosition(),n=Y(t),s=i.x+n.x,o=i.y+n.y;if(this.isFree(s,o)){if(e&&this.board.getAnalysis().isRestricted(s,o))return 2;this.board.moveToken(this,s,o),this.setPosition(s,o);const t=this.board.tile(s,o);return this.slice=this.theme.crate[t===q.Dropzone?1:0],0}return 1}tryPull(t,e,i){const n=this.getPosition(),s=Y(e),o=n.x+s.x,a=n.y+s.y;if(!this.isTileFree(o,a))return 1;const h=this.board.tokensForTile(o,a);for(const e of h)if(e.solid&&e!==t)return 1;if(i&&this.board.getAnalysis().isRestricted(o,a))return 2;this.board.moveToken(this,o,a),this.setPosition(o,a);const r=this.board.tile(o,a);return this.slice=this.theme.crate[r===q.Dropzone?1:0],0}}!function(t){t[t.Forward=0]="Forward",t[t.Backward=1]="Backward"}(V||(V={}));class st extends Z{constructor(t,e,i){super(t,e,i),this.walkFrame=0,this.picture=i.picture,this.theme=i.slices,this.slice=this.theme.playerDown[0]}walkAnimation(t){switch(t){case X.Left:this.slice=this.theme.playerLeft[this.walkFrame];break;case X.Right:this.slice=this.theme.playerRight[this.walkFrame];break;case X.Up:this.slice=this.theme.playerUp[this.walkFrame];break;case X.Down:this.slice=this.theme.playerDown[this.walkFrame]}}winAnimation(){this.slice=this.theme.playerWin}hmmAnimation(){this.slice=this.theme.playerHmm}doWalk(t,e,i){this.board.moveToken(this,t,e),this.setPosition(t,e),i===V.Forward?this.walkFrame=(this.walkFrame+1)%4:this.walkFrame=(this.walkFrame+3)%4}tryWalk(t,e=V.Forward){const i=this.getPosition(),n=Y(t),s=i.x+n.x,o=i.y+n.y;let a=!1;return this.isFree(s,o)&&(this.doWalk(s,o,e),a=!0),this.walkAnimation(e===V.Forward?t:Q(t)),a}tryPush(t,e){const i=this.getPosition(),n=Y(t),s=i.x+n.x,o=i.y+n.y;let a=!1,h=!1;const r=this.board.tokensForTile(s,o);for(const i of r)if(i instanceof nt){const n=i.tryPush(t,e);0===n?(this.doWalk(s,o,V.Forward),a=!0):2===n&&(h=!0);break}return h?this.hmmAnimation():this.walkAnimation(t),a}tryPull(t,e){const i=this.getPosition(),n=Y(t),s=i.x-n.x,o=i.y-n.y,a=i.x+n.x,h=i.y+n.y;let r=!1,f=!1;const c=this.board.tokensForTile(s,o);if(this.isFree(a,h))for(const i of c)if(i instanceof nt){const n=i.tryPull(this,t,e);0===n?(this.doWalk(a,h,V.Backward),r=!0):2===n&&(f=!0);break}return f?this.hmmAnimation():this.walkAnimation(Q(t)),r}}class ot{constructor(t,e,i,n){this.x=t,this.y=e,this.oldX=t,this.oldY=e;const s=i+Math.random()*n,o=28*Math.random()+4;this.velX=Math.cos(s)*o,this.velY=-Math.sin(s)*o-2,this.frame=5*Math.random(),this.frameSpeed=.75*Math.random()+.25}tick(){if(this.oldX=this.x,this.oldY=this.y,this.velY+=.125,this.x+=this.velX,this.y+=this.velY,t=this.velX,e=this.velY,Math.sqrt(Math.pow(t,2)+Math.pow(e,2))>2){this.velX*=.95,this.velY*=.95;const t=2*Math.random()*Math.PI,e=.25*Math.random();this.velX+=Math.cos(t)*e,this.velY+=-Math.sin(t)*e}var t,e;this.frame=(this.frame+this.frameSpeed)%5}}class at{constructor(t,e,i,n){this.picture=i,this.theme=n,this.particles=[];for(let i=0;i<100;++i)this.particles.push(new ot(0,e,Math.PI/8,Math.PI/2)),this.particles.push(new ot(t,e,3*Math.PI/8,Math.PI/2))}tick(){for(const t of this.particles)t.tick()}draw(t,e){for(const i of this.particles){const n=Math.floor(i.frame)%5,s=L(i.oldX,i.x,e),o=L(i.oldY,i.y,e);t.drawSprite(this.picture,this.theme.confetti[n],s,o)}}}const ht=O;var rt;!function(t){t[t.WalkLeft=0]="WalkLeft",t[t.WalkRight=1]="WalkRight",t[t.WalkUp=2]="WalkUp",t[t.WalkDown=3]="WalkDown",t[t.PushLeft=4]="PushLeft",t[t.PushRight=5]="PushRight",t[t.PushUp=6]="PushUp",t[t.PushDown=7]="PushDown"}(rt||(rt={}));class ft extends N{constructor(t,e){super(e),this.picture=new g("res/GameAtlas32.png"),this.action=null,this.history=[],this.redoHistory=[],this.winTimer=0,this.confetti=null;const i=t.singleton,n=i.levels[i.currentCollection];if(!n)throw new Error("Missing collection");const s=n.levels[i.currentLevel];if(!s)throw new Error("Missing level");this.board=it.fromLevel(s,this.picture,ht,((t,e)=>{this.makeTokens(t,e)}));const o=t.renderer().canvas();this.board.x=T(this.board.width*this.board.tileWidth,o.width),this.board.y=T(this.board.height*this.board.tileHeight,o.height),this.preferencesChanged(i.preferences),e.addEventHandler("preferencesChanged",(t=>this.preferencesChanged(t)))}preferencesChanged(t){this.board.getAnalysis().setAnalysisMode(t.analysis,t.analysisAction)}makeTokens(t,e){for(const i of e){let e;switch(i.tokenType){case J.Player:e=new st(i.x,i.y,t);break;case J.Crate:e=new nt(i.x,i.y,t)}t.addToken(e)}}getPlayer(){return this.board.getTokens().find((t=>t instanceof st))}tryWalk(t,e=V.Forward){const i=this.getPlayer();return!!i&&i.tryWalk(t,e)}tryPush(t,e){const i=this.getPlayer();return!!i&&i.tryPush(t,e)}tryPull(t,e){const i=this.getPlayer();return!!i&&i.tryPull(t,e)}doAction(t,e){const i=!e&&this.board.getAnalysis().shouldPreventRestricted();switch(t){case rt.WalkLeft:return this.tryWalk(X.Left);case rt.WalkRight:return this.tryWalk(X.Right);case rt.WalkUp:return this.tryWalk(X.Up);case rt.WalkDown:return this.tryWalk(X.Down);case rt.PushLeft:return this.tryPush(X.Left,i);case rt.PushRight:return this.tryPush(X.Right,i);case rt.PushUp:return this.tryPush(X.Up,i);case rt.PushDown:return this.tryPush(X.Down,i)}}undoAction(t){switch(t){case rt.WalkLeft:return this.tryWalk(X.Right,V.Backward);case rt.WalkRight:return this.tryWalk(X.Left,V.Backward);case rt.WalkUp:return this.tryWalk(X.Down,V.Backward);case rt.WalkDown:return this.tryWalk(X.Up,V.Backward);case rt.PushLeft:return this.tryPull(X.Right,!1);case rt.PushRight:return this.tryPull(X.Left,!1);case rt.PushUp:return this.tryPull(X.Down,!1);case rt.PushDown:return this.tryPull(X.Up,!1)}}tryAction(t){return!!this.doAction(t,!1)&&(this.history.push(t),this.redoHistory.length>0&&this.redoHistory[this.redoHistory.length-1]===t?this.redoHistory.pop():this.redoHistory=[],!0)}undo(){if(this.history.length<=0)return!1;const t=this.history[this.history.length-1];return!!this.undoAction(t)&&(this.history.pop(),this.redoHistory.push(t),!0)}redo(){if(this.redoHistory.length<=0)return!1;const t=this.redoHistory[this.redoHistory.length-1];return!!this.doAction(t,!0)&&(this.redoHistory.pop(),this.history.push(t),!0)}saveWin(t){const e=t.singleton;e.markLevelFinished(),e.saveData.toLocalStorage()}checkWinCondition(t){for(let t=0;t<this.board.height;++t)for(let e=0;e<this.board.width;++e)if(this.board.tile(e,t)===q.Dropzone&&!this.board.tokensForTile(e,t).find((t=>t instanceof nt)))return;this.winTimer<=0&&(this.winTimer=1,this.saveWin(t))}goToNextLevel(t){const e=t.singleton,i=e.levels[e.currentCollection];return!!i&&!!i.levels[e.currentLevel+1]&&(e.currentLevel++,t.setScene((()=>dt(t))),!0)}goToMenu(t){t.setScene((()=>Pt(t.input())))}gameWonTick(t){const e=t.input(),i=this.getPlayer();if(i&&i.winAnimation(),!this.confetti){const e=t.renderer().canvas();this.confetti=new at(e.width,e.height,this.board.picture,this.board.slices)}this.confetti.tick(),(this.winTimer>=300||e.justPressed("accept")&&this.winTimer>=40)&&(this.goToNextLevel(t)||this.goToMenu(t)),this.winTimer++}gameActiveTick(t){if(this.action){switch(this.action){case"left":this.tryAction(rt.WalkLeft)||this.tryAction(rt.PushLeft);break;case"right":this.tryAction(rt.WalkRight)||this.tryAction(rt.PushRight);break;case"up":this.tryAction(rt.WalkUp)||this.tryAction(rt.PushUp);break;case"down":this.tryAction(rt.WalkDown)||this.tryAction(rt.PushDown);break;case"undo":this.undo();break;case"redo":this.redo()}this.board.getAnalysis().recomputeAnalysis(),this.checkWinCondition(t)}this.action=null}focusTick(t,e){if(this.winTimer>0)return;const i=t.input();this.action=i.autoRepeatNewest(["left","right","up","down","undo","redo"]),null===this.action&&i.justPressed("menu")&&e.pushEvent("openMenu")}tick(t,e){this.winTimer<=0?this.gameActiveTick(t):this.gameWonTick(t),this.keepActive(0)}draw(t,e,i){const n=t.renderer();this.board.draw(n),this.confetti&&this.confetti.draw(n,i)}}class ct extends W{}function dt(t){const e=new I(.125),i=new ct(t.input()),n=new ft(t,i),s=new G(i);return i.addDrawLoaderLogic(e),i.addLogic(e),i.addLogic(n),i.addLogic(s),i}const lt=JSON.parse('{"wall":[{"x":0,"y":0,"w":16,"h":16},{"x":16,"y":0,"w":16,"h":16},{"x":32,"y":0,"w":16,"h":16},{"x":48,"y":0,"w":16,"h":16},{"x":64,"y":0,"w":16,"h":16},{"x":80,"y":0,"w":16,"h":16},{"x":96,"y":0,"w":16,"h":16},{"x":112,"y":0,"w":16,"h":16},{"x":0,"y":16,"w":16,"h":16},{"x":16,"y":16,"w":16,"h":16},{"x":32,"y":16,"w":16,"h":16},{"x":48,"y":16,"w":16,"h":16},{"x":64,"y":16,"w":16,"h":16},{"x":80,"y":16,"w":16,"h":16},{"x":96,"y":16,"w":16,"h":16},{"x":112,"y":16,"w":16,"h":16}],"floor":[{"x":0,"y":32,"w":16,"h":16},{"x":0,"y":32,"w":16,"h":16},{"x":0,"y":32,"w":16,"h":16},{"x":0,"y":32,"w":16,"h":16}],"dropzone":[{"x":16,"y":32,"w":16,"h":16},{"x":16,"y":32,"w":16,"h":16},{"x":16,"y":32,"w":16,"h":16},{"x":16,"y":32,"w":16,"h":16}],"playerDown":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerRight":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerLeft":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerUp":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}],"playerHmm":{"x":0,"y":96,"w":16,"h":16},"playerWin":{"x":0,"y":96,"w":16,"h":16},"playerHead":{"x":0,"y":96,"w":16,"h":16},"crate":[{"x":0,"y":112,"w":16,"h":16},{"x":16,"y":112,"w":16,"h":16},{"x":0,"y":112,"w":16,"h":16},{"x":16,"y":112,"w":16,"h":16}],"confetti":[{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16},{"x":0,"y":96,"w":16,"h":16}]}');var xt=s.t(lt,2);const yt=JSON.parse('{"wall":[{"x":0,"y":0,"w":24,"h":24},{"x":24,"y":0,"w":24,"h":24},{"x":48,"y":0,"w":24,"h":24},{"x":72,"y":0,"w":24,"h":24},{"x":96,"y":0,"w":24,"h":24},{"x":120,"y":0,"w":24,"h":24},{"x":144,"y":0,"w":24,"h":24},{"x":168,"y":0,"w":24,"h":24},{"x":0,"y":24,"w":24,"h":24},{"x":24,"y":24,"w":24,"h":24},{"x":48,"y":24,"w":24,"h":24},{"x":72,"y":24,"w":24,"h":24},{"x":96,"y":24,"w":24,"h":24},{"x":120,"y":24,"w":24,"h":24},{"x":144,"y":24,"w":24,"h":24},{"x":168,"y":24,"w":24,"h":24}],"floor":[{"x":0,"y":48,"w":24,"h":24},{"x":0,"y":48,"w":24,"h":24},{"x":0,"y":48,"w":24,"h":24},{"x":0,"y":48,"w":24,"h":24}],"dropzone":[{"x":24,"y":48,"w":24,"h":24},{"x":24,"y":48,"w":24,"h":24},{"x":24,"y":48,"w":24,"h":24},{"x":24,"y":48,"w":24,"h":24}],"playerDown":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerRight":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerLeft":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerUp":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}],"playerHmm":{"x":0,"y":144,"w":24,"h":24},"playerWin":{"x":0,"y":144,"w":24,"h":24},"playerHead":{"x":0,"y":144,"w":24,"h":24},"crate":[{"x":0,"y":168,"w":24,"h":24},{"x":24,"y":168,"w":24,"h":24},{"x":0,"y":168,"w":24,"h":24},{"x":24,"y":168,"w":24,"h":24}],"confetti":[{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24},{"x":0,"y":144,"w":24,"h":24}]}');var pt=s.t(yt,2);const gt=JSON.parse('{"pages":["res/Pixel12x10_Outline_0.png"],"chars":[{"id":32,"x":178,"y":136,"width":6,"height":4,"xoffset":-3,"yoffset":13,"xadvance":12,"page":0,"chnl":15},{"id":33,"x":60,"y":116,"width":5,"height":15,"xoffset":2,"yoffset":-2,"xadvance":8,"page":0,"chnl":15},{"id":34,"x":51,"y":144,"width":9,"height":8,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":35,"x":158,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":36,"x":172,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":37,"x":186,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":38,"x":200,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":39,"x":61,"y":144,"width":5,"height":8,"xoffset":2,"yoffset":-2,"xadvance":8,"page":0,"chnl":15},{"id":40,"x":20,"y":116,"width":8,"height":15,"xoffset":0,"yoffset":-2,"xadvance":9,"page":0,"chnl":15},{"id":41,"x":29,"y":116,"width":8,"height":15,"xoffset":2,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":42,"x":142,"y":112,"width":13,"height":12,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":43,"x":160,"y":124,"width":11,"height":11,"xoffset":-1,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":44,"x":103,"y":143,"width":5,"height":7,"xoffset":1,"yoffset":8,"xadvance":7,"page":0,"chnl":15},{"id":45,"x":137,"y":141,"width":11,"height":5,"xoffset":-1,"yoffset":4,"xadvance":11,"page":0,"chnl":15},{"id":46,"x":165,"y":136,"width":5,"height":5,"xoffset":1,"yoffset":8,"xadvance":7,"page":0,"chnl":15},{"id":47,"x":162,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":48,"x":84,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":49,"x":112,"y":99,"width":12,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":50,"x":112,"y":19,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":51,"x":126,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":52,"x":140,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":53,"x":154,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":54,"x":168,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":55,"x":182,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":56,"x":116,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":57,"x":210,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":58,"x":232,"y":124,"width":5,"height":11,"xoffset":2,"yoffset":1,"xadvance":8,"page":0,"chnl":15},{"id":59,"x":114,"y":115,"width":7,"height":14,"xoffset":-1,"yoffset":1,"xadvance":7,"page":0,"chnl":15},{"id":60,"x":132,"y":115,"width":9,"height":13,"xoffset":0,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":61,"x":13,"y":144,"width":11,"height":9,"xoffset":-1,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":62,"x":122,"y":115,"width":9,"height":13,"xoffset":0,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":63,"x":42,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":64,"x":56,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":65,"x":70,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":66,"x":84,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":67,"x":98,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":68,"x":112,"y":35,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":69,"x":126,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":70,"x":140,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":71,"x":154,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":72,"x":168,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":73,"x":0,"y":116,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":74,"x":196,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":75,"x":210,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":76,"x":224,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":77,"x":238,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":78,"x":0,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":79,"x":14,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":80,"x":196,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":81,"x":42,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":82,"x":56,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":83,"x":70,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":84,"x":84,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":85,"x":98,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":86,"x":112,"y":51,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":87,"x":126,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":88,"x":140,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":89,"x":154,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":90,"x":168,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":91,"x":38,"y":116,"width":7,"height":15,"xoffset":1,"yoffset":-2,"xadvance":9,"page":0,"chnl":15},{"id":92,"x":212,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":93,"x":46,"y":116,"width":7,"height":15,"xoffset":1,"yoffset":-2,"xadvance":9,"page":0,"chnl":15},{"id":94,"x":39,"y":144,"width":11,"height":8,"xoffset":-1,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":95,"x":109,"y":143,"width":13,"height":5,"xoffset":-2,"yoffset":9,"xadvance":12,"page":0,"chnl":15},{"id":96,"x":79,"y":143,"width":7,"height":7,"xoffset":1,"yoffset":-2,"xadvance":9,"page":0,"chnl":15},{"id":97,"x":170,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":98,"x":28,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":99,"x":184,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":100,"x":56,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":101,"x":198,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":102,"x":150,"y":96,"width":11,"height":15,"xoffset":0,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":103,"x":98,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":104,"x":112,"y":67,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":105,"x":94,"y":116,"width":9,"height":14,"xoffset":0,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":106,"x":103,"y":0,"width":12,"height":18,"xoffset":-2,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":107,"x":140,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":108,"x":222,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":109,"x":212,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":110,"x":226,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":111,"x":240,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":112,"x":210,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":113,"x":224,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":114,"x":42,"y":132,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":115,"x":0,"y":132,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":116,"x":14,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":117,"x":14,"y":132,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":118,"x":156,"y":112,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":119,"x":84,"y":131,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":120,"x":70,"y":131,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":121,"x":56,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":122,"x":56,"y":132,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":123,"x":69,"y":0,"width":10,"height":19,"xoffset":-1,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":124,"x":97,"y":0,"width":5,"height":19,"xoffset":2,"yoffset":-2,"xadvance":8,"page":0,"chnl":15},{"id":125,"x":80,"y":0,"width":10,"height":19,"xoffset":0,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":126,"x":25,"y":144,"width":13,"height":8,"xoffset":-2,"yoffset":3,"xadvance":12,"page":0,"chnl":15},{"id":160,"x":171,"y":136,"width":6,"height":4,"xoffset":-3,"yoffset":13,"xadvance":5,"page":0,"chnl":15},{"id":161,"x":54,"y":116,"width":5,"height":15,"xoffset":2,"yoffset":2,"xadvance":8,"page":0,"chnl":15},{"id":162,"x":126,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":0,"xadvance":12,"page":0,"chnl":15},{"id":163,"x":84,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":164,"x":196,"y":124,"width":11,"height":11,"xoffset":-1,"yoffset":0,"xadvance":11,"page":0,"chnl":15},{"id":165,"x":98,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":166,"x":91,"y":0,"width":5,"height":19,"xoffset":2,"yoffset":-2,"xadvance":8,"page":0,"chnl":15},{"id":167,"x":28,"y":0,"width":13,"height":19,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":168,"x":149,"y":137,"width":9,"height":5,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":169,"x":112,"y":83,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":170,"x":208,"y":124,"width":11,"height":11,"xoffset":-2,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":171,"x":0,"y":144,"width":12,"height":10,"xoffset":-2,"yoffset":2,"xadvance":11,"page":0,"chnl":15},{"id":172,"x":67,"y":144,"width":11,"height":7,"xoffset":-1,"yoffset":-1,"xadvance":11,"page":0,"chnl":15},{"id":174,"x":126,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":175,"x":123,"y":143,"width":13,"height":5,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":176,"x":148,"y":125,"width":11,"height":11,"xoffset":-2,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":177,"x":80,"y":116,"width":13,"height":14,"xoffset":-2,"yoffset":-1,"xadvance":12,"page":0,"chnl":15},{"id":178,"x":220,"y":124,"width":11,"height":11,"xoffset":-2,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":179,"x":184,"y":124,"width":11,"height":11,"xoffset":-2,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":180,"x":87,"y":143,"width":7,"height":7,"xoffset":1,"yoffset":-2,"xadvance":9,"page":0,"chnl":15},{"id":181,"x":140,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":182,"x":154,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":183,"x":159,"y":137,"width":5,"height":5,"xoffset":2,"yoffset":3,"xadvance":8,"page":0,"chnl":15},{"id":184,"x":95,"y":143,"width":7,"height":7,"xoffset":-1,"yoffset":10,"xadvance":7,"page":0,"chnl":15},{"id":185,"x":172,"y":124,"width":11,"height":11,"xoffset":-2,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":186,"x":124,"y":129,"width":11,"height":11,"xoffset":-2,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":187,"x":238,"y":124,"width":12,"height":10,"xoffset":-1,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":188,"x":168,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":189,"x":182,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":190,"x":196,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":191,"x":210,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":192,"x":224,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":193,"x":238,"y":80,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":194,"x":0,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":195,"x":14,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":196,"x":28,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":197,"x":42,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":198,"x":56,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":199,"x":14,"y":0,"width":13,"height":19,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":200,"x":70,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":201,"x":84,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":202,"x":98,"y":100,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":203,"x":130,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":204,"x":192,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":205,"x":10,"y":116,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":206,"x":242,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":207,"x":232,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":208,"x":144,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":209,"x":214,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":210,"x":228,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":211,"x":242,"y":0,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":212,"x":0,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":213,"x":14,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":214,"x":28,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":215,"x":136,"y":129,"width":11,"height":11,"xoffset":-1,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":216,"x":42,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":217,"x":56,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":218,"x":70,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":219,"x":98,"y":20,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":220,"x":224,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":221,"x":238,"y":16,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":222,"x":138,"y":96,"width":11,"height":15,"xoffset":-1,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":223,"x":125,"y":99,"width":12,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":11,"page":0,"chnl":15},{"id":224,"x":0,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":225,"x":14,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":226,"x":28,"y":36,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":227,"x":182,"y":32,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":228,"x":28,"y":52,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":229,"x":182,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":230,"x":28,"y":132,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":231,"x":196,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":232,"x":210,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":233,"x":224,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":234,"x":238,"y":48,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":235,"x":70,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":236,"x":202,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":237,"x":182,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":238,"x":172,"y":96,"width":9,"height":15,"xoffset":0,"yoffset":-2,"xadvance":10,"page":0,"chnl":15},{"id":239,"x":104,"y":116,"width":9,"height":14,"xoffset":0,"yoffset":-1,"xadvance":10,"page":0,"chnl":15},{"id":240,"x":0,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":241,"x":14,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":242,"x":42,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":243,"x":70,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":244,"x":84,"y":68,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":245,"x":154,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":246,"x":168,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":247,"x":112,"y":131,"width":11,"height":11,"xoffset":-1,"yoffset":1,"xadvance":11,"page":0,"chnl":15},{"id":248,"x":66,"y":116,"width":13,"height":14,"xoffset":-2,"yoffset":0,"xadvance":12,"page":0,"chnl":15},{"id":249,"x":182,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":250,"x":196,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":251,"x":238,"y":64,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":252,"x":0,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":253,"x":0,"y":0,"width":13,"height":19,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":254,"x":56,"y":0,"width":12,"height":19,"xoffset":-1,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":255,"x":42,"y":0,"width":13,"height":19,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":338,"x":28,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":339,"x":98,"y":131,"width":13,"height":11,"xoffset":-2,"yoffset":2,"xadvance":12,"page":0,"chnl":15},{"id":8364,"x":42,"y":84,"width":13,"height":15,"xoffset":-2,"yoffset":-2,"xadvance":12,"page":0,"chnl":15},{"id":12288,"x":185,"y":136,"width":6,"height":4,"xoffset":-3,"yoffset":13,"xadvance":16,"page":0,"chnl":15}],"kernings":[],"info":{"face":"Pixel12x10","size":16,"bold":0,"italic":0,"charset":"","unicode":1,"stretchH":100,"smooth":0,"aa":1,"padding":[1,0,0,1],"spacing":[1,1],"outline":1},"common":{"lineHeight":20,"base":12,"scaleW":256,"scaleH":256,"pages":1,"packed":0,"alphaChnl":1,"redChnl":0,"greenChnl":0,"blueChnl":0}}');var ut=s.t(gt,2);const wt=U,vt=xt,mt=pt,kt=O;class Lt extends N{constructor(t){super(t),this.zoomLevels=[{picture:new g("res/GameAtlas16.png"),slices:vt},{picture:new g("res/GameAtlas24.png"),slices:mt},{picture:new g("res/GameAtlas32.png"),slices:kt}],this.picture=new g("res/TitleAtlas.png"),this.ticks=0,this.previewBoard=null,this.lastCollection=-1,this.lastLevel=-1,this.font=new D(z),this.outlineFont=new D(ut)}focusTick(t,e){const i=t.input(),n=t.singleton;switch(i.autoRepeatNewest(["left","right","up","down"])){case"left":n.currentCollection--,n.currentLevel=0;break;case"right":n.currentCollection++,n.currentLevel=0;break;case"up":n.currentLevel--;break;case"down":n.currentLevel++}i.justPressed("accept")&&this.previewBoard&&t.setScene((()=>dt(t))),i.justPressed("menu")&&e.pushEvent("openMenu")}makePreviewTokens(t,e){for(const i of e){const e=new Z(i.x,i.y,t),n=t.tile(i.x,i.y);switch(e.picture=t.picture,i.tokenType){case J.Player:e.slice=t.slices.playerHead;break;case J.Crate:e.slice=t.slices.crate[n===q.Dropzone?1:0]}t.addToken(e)}}updatePreview(t){if(t.currentCollection===this.lastCollection&&t.currentLevel===this.lastLevel)return;const e=t.levels[t.currentCollection];if(!e)return;const i=e.levels[t.currentLevel];if(!i)return;const n=i.measureDimensions();let s;s=n.x<=12&&n.y<=8?this.zoomLevels[2]:n.x<=18&&n.y<=12?this.zoomLevels[1]:this.zoomLevels[0],this.previewBoard=it.fromLevel(i,s.picture,s.slices,((t,e)=>{this.makePreviewTokens(t,e)})),this.lastCollection=t.currentCollection,this.lastLevel=t.currentLevel}tick(t,e){const i=t.singleton;i.currentCollection=(i.currentCollection+i.levels.length)%i.levels.length;const n=i.levels[i.currentCollection];i.currentLevel=n?(i.currentLevel+n.levels.length)%n.levels.length:0,this.updatePreview(i),this.ticks++,this.keepActive(0)}drawCollectionSelector(t,e){const i=t.canvas().width,n=t.context(),s=e.levels[e.currentCollection];let o="<error>",a="Anonymous";s&&(o=s.name,s.author.length>0&&(a=s.author)),n.save(),n.scale(2,2),this.font.drawText(t,`Levelset   ${o}`,40,96),n.restore();const h=3*Math.sin(.1*this.ticks);t.drawSprite(this.picture,wt.arrowLeft,286-h,198),t.drawSprite(this.picture,wt.arrowRight,310+h,198),s&&(this.font.drawText(t,`by ${a}`,80,234,i-160,1),this.font.drawText(t,s.description,80,262,i-160,2))}drawLevelSelector(t,e){const i=e.levels[e.currentCollection];if(!i)return;const n=3*Math.sin(.1*this.ticks);t.drawSprite(this.picture,wt.arrowUp,116,320-n-2),t.drawSprite(this.picture,wt.arrowDown,116,584+n+2);let s=344;const o=k(e.currentLevel-4,0,i.levels.length-10),a=e.getFinishedLevels();for(let n=o;n<o+10;++n)this.drawLevelItem(t,n,s,n===e.currentLevel,i.levels[n],a[n]>0),s+=24}drawLevelItem(t,e,i,n,s,o){if(!s)return;let a=`Level ${e+1}`;s.name&&s.name.length>0&&(a+=`: ${s.name}`);const h=k(308/this.font.measureText(a),.5,1);let r=this.font,f=wt.starWhite;n&&(t.drawRect(58,i-6,348,24,"rgb(255, 255, 255, 1.0"),r=this.outlineFont,f=wt.starBlack),t.drawSprite(this.picture,f[o?1:0],64,i),t.context().save(),t.context().scale(h,1),r.drawText(t,a,92/h,i,616,1),t.context().restore()}drawPreviewBoard(t){this.previewBoard&&(t.drawRect(452,308,492,332,"rgb(0, 0, 0, 0.15)"),t.drawRectOutline(452.5,308.5,491,331,"rgb(0, 0, 0, 0.15)"),this.previewBoard.x=698-this.previewBoard.width*this.previewBoard.tileWidth/2,this.previewBoard.y=474-this.previewBoard.height*this.previewBoard.tileHeight/2,this.previewBoard.draw(t))}drawTicker(t){let e,i;this.ticks%480<240?(e="Press Enter to play",i=104):(e="Press Backspace to open menu",i=64),this.font.drawText(t,e,i,t.canvas().height-24)}draw(t,e,i){const n=t.renderer(),s=n.canvas().width,o=t.singleton;n.drawSprite(this.picture,wt.title,T(wt.title.w,s),24),this.drawPreviewBoard(n),this.drawCollectionSelector(n,o),this.drawLevelSelector(n,o),this.drawTicker(n)}}var Tt,St,At;class bt{constructor(){this.name=null,this.author=null,this.description=null,this.tiles=[]}measureDimensions(){let t=0;const e=this.tiles.length;for(const e of this.tiles)t=Math.max(t,e.length);return{x:t,y:e}}}class _t{constructor(){this.name="Unnamed Collection",this.author="",this.description="",this.saveId="",this.levels=[]}}(function(t,e,i,n){var s,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,n);else for(var h=t.length-1;h>=0;h--)(s=t[h])&&(a=(o<3?s(a):o>3?s(e,i,a):s(e,i))||a);o>3&&a&&Object.defineProperty(e,i,a)})([(Tt=()=>bt,void 0===St&&(St={}),function(t,i){var n=Reflect.getMetadata("design:type",t,i);e.addTypeMetadata({target:t.constructor,propertyName:i,reflectedType:n,typeFunction:Tt,options:St})})],_t.prototype,"levels",void 0),function(t){t[t.None=0]="None",t[t.Loading=1]="Loading",t[t.Loaded=2]="Loaded",t[t.Broken=3]="Broken"}(At||(At={}));class Ct{constructor(){this.loadState=At.None,this.error=null,this.font=new D(z)}async fetchLevels(t){const e=await S("./res/levels.json"),i=[],n={};for(const t of e.levelFiles){const e=S(t).then((t=>{const e=f(_t,t);if(e.saveId.length<=0)throw new Error(`Empty collection save id for "${e.name}"`);if(void 0!==n[e.saveId])throw new Error(`Collection save id "${e.saveId}" collision between "${e.name}" and "${n[e.saveId]}"`);return n[e.saveId]=e.name,Promise.resolve(e)}));i.push(e)}const s=Promise.all(i).then((e=>{t.singleton.levels=e,this.loadState=At.Loaded})).catch((t=>{throw this.loadState=At.Broken,t}));await s}isLoaded(){return this.loadState===At.Loaded}tick(t,e){if(g.allLoaded()&&this.loadState===At.None&&(t.singleton.levels.length>0?this.loadState=At.Loaded:(this.loadState=At.Loading,this.fetchLevels(t).catch((t=>{this.error=new Error("Failed to read level list: "+t.message??String(t))})))),this.error)throw this.error}draw(t,e,i){const n=t.renderer();this.font.drawText(n,"Grabbing levels...",64,576)}}class Mt extends W{constructor(t,e){super(t),this.levelFetchLogic=e}isLoaded(){return super.isLoaded()&&this.levelFetchLogic.isLoaded()}}function Pt(t){const e=new I(.25),i=new Ct,n=new Mt(t,i),s=new Lt(n),o=new G(n);return n.addDrawLoaderLogic(e),n.addLoaderLogic(i),n.addLogic(e),n.addLogic(s),n.addLogic(o),n}window.onload=function(){const t=new M("game_surface",new y),e=t.input();e.addAction("left",["ArrowLeft","KeyA"]),e.addAction("right",["ArrowRight","KeyD"]),e.addAction("up",["ArrowUp","KeyW"]),e.addAction("down",["ArrowDown","KeyS"]),e.addAction("menu",["Backspace","Escape"]),e.addAction("accept",["Enter","Space"]),e.addAction("undo",["KeyZ"]),e.addAction("redo",["KeyX"]),t.setScene((()=>Pt(t.input()))),t.run()}})()})();